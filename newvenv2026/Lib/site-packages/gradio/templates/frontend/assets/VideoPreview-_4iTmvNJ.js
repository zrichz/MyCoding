import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{onMount as Z,onDestroy as ue,createEventDispatcher as te,afterUpdate as ce,tick as _e}from"./svelte/svelte_svelte.js";import{I as $,f as re,w as ge,a as ve,n as fe,x as he,b as me,V as ee,E as pe,c as be,j as ye,D as we}from"./IconButtonWrapper-D4LMIc_2.js";import{S as ke}from"./ShareButton-DGzDjeX1.js";import"./i18n-CyvX8KmK.js";import{f as G,u as xe}from"./utils.svelte-Ceck75cM.js";import{b as Ee,t as Te,V as De}from"./Video-06U9X4-1.js";import{M as Ve}from"./ModifyUpload-2md6CVWe.js";import{p as Pe}from"./index-Dw8Uzof1.js";var Le=e.from_html('<div class="load-wrap svelte-mctcyk"><span aria-label="loading timeline" class="loader svelte-mctcyk"></span></div>'),Re=e.from_html('<img draggable="false" class="svelte-mctcyk"/>'),Se=e.from_html('<div id="timeline" class="thumbnail-wrapper svelte-mctcyk"><button aria-label="start drag handle for trimming video" class="handle left svelte-mctcyk"></button> <div class="opaque-layer svelte-mctcyk"></div> <!> <button aria-label="end drag handle for trimming video" class="handle right svelte-mctcyk"></button></div>'),Me=e.from_html('<div class="container svelte-mctcyk"><!></div>');function qe(W,r){e.push(r,!1);let a=e.prop(r,"videoElement",12),x=e.prop(r,"trimmedDuration",12),P=e.prop(r,"dragStart",12),o=e.prop(r,"dragEnd",12),L=e.prop(r,"loadingTimeline",12),h=e.mutable_source([]),E=10,p,d=e.mutable_source(0),c=e.mutable_source(100),b=null;const T=t=>{b=t},R=()=>{b=null},_=(t,s)=>{if(b){const u=document.getElementById("timeline");if(!u)return;const y=u.getBoundingClientRect();let D=(t.clientX-y.left)/y.width*100;if(s?D=b==="left"?e.get(d)+s:e.get(c)+s:D=(t.clientX-y.left)/y.width*100,D=Math.max(0,Math.min(D,100)),b==="left"){e.set(d,Math.min(D,e.get(c)));const v=e.get(d)/100*p;a(a().currentTime=v,!0),P(v)}else if(b==="right"){e.set(c,Math.max(D,e.get(d)));const v=e.get(c)/100*p;a(a().currentTime=v,!0),o(v)}const M=e.get(d)/100*p,V=e.get(c)/100*p;x(V-M),e.set(d,e.get(d)),e.set(c,e.get(c))}},I=t=>{if(b){const s=1/p*100;t.key==="ArrowLeft"?_({clientX:0},-s):t.key==="ArrowRight"&&_({clientX:0},s)}},C=()=>{const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)return;t.width=a().videoWidth,t.height=a().videoHeight,s.drawImage(a(),0,0,t.width,t.height);const u=t.toDataURL("image/jpeg",.7);e.set(h,[...e.get(h),u])};Z(()=>{const t=()=>{p=a().duration;const s=p/E;let u=0;const y=()=>{C(),u++,u<E?a(a().currentTime+=s,!0):a().removeEventListener("seeked",y)};a().addEventListener("seeked",y),a(a().currentTime=0,!0)};a().readyState>=1?t():a().addEventListener("loadedmetadata",t)}),ue(()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",R),window.removeEventListener("keydown",I)}),Z(()=>{window.addEventListener("mousemove",_),window.addEventListener("mouseup",R),window.addEventListener("keydown",I)}),e.legacy_pre_effect(()=>e.get(h),()=>{L(e.get(h).length!==E)}),e.legacy_pre_effect_reset();var B={get videoElement(){return a()},set videoElement(t){a(t),e.flush()},get trimmedDuration(){return x()},set trimmedDuration(t){x(t),e.flush()},get dragStart(){return P()},set dragStart(t){P(t),e.flush()},get dragEnd(){return o()},set dragEnd(t){o(t),e.flush()},get loadingTimeline(){return L()},set loadingTimeline(t){L(t),e.flush()}};e.init();var S=Me(),z=e.child(S);{var g=t=>{var s=Le();e.append(t,s)},m=t=>{var s=Se(),u=e.child(s),y=e.sibling(u,2),D=e.sibling(y,2);e.each(D,1,()=>e.get(h),e.index,(V,v,n)=>{var w=Re();e.set_attribute(w,"alt",`frame-${n}`),e.template_effect(()=>e.set_attribute(w,"src",e.get(v))),e.append(V,w)});var M=e.sibling(D,2);e.reset(s),e.template_effect(()=>{e.set_style(u,`left: ${e.get(d)??""}%;`),e.set_style(y,`left: ${e.get(d)??""}%; right: ${100-e.get(c)}%`),e.set_style(M,`left: ${e.get(c)??""}%;`)}),e.event("mousedown",u,()=>T("left")),e.event("blur",u,R),e.event("keydown",u,V=>{(V.key==="ArrowLeft"||V.key=="ArrowRight")&&T("left")}),e.event("mousedown",M,()=>T("right")),e.event("blur",M,R),e.event("keydown",M,V=>{(V.key==="ArrowLeft"||V.key=="ArrowRight")&&T("right")}),e.append(t,s)};e.if(z,t=>{L()?t(g):t(m,!1)})}return e.reset(S),e.append(W,S),e.pop(B)}var Ae=e.from_html('<div class="timeline-wrapper svelte-1orxdv"><!></div>'),Be=e.from_html('<time aria-label="duration of selected region in seconds"> </time> <div class="edit-buttons svelte-1orxdv"><button>Trim</button> <button>Cancel</button></div>',1),Ie=e.from_html('<div class="svelte-1orxdv"></div>'),Xe=e.from_html("<!> <!>",1),Ce=e.from_html('<div><!> <div class="controls svelte-1orxdv" data-testid="waveform-controls"><!></div></div> <!>',1);function He(W,r){e.push(r,!1);let a=e.prop(r,"videoElement",12),x=e.prop(r,"showRedo",12,!1),P=e.prop(r,"interactive",12,!0),o=e.prop(r,"mode",12,""),L=e.prop(r,"handle_reset_value",12),h=e.prop(r,"handle_trim_video",12),E=e.prop(r,"processingVideo",12,!1),p=e.prop(r,"i18n",12),d=e.prop(r,"value",12,null),c=e.prop(r,"show_download_button",12,!1),b=e.prop(r,"handle_clear",12,()=>{}),T=e.prop(r,"has_change_history",12,!1),R=e.mutable_source();Z(async()=>{e.set(R,await Ee())});let _=e.mutable_source(null),I=e.mutable_source(0),C=e.mutable_source(0),B=e.mutable_source(!1);const S=()=>{o()==="edit"?(o(""),e.set(_,a().duration)):o("edit")};e.legacy_pre_effect(()=>(e.deep_read_state(o()),e.get(_),e.deep_read_state(a())),()=>{o()==="edit"&&e.get(_)===null&&a()&&e.set(_,a().duration)}),e.legacy_pre_effect_reset();var z={get videoElement(){return a()},set videoElement(n){a(n),e.flush()},get showRedo(){return x()},set showRedo(n){x(n),e.flush()},get interactive(){return P()},set interactive(n){P(n),e.flush()},get mode(){return o()},set mode(n){o(n),e.flush()},get handle_reset_value(){return L()},set handle_reset_value(n){L(n),e.flush()},get handle_trim_video(){return h()},set handle_trim_video(n){h(n),e.flush()},get processingVideo(){return E()},set processingVideo(n){E(n),e.flush()},get i18n(){return p()},set i18n(n){p(n),e.flush()},get value(){return d()},set value(n){d(n),e.flush()},get show_download_button(){return c()},set show_download_button(n){c(n),e.flush()},get handle_clear(){return b()},set handle_clear(n){b(n),e.flush()},get has_change_history(){return T()},set has_change_history(n){T(n),e.flush()}};e.init();var g=Ce(),m=e.first_child(g);let t;var s=e.child(m);{var u=n=>{var w=Ae(),X=e.child(w);qe(X,{get videoElement(){return a()},get dragStart(){return e.get(I)},set dragStart(k){e.set(I,k)},get dragEnd(){return e.get(C)},set dragEnd(k){e.set(C,k)},get trimmedDuration(){return e.get(_)},set trimmedDuration(k){e.set(_,k)},get loadingTimeline(){return e.get(B)},set loadingTimeline(k){e.set(B,k)},$$legacy:!0}),e.reset(w),e.append(n,w)};e.if(s,n=>{o()==="edit"&&n(u)})}var y=e.sibling(s,2),D=e.child(y);{var M=n=>{var w=Be(),X=e.first_child(w);let k;var H=e.child(X,!0);e.reset(X);var q=e.sibling(X,2),f=e.child(q);let j;var A=e.sibling(f,2);let U;e.reset(q),e.template_effect(J=>{k=e.set_class(X,1,"svelte-1orxdv",null,k,{hidden:e.get(B)}),e.set_text(H,J),j=e.set_class(f,1,"text-button svelte-1orxdv",null,j,{hidden:e.get(B)}),U=e.set_class(A,1,"text-button svelte-1orxdv",null,U,{hidden:e.get(B)})},[()=>(e.deep_read_state(G),e.get(_),e.untrack(()=>G(e.get(_))))]),e.event("click",f,()=>{o(""),E(!0),Te(e.get(R),e.get(I),e.get(C),a()).then(J=>{h()(J)}).then(()=>{E(!1)})}),e.event("click",A,S),e.append(n,w)},V=n=>{var w=Ie();e.append(n,w)};e.if(D,n=>{o()==="edit"&&e.get(_)!==null?n(M):n(V,!1)})}e.reset(y),e.reset(m);var v=e.sibling(m,2);{let n=e.derived_safe_equal(()=>(e.deep_read_state(c()),e.deep_read_state(d()),e.untrack(()=>c()?d()?.url:null)));Ve(v,{get i18n(){return p()},get download(){return e.get(n)},$$events:{clear:()=>b()()},children:(w,X)=>{var k=Xe(),H=e.first_child(k);{var q=A=>{{let U=e.derived_safe_equal(()=>E()||!T());$(A,{get Icon(){return re},label:"Reset video to initial value",get disabled(){return e.get(U)},$$events:{click:()=>{L()(),o("")}}})}};e.if(H,A=>{x()&&o()===""&&A(q)})}var f=e.sibling(H,2);{var j=A=>{$(A,{get Icon(){return ge},label:"Trim video to selection",get disabled(){return E()},$$events:{click:S}})};e.if(f,A=>{P()&&o()===""&&A(j)})}e.append(w,k)},$$slots:{default:!0}})}return e.template_effect(()=>t=e.set_class(m,1,"container svelte-1orxdv",null,t,{hidden:o()!=="edit"})),e.append(W,g),e.pop(z)}var Ue=e.from_html('<track kind="captions" default/>'),je=e.from_html('<div class="wrap svelte-1k28h7x"><div><!></div> <div class="controls svelte-1k28h7x"><div class="inner svelte-1k28h7x"><span role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="play-pause-replay-button"><!></span> <span class="time svelte-1k28h7x"> </span>  <progress class="svelte-1k28h7x"></progress> <div role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="full-screen"><!></div></div></div></div> <!>',1);function Fe(W,r){e.push(r,!1);let a=e.prop(r,"root",12,""),x=e.prop(r,"src",12),P=e.prop(r,"subtitle",12,null),o=e.prop(r,"mirror",12),L=e.prop(r,"autoplay",12),h=e.prop(r,"loop",12),E=e.prop(r,"label",12,"test"),p=e.prop(r,"interactive",12,!1),d=e.prop(r,"handle_change",12,()=>{}),c=e.prop(r,"handle_reset_value",12,()=>{}),b=e.prop(r,"upload",12),T=e.prop(r,"is_stream",12),R=e.prop(r,"i18n",12),_=e.prop(r,"show_download_button",12,!1),I=e.prop(r,"value",12,null),C=e.prop(r,"handle_clear",12,()=>{}),B=e.prop(r,"has_change_history",12,!1),S=e.prop(r,"playback_position",12,0);const z=te();let g=e.mutable_source(0),m=e.mutable_source(),t=e.mutable_source(!0),s=e.mutable_source(),u=e.mutable_source(!1);function y(l){if(!e.get(m))return;if(l.type==="click"){M(l);return}if(l.type!=="touchmove"&&!(l.buttons&1))return;const i=l.type==="touchmove"?l.touches[0].clientX:l.clientX,{left:F,right:O}=l.currentTarget.getBoundingClientRect();e.set(g,e.get(m)*(i-F)/(O-F))}async function D(){document.fullscreenElement!=e.get(s)&&(e.get(s).currentTime>0&&!e.get(s).paused&&!e.get(s).ended&&e.get(s).readyState>e.get(s).HAVE_CURRENT_DATA?e.get(s).pause():await e.get(s).play())}function M(l){const{left:i,right:F}=l.currentTarget.getBoundingClientRect();e.set(g,e.get(m)*(l.clientX-i)/(F-i))}function V(){z("stop"),z("end")}const v=async l=>{let i=new File([l],"video.mp4");const F=await Pe([i]);let O=(await b()(F,a()))?.filter(Boolean)[0];d()(O)};function n(){e.get(s).requestFullscreen()}e.legacy_pre_effect(()=>e.get(g),()=>{e.set(g,e.get(g)||0)}),e.legacy_pre_effect(()=>e.get(m),()=>{e.set(m,e.get(m)||0)}),e.legacy_pre_effect(()=>e.get(g),()=>{S(e.get(g))}),e.legacy_pre_effect(()=>(e.deep_read_state(S()),e.get(g),e.get(s)),()=>{S()!==e.get(g)&&e.get(s)&&e.mutate(s,e.get(s).currentTime=S())}),e.legacy_pre_effect_reset();var w={get root(){return a()},set root(l){a(l),e.flush()},get src(){return x()},set src(l){x(l),e.flush()},get subtitle(){return P()},set subtitle(l){P(l),e.flush()},get mirror(){return o()},set mirror(l){o(l),e.flush()},get autoplay(){return L()},set autoplay(l){L(l),e.flush()},get loop(){return h()},set loop(l){h(l),e.flush()},get label(){return E()},set label(l){E(l),e.flush()},get interactive(){return p()},set interactive(l){p(l),e.flush()},get handle_change(){return d()},set handle_change(l){d(l),e.flush()},get handle_reset_value(){return c()},set handle_reset_value(l){c(l),e.flush()},get upload(){return b()},set upload(l){b(l),e.flush()},get is_stream(){return T()},set is_stream(l){T(l),e.flush()},get i18n(){return R()},set i18n(l){R(l),e.flush()},get show_download_button(){return _()},set show_download_button(l){_(l),e.flush()},get value(){return I()},set value(l){I(l),e.flush()},get handle_clear(){return C()},set handle_clear(l){C(l),e.flush()},get has_change_history(){return B()},set has_change_history(l){B(l),e.flush()},get playback_position(){return S()},set playback_position(l){S(l),e.flush()}};e.init();var X=je(),k=e.first_child(X),H=e.child(k);let q;var f=e.child(H);{let l=e.derived_safe_equal(()=>`${E()}-player`);De(f,{get src(){return x()},preload:"auto",get autoplay(){return L()},get loop(){return h()},get is_stream(){return T()},get"data-testid"(){return e.get(l)},get processingVideo(){return e.get(u)},get currentTime(){return e.get(g)},set currentTime(i){e.set(g,i)},get duration(){return e.get(m)},set duration(i){e.set(m,i)},get paused(){return e.get(t)},set paused(i){e.set(t,i)},get node(){return e.get(s)},set node(i){e.set(s,i)},$$events:{click:D,play(i){e.bubble_event.call(this,r,i)},pause(i){e.bubble_event.call(this,r,i)},error(i){e.bubble_event.call(this,r,i)},ended:V,loadstart(i){e.bubble_event.call(this,r,i)},loadeddata(i){e.bubble_event.call(this,r,i)},loadedmetadata(i){e.bubble_event.call(this,r,i)}},children:(i,F)=>{var O=Ue();e.template_effect(()=>e.set_attribute(O,"src",P())),e.append(i,O)},$$slots:{default:!0},$$legacy:!0})}e.reset(H);var j=e.sibling(H,2),A=e.child(j),U=e.child(A),J=e.child(U);{var le=l=>{re(l)},ae=l=>{var i=e.comment(),F=e.first_child(i);{var O=N=>{fe(N)},de=N=>{he(N)};e.if(F,N=>{e.get(t)?N(O):N(de,!1)},!0)}e.append(l,i)};e.if(J,l=>{e.get(g)===e.get(m)?l(le):l(ae,!1)})}e.reset(U);var Y=e.sibling(U,2),ne=e.child(Y);e.reset(Y);var K=e.sibling(Y,2),Q=e.sibling(K,2),se=e.child(Q);ve(se),e.reset(Q),e.reset(A),e.reset(j),e.reset(k);var ie=e.sibling(k,2);{var oe=l=>{He(l,{get videoElement(){return e.get(s)},showRedo:!0,handle_trim_video:v,get handle_reset_value(){return c()},get value(){return I()},get i18n(){return R()},get show_download_button(){return _()},get handle_clear(){return C()},get has_change_history(){return B()},get processingVideo(){return e.get(u)},set processingVideo(i){e.set(u,i)},$$legacy:!0})};e.if(ie,l=>{p()&&l(oe)})}return e.template_effect((l,i)=>{q=e.set_class(H,1,"mirror-wrap svelte-1k28h7x",null,q,{mirror:o()}),e.set_text(ne,`${l??""} / ${i??""}`),e.set_value(K,e.get(g)/e.get(m)||0)},[()=>(e.deep_read_state(G),e.get(g),e.untrack(()=>G(e.get(g)))),()=>(e.deep_read_state(G),e.get(m),e.untrack(()=>G(e.get(m))))]),e.event("click",U,D),e.event("keydown",U,D),e.event("mousemove",K,y),e.event("touchmove",K,e.preventDefault(y)),e.event("click",K,e.preventDefault(e.stopPropagation(M))),e.event("click",Q,n),e.event("keypress",Q,n),e.append(W,X),e.pop(w)}var ze=e.from_html("<!> <!>",1),Oe=e.from_html('<!> <div data-testid="download-div"><!></div>',1),We=e.from_html("<!> <!>",1);function Ne(W,r){e.push(r,!1);let a=e.prop(r,"value",12,null),x=e.prop(r,"subtitle",12,null),P=e.prop(r,"label",12,void 0),o=e.prop(r,"show_label",12,!0),L=e.prop(r,"autoplay",12),h=e.prop(r,"buttons",12,null),E=e.prop(r,"on_custom_button_click",12,null),p=e.prop(r,"loop",12),d=e.prop(r,"i18n",12),c=e.prop(r,"upload",12),b=e.prop(r,"display_icon_button_wrapper_top_corner",12,!1),T=e.prop(r,"playback_position",12,0),R=null,_=null;const I=te();ce(async()=>{a()!==R&&x()!==_&&_!==null&&(R=a(),a(null),await _e(),a(R)),R=a(),_=x()}),e.legacy_pre_effect(()=>e.deep_read_state(a()),()=>{a()&&I("change",a())}),e.legacy_pre_effect_reset();var C={get value(){return a()},set value(t){a(t),e.flush()},get subtitle(){return x()},set subtitle(t){x(t),e.flush()},get label(){return P()},set label(t){P(t),e.flush()},get show_label(){return o()},set show_label(t){o(t),e.flush()},get autoplay(){return L()},set autoplay(t){L(t),e.flush()},get buttons(){return h()},set buttons(t){h(t),e.flush()},get on_custom_button_click(){return E()},set on_custom_button_click(t){E(t),e.flush()},get loop(){return p()},set loop(t){p(t),e.flush()},get i18n(){return d()},set i18n(t){d(t),e.flush()},get upload(){return c()},set upload(t){c(t),e.flush()},get display_icon_button_wrapper_top_corner(){return b()},set display_icon_button_wrapper_top_corner(t){b(t),e.flush()},get playback_position(){return T()},set playback_position(t){T(t),e.flush()}};e.init();var B=We(),S=e.first_child(B);{let t=e.derived_safe_equal(()=>P()||"Video");me(S,{get show_label(){return o()},get Icon(){return ee},get label(){return e.get(t)}})}var z=e.sibling(S,2);{var g=t=>{pe(t,{unpadded_box:!0,size:"large",children:(s,u)=>{ee(s)},$$slots:{default:!0}})},m=t=>{var s=Oe(),u=e.first_child(s);e.key(u,()=>(e.deep_read_state(a()),e.untrack(()=>a().url)),M=>{{let V=e.derived_safe_equal(()=>(e.deep_read_state(x()),e.untrack(()=>x()?.url)));Fe(M,{get src(){return e.deep_read_state(a()),e.untrack(()=>a().url)},get subtitle(){return e.get(V)},get is_stream(){return e.deep_read_state(a()),e.untrack(()=>a().is_stream)},get autoplay(){return L()},mirror:!1,get label(){return P()},get loop(){return p()},interactive:!1,get upload(){return c()},get i18n(){return d()},get playback_position(){return T()},set playback_position(v){T(v)},$$events:{play(v){e.bubble_event.call(this,r,v)},pause(v){e.bubble_event.call(this,r,v)},stop(v){e.bubble_event.call(this,r,v)},end(v){e.bubble_event.call(this,r,v)},loadedmetadata:()=>{I("load")}},$$legacy:!0})}});var y=e.sibling(u,2),D=e.child(y);{let M=e.derived_safe_equal(()=>h()??["download","share"]);be(D,{get display_top_corner(){return b()},get buttons(){return e.get(M)},get on_custom_button_click(){return E()},children:(V,v)=>{var n=ze(),w=e.first_child(n);{var X=q=>{{let f=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a().is_stream?a().url?.replace("playlist.m3u8","playlist-file"):a().url))),j=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a().orig_name||a().path)));ye(q,{get href(){return e.get(f)},get download(){return e.get(j)},children:(A,U)=>{$(A,{get Icon(){return we},label:"Download"})},$$slots:{default:!0}})}};e.if(w,q=>{e.deep_read_state(h()),e.untrack(()=>h()?.some(f=>typeof f=="string"&&f==="download"))&&q(X)})}var k=e.sibling(w,2);{var H=q=>{ke(q,{get i18n(){return d()},get value(){return a()},formatter:async f=>f?await xe(f.data):"",$$events:{error(f){e.bubble_event.call(this,r,f)},share(f){e.bubble_event.call(this,r,f)}}})};e.if(k,q=>{e.deep_read_state(h()),e.untrack(()=>h()?.some(f=>typeof f=="string"&&f==="share"))&&q(H)})}e.append(V,n)},$$slots:{default:!0}})}e.reset(y),e.append(t,s)};e.if(z,t=>{e.deep_read_state(a()),e.untrack(()=>!a()||a().url===void 0)?t(g):t(m,!1)})}return e.append(W,B),e.pop(C)}const lt=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{Fe as P,Ne as V,lt as a};
