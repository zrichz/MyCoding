const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./embed-CG2e9My5.js","./mollweide-BhZ4OpW6.js","./ordinal-BeghXfj9.js","./init-Dmth1JHB.js","./linear-CM32Lqs5.js","./step-ChYay-CR.js","./defaultLocale-CNpUPyHh.js","./time-CCMAgbNn.js","./dispatch-kxCwF96_.js","./range-OtVwhkKS.js","./index-BU4IRnz1.js","./colors-Cc3OSVma.js","./dsv-DB8NKgIY.js","./arc-CSo4ybba.js"])))=>i.map(i=>d[i]);
import{_ as ae}from"./index-Dw8Uzof1.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import"./i18n-CyvX8KmK.js";import{G as pe}from"./utils.svelte-Ceck75cM.js";import{B as de,e as ue,c as fe,I as ge,D as ce,E as _e,L as ve}from"./IconButtonWrapper-D4LMIc_2.js";import"./svelte/svelte_internal_flags_legacy.js";import{onMount as me,untrack as he}from"./svelte/svelte_svelte.js";import{F as ye}from"./FullscreenButton-CdZP1GYm.js";import{S as be}from"./StreamingBar-C6ky6DsM.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";import"./MarkdownCode-C7jLnxqj.js";import"./prism-python-B1e-54E9.js";var xe=e.from_html("<!> <!>",1),ke=e.from_html('<p class="caption svelte-19utvcn"> </p>'),we=e.from_html('<div class="svelte-19utvcn"></div> <!>',1),$e=e.from_html("<!> <!> <!> <!>",1);function Je(K,R){e.push(R,!0);let Q=e.rest_props(R,["$$slots","$$events","$$legacy"]);const t=new pe(Q);let G=e.derived(()=>t.props.color&&t.props.value&&t.props.value.datatypes[t.props.color]==="nominal"?Array.from(new Set(e.get(A).map(r=>r[t.props.color]))):[]),F=e.derived(()=>t.props.x_lim||null),P=e.derived(()=>t.props.y_lim||null),z=e.derived(()=>e.get(F)?.[0]!==null?e.get(F)?.[0]:void 0),O=e.derived(()=>e.get(F)?.[1]!==null?e.get(F)?.[1]:void 0),U=e.derived(()=>e.get(P)?.[0]!==null?e.get(P)?.[0]:void 0),Y=e.derived(()=>e.get(P)?.[1]!==null?e.get(P)?.[1]:void 0),k=e.state(!1);function Z(r){if(r==="x")return"ascending";if(r==="-x")return"descending";if(r==="y")return{field:t.props.y,order:"ascending"};if(r==="-y")return{field:t.props.y,order:"descending"};if(r===null)return null;if(Array.isArray(r))return r}let ee=e.derived(()=>Z(t.props.sort)),A=e.state(e.proxy([]));function I(r){return r.replace(/\./g,"\\.").replace(/\[/g,"\\[").replace(/\]/g,"\\]")}let V=e.derived(()=>t.props.value&&t.props.value.datatypes[t.props.x]==="temporal"),S=e.derived(()=>e.get(V)?[e.get(z)!==void 0?e.get(z)*1e3:null,e.get(O)!==void 0?e.get(O)*1e3:null]:e.get(F)),L=e.state(!1);const te={s:1,m:60,h:3600,d:1440*60};let w=e.derived(()=>t.props.x_bin?typeof t.props.x_bin=="string"?1e3*parseInt(t.props.x_bin.substring(0,t.props.x_bin.length-1))*te[t.props.x_bin[t.props.x_bin.length-1]]:t.props.x_bin:void 0),N=e.derived(()=>{if(t.props.value)if(t.props.value.mark==="point"){const r=e.get(w)!==void 0;return t.props.y_aggregate||r?"sum":void 0}else return t.props.y_aggregate?t.props.y_aggregate:"sum"}),q=e.derived(()=>t.props.value?t.props.value.mark==="point"?e.get(w)!==void 0:e.get(w)!==void 0||t.props.value.datatypes[t.props.x]==="nominal":!1);function J(r,s,f,l,v,p){if(r.length<1e3||t.props.x_bin!==null||t.props.value?.mark!=="line"||t.props.value?.datatypes[t.props.x]==="nominal")return r;const g=250;let i={};if((v===void 0||p===void 0)&&r.forEach(o=>{let d=o[s];(v===void 0||d<v)&&(v=d),(p===void 0||d>p)&&(p=d)}),v===void 0||p===void 0)return r;const u=(p-v)/g;r.forEach((o,d)=>{const m=o[s],_=o[f],a=l!==null?o[l]:"any",n=Math.floor((m-v)/u);i[a]===void 0&&(i[a]=[]),i[a][n]=i[a][n]||[null,Number.POSITIVE_INFINITY,null,Number.NEGATIVE_INFINITY],_<i[a][n][1]&&(i[a][n][0]=d,i[a][n][1]=_),_>i[a][n][3]&&(i[a][n][2]=d,i[a][n][3]=_)});const x=[];return Object.values(i).forEach(o=>{o.forEach(([d,m,_,a])=>{let n=[];d!==null&&_!==null?n=[Math.min(d,_),Math.max(d,_)]:d!==null?n=[d]:_!==null&&(n=[_]),n.forEach($=>{x.push(r[$])})})}),x}function re(r,s,f){let l=r.columns.indexOf(t.props.x),v=r.columns.indexOf(t.props.y),p=t.props.color?r.columns.indexOf(t.props.color):null,g=r.data;if(s!==void 0&&f!==void 0){const i=r.datatypes[t.props.x]==="temporal"?1e3:1,c=s*i,u=f*i;let x={},o={};const d=g.filter((m,_)=>{const a=m[l],n=p!==null?m[p]:"any";return a<c&&(x[n]===void 0||a>x[n][1])&&(x[n]=[_,a]),a>u&&(o[n]===void 0||a<o[n][1])&&(o[n]=[_,a]),a>=c&&a<=u});g=[...Object.values(x).map(([m,_])=>g[m]),...J(d,l,v,p,c,u),...Object.values(o).map(([m,_])=>g[m])]}else g=J(g,l,v,p,void 0,void 0);return t.props.tooltip=="all"||Array.isArray(t.props.tooltip)?g.map(i=>{const c={};return r.columns.forEach((u,x)=>{c[u]=i[x]}),c}):g.map(i=>{const c={[t.props.x]:i[l],[t.props.y]:i[v]};return t.props.color&&p!==null&&(c[t.props.color]=i[p]),c})}e.user_effect(()=>{e.set(A,t.props.value?re(t.props.value,e.get(z),e.get(O)):[],!0)});let X=e.state(e.proxy(t.props.value));e.user_effect(()=>{e.get(X)!==t.props.value&&e.get(h)&&(e.set(X,t.props.value,!0),e.get(h).data("data",e.get(A)).runAsync())});const oe=typeof window<"u";let y=e.state(void 0),b=e.derived(()=>e.get(y)?window.getComputedStyle(e.get(y)):null),h=e.state(void 0),W=e.state(!1),M=e.state(0),j=e.state(0),T=e.state(void 0),D;async function C(){if(e.get(L)){e.set(H,!0);return}if(e.get(h)&&e.get(h).finalize(),!t.props.value||!e.get(y))return;e.set(M,e.get(y).offsetWidth,!0),e.set(j,e.get(y).offsetHeight,!0);const r=se();r&&(e.set(T,new ResizeObserver(s=>{if(!(!s[0].target||!(s[0].target instanceof HTMLElement)))if(e.get(M)===0&&e.get(y).offsetWidth!==0&&t.props.value.datatypes[t.props.x]==="nominal")C();else{const f=Math.abs(e.get(M)-s[0].target.offsetWidth),l=Math.abs(e.get(j)-s[0].target.offsetHeight);f>100||l>100?(e.set(M,s[0].target.offsetWidth,!0),e.set(j,s[0].target.offsetHeight,!0),C()):(e.get(h).signal("width",s[0].target.offsetWidth).run(),e.get(k)&&e.get(h).signal("height",s[0].target.offsetHeight).run())}}),!0),D||(D=(await ae(async()=>{const{default:s}=await import("./embed-CG2e9My5.js");return{default:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url)).default),D(e.get(y),r,{actions:!1}).then(function(s){e.set(h,s.view,!0),e.get(T).observe(e.get(y));var f,l=0;e.get(h).addEventListener("dblclick",()=>{t.dispatch("double_click")}),e.get(y).addEventListener("mousedown",function(v){v.detail>1&&v.preventDefault()},!1),t.props._selectable&&e.get(h).addSignalListener("brush",function(v,p){if(Date.now()-l<1e3||(e.set(L,!0),Object.keys(p).length===0))return;clearTimeout(f);let g=p[Object.keys(p)[0]];e.get(V)&&(g=[g[0]/1e3,g[1]/1e3]),f=setTimeout(function(){e.set(L,!1),l=Date.now(),t.dispatch("select",{value:g,index:g,selected:!0}),e.get(H)&&(e.set(H,!1),C())},250)})}))}let H=e.state(!1);me(()=>(e.set(W,!0),()=>{e.set(W,!1),e.get(h)&&e.get(h).finalize(),e.get(T)&&e.get(T).disconnect()}));function le(){if(!e.get(h)||!e.get(b))return;const s=e.get(b).getPropertyValue("--block-background-fill")||"white";e.get(h).background(s).run(),e.get(h).toImageURL("png",2).then(function(f){e.get(h).background("transparent").run();const l=document.createElement("a");l.setAttribute("href",f),l.setAttribute("download","chart.png"),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}).catch(function(f){console.error("Export failed:",f),e.get(h).background("transparent").run()})}let ne=e.derived(()=>JSON.stringify(t.props.color_map));e.user_effect(()=>{t.props.title,t.props.x_title,t.props.y_title,t.props.color_title,t.props.x,t.props.y,t.props.color,t.props.x_bin,e.get(N),e.get(ne),t.props.colors_in_legend,e.get(z),e.get(O),e.get(U),e.get(Y),t.props.caption,t.props.sort,e.get(W),e.get(y),e.get(k),e.get(b),e.get(W)&&e.get(y)&&he(()=>{C()})});function se(){if(!t.props.value||!e.get(b))return null;let r=e.get(b).getPropertyValue("--color-accent"),s=e.get(b).getPropertyValue("--body-text-color"),f=e.get(b).getPropertyValue("--border-color-primary"),l=e.get(b).fontFamily,v=e.get(b).getPropertyValue("--block-title-text-weight");const p=c=>c.endsWith("px")?parseFloat(c.slice(0,-2)):12;let g=p(e.get(b).getPropertyValue("--text-md")),i=p(e.get(b).getPropertyValue("--text-sm"));return{$schema:"https://vega.github.io/schema/vega-lite/v5.17.0.json",background:"transparent",config:{autosize:{type:"fit",contains:"padding"},axis:{labelFont:l,labelColor:s,titleFont:l,titleColor:s,titlePadding:8,tickColor:f,labelFontSize:i,gridColor:f,titleFontWeight:"normal",titleFontSize:i,labelFontWeight:"normal",domain:!1,labelAngle:0,titleLimit:e.get(y).offsetHeight*.8},legend:{labelColor:s,labelFont:l,titleColor:s,titleFont:l,titleFontWeight:"normal",titleFontSize:i,labelFontWeight:"normal",offset:2},title:{color:s,font:l,fontSize:g,fontWeight:v,anchor:"middle"},view:{stroke:f},mark:{stroke:t.props.value.mark!=="bar"?r:void 0,fill:t.props.value.mark==="bar"?r:void 0,cursor:"crosshair"}},data:{name:"data"},datasets:{data:e.get(A)},layer:["plot",...t.props.value.mark==="line"?["hover"]:[]].map(c=>({encoding:{size:t.props.value.mark==="line"?c=="plot"?{condition:{empty:!1,param:"hoverPlot",value:3},value:2}:{condition:{empty:!1,param:"hover",value:100},value:0}:void 0,opacity:c==="plot"?void 0:{condition:{empty:!1,param:"hover",value:1},value:0},x:{axis:{...t.props.x_label_angle!==null&&{labelAngle:t.props.x_label_angle},labels:t.props.x_axis_labels_visible,ticks:t.props.x_axis_labels_visible},field:I(t.props.x),title:t.props.x_title||t.props.x,type:t.props.value.datatypes[t.props.x],scale:{zero:!1,domainMin:e.get(S)?.[0]!==null?e.get(S)?.[0]:void 0,domainMax:e.get(S)?.[1]!==null?e.get(S)?.[1]:void 0},bin:e.get(w)?{step:e.get(w)}:void 0,sort:e.get(ee)},y:{axis:t.props.y_label_angle?{labelAngle:t.props.y_label_angle}:{},field:I(t.props.y),title:t.props.y_title||t.props.y,type:t.props.value.datatypes[t.props.y],scale:{zero:!1,domainMin:e.get(U)??void 0,domainMax:e.get(Y)??void 0},aggregate:e.get(q)?e.get(N):void 0},color:t.props.color?{field:I(t.props.color),legend:{orient:"bottom",title:t.props.color_title,values:t.props.colors_in_legend?.length?[...t.props.colors_in_legend]:void 0},scale:t.props.value.datatypes[t.props.color]==="nominal"?{domain:e.get(G),range:t.props.color_map?e.get(G).map(u=>t.props.color_map[u]):void 0}:{range:[100,200,300,400,500,600,700,800,900].map(u=>e.get(b).getPropertyValue("--primary-"+u)),interpolate:"hsl"},type:t.props.value.datatypes[t.props.color]}:void 0,tooltip:t.props.tooltip=="none"?void 0:[{field:I(t.props.y),type:t.props.value.datatypes[t.props.y],aggregate:e.get(q)?e.get(N):void 0,title:t.props.y_title||t.props.y},{field:I(t.props.x),type:t.props.value.datatypes[t.props.x],title:t.props.x_title||t.props.x,format:e.get(V)?"%Y-%m-%d %H:%M:%S":void 0,bin:e.get(w)?{step:e.get(w)}:void 0},...t.props.color?[{field:t.props.color,type:t.props.value.datatypes[t.props.color]}]:[],...t.props.tooltip==="axis"?[]:t.props.value?.columns.filter(u=>u!==t.props.x&&u!==t.props.y&&u!==t.props.color&&(t.props.tooltip==="all"||t.props.tooltip.includes(u))).map(u=>({field:u,type:t.props.value.datatypes[u]}))]},strokeDash:{},mark:{clip:!0,type:c==="hover"?"point":t.props.value.mark},name:c})),params:[...t.props.value.mark==="line"?[{name:"hoverPlot",select:{clear:"mouseout",fields:t.props.color?[t.props.color]:[],nearest:!0,on:"mouseover",type:"point"},views:["hover"]},{name:"hover",select:{clear:"mouseout",nearest:!0,on:"mouseover",type:"point"},views:["hover"]}]:[],...t.props._selectable?[{name:"brush",select:{encodings:["x"],mark:{fill:"gray",fillOpacity:.3,stroke:"none"},type:"interval"},views:["plot"]}]:[]],width:e.get(y).offsetWidth,height:t.props.height||e.get(k)?"container":void 0,title:t.props.title||void 0}}de(K,{get visible(){return t.shared.visible},get elem_id(){return t.shared.elem_id},get elem_classes(){return t.shared.elem_classes},get scale(){return t.shared.scale},get min_width(){return t.shared.min_width},allow_overflow:!1,padding:!0,get height(){return t.props.height},get fullscreen(){return e.get(k)},set fullscreen(r){e.set(k,r,!0)},children:(r,s)=>{var f=$e(),l=e.first_child(f);{var v=o=>{be(o,e.spread_props({get autoscroll(){return t.shared.autoscroll},get i18n(){return t.i18n}},()=>t.shared.loading_status,{on_clear_status:()=>t.dispatch("clear_status",t.shared.loading_status)}))};e.if(l,o=>{t.shared.loading_status&&o(v)})}var p=e.sibling(l,2);{var g=o=>{fe(o,{children:(d,m)=>{var _=xe(),a=e.first_child(_);{var n=E=>{ge(E,{get Icon(){return ce},label:"Export",$$events:{click:le}})};e.if(a,E=>{t.props.buttons?.includes("export")&&E(n)})}var $=e.sibling(a,2);{var B=E=>{ye(E,{get fullscreen(){return e.get(k)},$$events:{fullscreen:({detail:ie})=>{e.set(k,ie,!0)}}})};e.if($,E=>{t.props.buttons?.includes("fullscreen")&&E(B)})}e.append(d,_)},$$slots:{default:!0}})};e.if(p,o=>{t.props.buttons?.length&&o(g)})}var i=e.sibling(p,2);ue(i,{get show_label(){return t.shared.show_label},info:void 0,children:(o,d)=>{e.next();var m=e.text();e.template_effect(()=>e.set_text(m,t.shared.label)),e.append(o,m)},$$slots:{default:!0}});var c=e.sibling(i,2);{var u=o=>{var d=we(),m=e.first_child(d);e.bind_this(m,n=>e.set(y,n),()=>e.get(y));var _=e.sibling(m,2);{var a=n=>{var $=ke(),B=e.child($,!0);e.reset($),e.template_effect(()=>e.set_text(B,t.props.caption)),e.append(n,$)};e.if(_,n=>{t.props.caption&&n(a)})}e.append(o,d)},x=o=>{_e(o,{unpadded_box:!0,children:(d,m)=>{ve(d)},$$slots:{default:!0}})};e.if(c,o=>{t.props.value&&oe?o(u):o(x,!1)})}e.append(r,f)},$$slots:{default:!0}}),e.pop()}export{Je as default};
