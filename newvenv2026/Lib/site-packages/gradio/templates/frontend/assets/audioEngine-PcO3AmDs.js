const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./webAudioBus-BcCj9u02.js","./abstractAudioBus-Bi3Nou2q.js","./webAudioBaseSubGraph-BYCmN5ue.js","./index-Dtj0WP_z.js","./index-Dw8Uzof1.js","./index-qRhMeKhs.css","./spatialWebAudio-DB8FzaGH.js","./webAudioMainBus-C2SJhtCD.js","./webAudioStaticSound-DEUv1vIj.js","./abstractSoundInstance-CQv8Ep1s.js","./abstractSoundSource-BnyIdx4V.js","./webAudioSoundSource-CgeqgJTh.js","./webAudioStreamingSound-Cy6qv-2m.js"])))=>i.map(i=>d[i]);
import{V as o,Q as _,bv as R,M as U,O as h,E as N,A as S}from"./index-Dtj0WP_z.js";import{_ as l}from"./index-Dw8Uzof1.js";class E{constructor(t){this._mainBuses=new Set,this._sounds=new Set,this._soundsArray=null,this._nodes=new Set,this._defaultMainBus=null,this._parameterRampDuration=.01,typeof t.parameterRampDuration=="number"&&(this.parameterRampDuration=t.parameterRampDuration)}get defaultMainBus(){return this._mainBuses.size===0?null:(this._defaultMainBus||(this._defaultMainBus=Array.from(this._mainBuses)[0]),this._defaultMainBus)}get parameterRampDuration(){return this._parameterRampDuration}set parameterRampDuration(t){this._parameterRampDuration=Math.max(0,t)}get sounds(){return this._soundsArray||(this._soundsArray=Array.from(this._sounds)),this._soundsArray}dispose(){const t=this._nodes.values();for(let e=t.next();!e.done;e=t.next())e.value.dispose();this._mainBuses.clear(),this._nodes.clear(),this._sounds.clear(),this._disposeSoundsArray(),this._defaultMainBus=null}unlockAsync(){return this.resumeAsync()}_addMainBus(t){this._mainBuses.add(t),this._addNode(t)}_removeMainBus(t){this._mainBuses.delete(t),this._defaultMainBus=null,this._removeNode(t)}_addNode(t){this._nodes.add(t)}_removeNode(t){this._nodes.delete(t)}_addSound(t){this._disposeSoundsArray(),this._sounds.add(t),this._addNode(t)}_removeSound(t){this._disposeSoundsArray(),this._sounds.delete(t),this._removeNode(t)}_disposeSoundsArray(){this._soundsArray&&(this._soundsArray.length=0,this._soundsArray=null)}}const P={position:o.Zero(),rotation:o.Zero(),rotationQuaternion:new _};function M(n){return n.listenerEnabled||n.listenerMinUpdateTime!==void 0||n.listenerPosition!==void 0||n.listenerRotation!==void 0||n.listenerRotationQuaternion!==void 0}class D{}class v{constructor(t){this._attachmentType=3,this._position=new o,this._rotationQuaternion=new _,this._sceneNode=null,this._useBoundingBox=!1,this.dispose=()=>{this.detach()},this._spatialAudioNode=t}get isAttached(){return this._sceneNode!==null}attach(t,e,i){this._sceneNode!==t&&(this.detach(),t&&(this._attachmentType=i,this._sceneNode=t,this._sceneNode.onDisposeObservable.add(this.dispose),this._useBoundingBox=e))}detach(){this._sceneNode?.onDisposeObservable.removeCallback(this.dispose),this._sceneNode=null}update(){this._attachmentType&1&&(this._useBoundingBox&&this._sceneNode.getBoundingInfo?this._position.copyFrom(this._sceneNode.getBoundingInfo().boundingBox.centerWorld):this._sceneNode?.getWorldMatrix().getTranslationToRef(this._position),this._spatialAudioNode.position.copyFrom(this._position),this._spatialAudioNode._updatePosition()),this._attachmentType&2&&(this._sceneNode?.getWorldMatrix().decompose(void 0,this._rotationQuaternion),this._spatialAudioNode.rotationQuaternion.copyFrom(this._rotationQuaternion),this._spatialAudioNode._updateRotation())}}class I extends D{constructor(){super(),this._attacherComponent=null,this._attacherComponent=new v(this)}get isAttached(){return this._attacherComponent!==null&&this._attacherComponent.isAttached}attach(t,e=!1,i=3){this._attacherComponent||(this._attacherComponent=new v(this)),this._attacherComponent.attach(t,e,i)}detach(){this._attacherComponent?.detach()}dispose(){this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(t){t.listenerMinUpdateTime!==void 0&&(this.minUpdateTime=t.listenerMinUpdateTime),t.listenerPosition&&(this.position=t.listenerPosition.clone()),t.listenerRotationQuaternion?this.rotationQuaternion=t.listenerRotationQuaternion.clone():t.listenerRotation?this.rotation=t.listenerRotation.clone():this.rotationQuaternion=P.rotationQuaternion.clone(),this.update()}}class V{constructor(t,e,i){if(this._autoUpdate=!0,this._lastUpdateTime=0,this.minUpdateTime=0,!e)return;this.minUpdateTime=i;const s=()=>{if(!this._autoUpdate)return;let a=!1;if(0<this.minUpdateTime){const r=R.Now;this._lastUpdateTime&&r-this._lastUpdateTime<this.minUpdateTime&&(a=!0),this._lastUpdateTime=r}a||t.update(),requestAnimationFrame(s)};requestAnimationFrame(s)}dispose(){this._autoUpdate=!1}}const J=new RegExp("\\.(\\w{3,4})($|\\?)"),d=100,A=new Float32Array([0,0]);let m=null,c=null,p=null;function B(){if(!c){c=new Float32Array(d);const n=1/(d-1);let t=n;for(let e=1;e<d;e++)c[e]=Math.exp(-11.512925464970227*(1-t)),t+=n}return c}function k(){if(!p){p=new Float32Array(d);const n=1/d;let t=n;for(let e=0;e<d;e++)p[e]=1+Math.log10(t)/Math.log10(d),t+=n}return p}function F(n,t,e){m||(m=new Float32Array(d));let i;if(n==="linear")return A[0]=t,A[1]=e,A;if(n==="exponential")i=B();else if(n==="logarithmic")i=k();else throw new Error(`Unknown ramp shape: ${n}`);const s=Math.sign(e-t),a=Math.abs(e-t);if(s===1)for(let r=0;r<i.length;r++)m[r]=t+a*i[r];else{let r=d-1;for(let f=0;f<i.length;f++,r--)m[f]=t-a*(1-i[r])}return m}function K(n){return n.replace(/#/gm,"%23")}const G=.011,W=1e-6;class u{constructor(t,e){this._deferredRampOptions={duration:0,shape:"linear"},this._deferredTargetValue=-1,this._isObservingUpdates=!1,this._rampEndTime=0,this._applyDeferredRamp=()=>{0<this._deferredRampOptions.duration&&this._rampEndTime<this._engine.currentTime&&this.setTargetValue(this._deferredTargetValue,this._deferredRampOptions)},this._engine=t,this._param=e,this._targetValue=e.value}get isRamping(){return this._engine.currentTime<this._rampEndTime}get targetValue(){return this._targetValue}set targetValue(t){this.setTargetValue(t)}get value(){return this._param.value}dispose(){this._clearDeferredRamp(),this._param=null,this._engine=null}setTargetValue(t,e=null){if(this._targetValue===t)return;const i=typeof e?.shape=="string"?e.shape:"linear";let s=typeof e?.duration=="number"?Math.max(e.duration,this._engine.parameterRampDuration):this._engine.parameterRampDuration;const a=this._engine.currentTime;if(a<this._rampEndTime){const r=this._rampEndTime-a;if(G<r)throw new Error("Audio parameter not set. Wait for current ramp to finish.");this._deferRamp(t,s,i);return}if((s=Math.max(this._engine.parameterRampDuration,s))<W){this._param.setValueAtTime(this._targetValue=t,a);return}this._param.cancelScheduledValues(a),this._param.setValueCurveAtTime(F(i,this._targetValue,this._targetValue=t),a,s),this._clearDeferredRamp(),this._rampEndTime=a+s}_deferRamp(t,e,i){this._deferredRampOptions.duration=e,this._deferredRampOptions.shape=i,this._deferredTargetValue=t,this._isObservingUpdates||(this._engine._addUpdateObserver(this._applyDeferredRamp),this._isObservingUpdates=!0)}_clearDeferredRamp(){this._deferredRampOptions.duration=0,this._isObservingUpdates&&(this._engine._removeUpdateObserver(this._applyDeferredRamp),this._isObservingUpdates=!1)}}const g=U.Zero(),b=new _,y=o.Zero(),w=o.Zero();function C(n,t,e){const i=n._audioContext.listener;return i.forwardX&&i.forwardY&&i.forwardZ&&i.positionX&&i.positionY&&i.positionZ&&i.upX&&i.upY&&i.upZ?new L(n,t,e):new Z(n,t,e)}class x extends I{constructor(t,e,i){super(),this._lastPosition=o.Zero(),this._lastRotation=o.Zero(),this._lastRotationQuaternion=new _,this.position=o.Zero(),this.rotation=o.Zero(),this.rotationQuaternion=new _,this._listener=t._audioContext.listener,this.engine=t,this._updaterComponent=new V(this,e,i)}dispose(){super.dispose(),this._updaterComponent.dispose(),this._updaterComponent=null}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(t){this._updaterComponent.minUpdateTime=t}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||(this._setWebAudioPosition(this.position),this._lastPosition.copyFrom(this.position))}_updateRotation(){if(!this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion))b.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion);else if(!this._lastRotation.equalsWithEpsilon(this.rotation))_.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,b),this._lastRotation.copyFrom(this.rotation);else return;U.FromQuaternionToRef(b,g),o.TransformNormalToRef(o.RightHandedForwardReadOnly,g,y),o.TransformNormalToRef(o.Up(),g,w),this._setWebAudioOrientation(y,w)}}class L extends x{constructor(t,e,i){super(t,e,i);const s=t._audioContext.listener;this._forwardX=new u(t,s.forwardX),this._forwardY=new u(t,s.forwardY),this._forwardZ=new u(t,s.forwardZ),this._positionX=new u(t,s.positionX),this._positionY=new u(t,s.positionY),this._positionZ=new u(t,s.positionZ),this._upX=new u(t,s.upX),this._upY=new u(t,s.upY),this._upZ=new u(t,s.upZ)}_setWebAudioPosition(t){this.isAttached&&(this._positionX.isRamping||this._positionY.isRamping||this._positionZ.isRamping)||(this._positionX.targetValue=t.x,this._positionY.targetValue=t.y,this._positionZ.targetValue=t.z)}_setWebAudioOrientation(t,e){this.isAttached&&(this._forwardX.isRamping||this._forwardY.isRamping||this._forwardZ.isRamping||this._upX.isRamping||this._upY.isRamping||this._upZ.isRamping)||(this._forwardX.targetValue=t.x,this._forwardY.targetValue=t.y,this._forwardZ.targetValue=t.z,this._upX.targetValue=e.x,this._upY.targetValue=e.y,this._upZ.targetValue=e.z)}}class Z extends x{_setWebAudioPosition(t){this._listener.setPosition(t.x,t.y,t.z)}_setWebAudioOrientation(t,e){this._listener.setOrientation(t.x,t.y,t.z,e.x,e.y,e.z)}}var O;(function(n){n[n.HAS_INPUTS=1]="HAS_INPUTS",n[n.HAS_OUTPUTS=2]="HAS_OUTPUTS",n[n.HAS_INPUTS_AND_OUTPUTS=3]="HAS_INPUTS_AND_OUTPUTS"})(O||(O={}));class T{constructor(t,e){this.onDisposeObservable=new h,this.engine=t,e&1&&(this._upstreamNodes=new Set),e&2&&(this._downstreamNodes=new Set)}dispose(){if(this._downstreamNodes){for(const t of Array.from(this._downstreamNodes))if(!this._disconnect(t))throw new Error("Disconnect failed");this._downstreamNodes.clear()}if(this._upstreamNodes){for(const t of Array.from(this._upstreamNodes))if(!t._disconnect(this))throw new Error("Disconnect failed");this._upstreamNodes.clear()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}_connect(t){return!this._downstreamNodes||this._downstreamNodes.has(t)||!t._onConnect(this)?!1:(this._downstreamNodes.add(t),!0)}_disconnect(t){return!this._downstreamNodes||!this._downstreamNodes.delete(t)?!1:t._onDisconnect(this)}_onConnect(t){return!this._upstreamNodes||this._upstreamNodes.has(t)?!1:(this._upstreamNodes.add(t),!0)}_onDisconnect(t){return this._upstreamNodes?.delete(t)??!1}}class tt extends T{constructor(t,e,i){super(e,i),this.onNameChangedObservable=new h,this._name=t}get name(){return this._name}set name(t){if(this._name===t)return;const e=this._name;this._name=t,this.onNameChangedObservable.notifyObservers({newName:t,oldName:e,node:this})}dispose(){super.dispose(),this.onNameChangedObservable.clear()}}class Q extends T{constructor(t){super(t,1)}}class X extends Q{constructor(t){super(t),this._setGainNode(new GainNode(t._audioContext))}dispose(){super.dispose(),this._volume.dispose(),this._gainNode.disconnect(),this._destinationNode.disconnect()}get _inNode(){return this._gainNode}set _inNode(t){this._gainNode!==t&&this._setGainNode(t)}get volume(){return this._volume.targetValue}set volume(t){this._volume.targetValue=t}get _destinationNode(){return this.engine._audioDestination}getClassName(){return"_WebAudioMainOut"}setVolume(t,e=null){this._volume.setTargetValue(t,e)}_setGainNode(t){this._gainNode!==t&&(this._gainNode?.disconnect(),t.connect(this._destinationNode),this._volume=new u(this.engine,t.gain),this._gainNode=t)}}class Y{constructor(t,e){this._button=null,this._enabled=!0,this._style=null,this._onStateChanged=()=>{this._button&&(this._engine.state==="running"?this._hide():this._show())},this._engine=t;const i=e||N.LastCreatedEngine?.getInputElement()?.parentElement||document.body,s=(i?.offsetTop||0)+20;this._style=document.createElement("style"),this._style.appendChild(document.createTextNode(`.babylonUnmute{position:absolute;top:${s}px;margin-left:20px;height:40px;width:60px;background-color:rgba(51,51,51,0.7);background-image:url("data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E");background-size:80%;background-repeat:no-repeat;background-position:center;background-position-y:4px;border:none;outline:none;transition:transform 0.125s ease-out;cursor:pointer;z-index:9999;}.babylonUnmute:hover{transform:scale(1.05)}`)),document.head.appendChild(this._style),this._button=document.createElement("button"),this._button.className="babylonUnmute",this._button.id="babylonUnmuteButton",this._button.addEventListener("click",()=>{this._engine.unlockAsync()}),i.appendChild(this._button),this._engine.stateChangedObservable.add(this._onStateChanged)}dispose(){this._button?.remove(),this._button=null,this._style?.remove(),this._style=null,this._engine.stateChangedObservable.removeCallback(this._onStateChanged)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,t?this._engine.state!=="running"&&this._show():this._hide()}_show(){!this._button||!this._enabled||(this._button.style.display="block")}_hide(){this._button&&(this._button.style.display="none")}}const z={aac:"audio/aac",ac3:"audio/ac3",flac:"audio/flac",m4a:"audio/mp4",mp3:'audio/mpeg; codecs="mp3"',mp4:"audio/mp4",ogg:'audio/ogg; codecs="vorbis"',wav:"audio/wav",webm:'audio/webm; codecs="vorbis"'};class H extends E{constructor(t={}){super(t),this._audioContextStarted=!1,this._destinationNode=null,this._invalidFormats=new Set,this._isUpdating=!1,this._listener=null,this._listenerAutoUpdate=!0,this._listenerMinUpdateTime=0,this._pauseCalled=!1,this._resumeOnInteraction=!0,this._resumeOnPause=!0,this._resumeOnPauseRetryInterval=1e3,this._resumeOnPauseTimerId=null,this._resumePromise=null,this._silentHtmlAudio=null,this._unmuteUI=null,this._updateObservable=null,this._validFormats=new Set,this._volume=1,this._isUsingOfflineAudioContext=!1,this.isReadyPromise=new Promise(e=>{this._resolveIsReadyPromise=e}),this.stateChangedObservable=new h,this.userGestureObservable=new h,this._initAudioContextAsync=async()=>{this._audioContext.addEventListener("statechange",this._onAudioContextStateChange),this._mainOut=new X(this),this._mainOut.volume=this._volume,await this.createMainBusAsync("default")},this._onAudioContextStateChange=()=>{this.state==="running"&&(clearInterval(this._resumeOnPauseTimerId),this._audioContextStarted=!0,this._resumePromise=null),(this.state==="suspended"||this.state==="interrupted")&&this._audioContextStarted&&this._resumeOnPause&&!this._pauseCalled&&(clearInterval(this._resumeOnPauseTimerId),this._resumeOnPauseTimerId=setInterval(()=>{this.resumeAsync()},this._resumeOnPauseRetryInterval)),this.stateChangedObservable.notifyObservers(this.state)},this._onUserGestureAsync=async()=>{if(this._resumeOnInteraction&&await this._audioContext.resume(),!this._silentHtmlAudio){this._silentHtmlAudio=document.createElement("audio");const e=this._silentHtmlAudio;e.controls=!1,e.preload="auto",e.loop=!0,e.src="data:audio/wav;base64,UklGRjAAAABXQVZFZm10IBAAAAABAAEAgLsAAAB3AQACABAAZGF0YQwAAAAAAAEA/v8CAP//AQA=",e.play()}this.userGestureObservable.notifyObservers()},this._startUpdating=()=>{if(!this._isUpdating)if(this._isUpdating=!0,this.state==="running")this._update();else{const e=()=>{this.state==="running"&&(this._update(),this.stateChangedObservable.removeCallback(e))};this.stateChangedObservable.add(e)}},this._update=()=>{this._updateObservable?.hasObservers()?(this._updateObservable.notifyObservers(),requestAnimationFrame(this._update)):this._isUpdating=!1},typeof t.listenerAutoUpdate=="boolean"&&(this._listenerAutoUpdate=t.listenerAutoUpdate),typeof t.listenerMinUpdateTime=="number"&&(this._listenerMinUpdateTime=t.listenerMinUpdateTime),this._volume=t.volume??1,t.audioContext?(this._isUsingOfflineAudioContext=t.audioContext instanceof OfflineAudioContext,this._audioContext=t.audioContext):this._audioContext=new AudioContext,t.disableDefaultUI||(this._unmuteUI=new Y(this,t.defaultUIParentElement))}async _initAsync(t){this._resumeOnInteraction=typeof t.resumeOnInteraction=="boolean"?t.resumeOnInteraction:!0,this._resumeOnPause=typeof t.resumeOnPause=="boolean"?t.resumeOnPause:!0,this._resumeOnPauseRetryInterval=t.resumeOnPauseRetryInterval??1e3,document.addEventListener("click",this._onUserGestureAsync),await this._initAudioContextAsync(),M(t)&&(this._listener=C(this,this._listenerAutoUpdate,this._listenerMinUpdateTime),this._listener.setOptions(t)),this._resolveIsReadyPromise()}get currentTime(){return this._audioContext.currentTime??0}get _inNode(){return this._audioContext.destination}get mainOut(){return this._mainOut}get listener(){return this._listener??(this._listener=C(this,this._listenerAutoUpdate,this._listenerMinUpdateTime))}get state(){return this._isUsingOfflineAudioContext?"running":this._audioContext.state}get volume(){return this._volume}set volume(t){this._volume!==t&&(this._volume=t,this._mainOut&&(this._mainOut.volume=t))}get _audioDestination(){return this._destinationNode?this._destinationNode:this._destinationNode=this._audioContext.destination}set _audioDestination(t){this._destinationNode=t}get _unmuteUIEnabled(){return this._unmuteUI?this._unmuteUI.enabled:!1}set _unmuteUIEnabled(t){this._unmuteUI&&(this._unmuteUI.enabled=t)}async createBusAsync(t,e={}){const i=await l(()=>import("./webAudioBus-BcCj9u02.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),s=new i._WebAudioBus(t,this,e);return await s._initAsync(e),s}async createMainBusAsync(t,e={}){const i=await l(()=>import("./webAudioMainBus-C2SJhtCD.js"),__vite__mapDeps([7,1,2,3,4,5]),import.meta.url),s=new i._WebAudioMainBus(t,this);return await s._initAsync(e),s}async createMicrophoneSoundSourceAsync(t,e){let i;try{i=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(s){throw new Error("Unable to access microphone: "+s)}return await this.createSoundSourceAsync(t,new MediaStreamAudioSourceNode(this._audioContext,{mediaStream:i}),{outBusAutoDefault:!1,...e})}async createSoundAsync(t,e,i={}){const s=await l(()=>import("./webAudioStaticSound-DEUv1vIj.js"),__vite__mapDeps([8,9,3,4,5,10,2,6]),import.meta.url),a=new s._WebAudioStaticSound(t,this,i);return await a._initAsync(e,i),a}async createSoundBufferAsync(t,e={}){const i=await l(()=>import("./webAudioStaticSound-DEUv1vIj.js"),__vite__mapDeps([8,9,3,4,5,10,2,6]),import.meta.url),s=new i._WebAudioStaticSoundBuffer(this);return await s._initAsync(t,e),s}async createSoundSourceAsync(t,e,i={}){const s=await l(()=>import("./webAudioSoundSource-CgeqgJTh.js"),__vite__mapDeps([11,10,2,3,4,5,6]),import.meta.url),a=new s._WebAudioSoundSource(t,e,this,i);return await a._initAsync(i),a}async createStreamingSoundAsync(t,e,i={}){const s=await l(()=>import("./webAudioStreamingSound-Cy6qv-2m.js"),__vite__mapDeps([12,3,4,5,9,10,2,6]),import.meta.url),a=new s._WebAudioStreamingSound(t,this,i);return await a._initAsync(e,i),a}dispose(){super.dispose(),this._listener?.dispose(),this._listener=null,this._audioContext.state!=="closed"&&!this._isUsingOfflineAudioContext&&this._audioContext.close(),document.removeEventListener("click",this._onUserGestureAsync),this._audioContext.removeEventListener("statechange",this._onAudioContextStateChange),this._silentHtmlAudio?.remove(),this._updateObservable?.clear(),this._updateObservable=null,this._unmuteUI?.dispose(),this._unmuteUI=null,this.stateChangedObservable.clear()}flagInvalidFormat(t){this._invalidFormats.add(t)}isFormatValid(t){if(this._validFormats.has(t))return!0;if(this._invalidFormats.has(t))return!1;const e=z[t];return e===void 0?!1:new Audio().canPlayType(e)===""?(this._invalidFormats.add(t),!1):(this._validFormats.add(t),!0)}async pauseAsync(){await this._audioContext.suspend(),this._pauseCalled=!0}resumeAsync(){return this._pauseCalled=!1,this._resumePromise?this._resumePromise:(this._resumePromise=this._audioContext.resume(),this._resumePromise)}setVolume(t,e=null){if(this._mainOut)this._mainOut.setVolume(t,e);else throw new Error("Main output not initialized yet.")}_addMainBus(t){super._addMainBus(t)}_removeMainBus(t){super._removeMainBus(t)}_addNode(t){super._addNode(t)}_removeNode(t){super._removeNode(t)}_addSound(t){super._addSound(t)}_removeSound(t){super._removeSound(t)}_addUpdateObserver(t){this._updateObservable||(this._updateObservable=new h),this._updateObservable.add(t),this._startUpdating()}_removeUpdateObserver(t){this._updateObservable&&this._updateObservable.removeCallback(t)}}S.AudioEngineFactory=(n,t,e)=>new q(n,t,e);class q{get masterGain(){return this._masterGain}set masterGain(t){this._masterGain=this._v2.mainOut._inNode=t}get useCustomUnlockedButton(){return this._useCustomUnlockedButton}set useCustomUnlockedButton(t){this._useCustomUnlockedButton=t,this._v2._unmuteUIEnabled=!t}get audioContext(){return this._v2.state==="running"&&this._triggerRunningStateAsync(),this._v2._audioContext}constructor(t=null,e=null,i=null){this._audioContext=null,this._tryToRun=!1,this._useCustomUnlockedButton=!1,this.canUseWebAudio=!0,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.onAudioUnlockedObservable=new h,this.onAudioLockedObservable=new h;const s=new H({audioContext:e||void 0,defaultUIParentElement:t?.parentElement?t.parentElement:void 0});s._unmuteUIEnabled=!1,this._masterGain=new GainNode(s._audioContext),s._audioDestination=i,s.stateChangedObservable.add(a=>{a==="running"?(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)):(this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this))}),s._initAsync({resumeOnInteraction:!1}).then(()=>{const a=s.defaultMainBus._outNode;a&&(a.disconnect(s.mainOut._inNode),a.connect(this._masterGain)),s.mainOut._inNode=this._masterGain,s.stateChangedObservable.notifyObservers(s.state)}),this.isMP3supported=s.isFormatValid("mp3"),this.isOGGsupported=s.isFormatValid("ogg"),this._v2=s}lock(){this._v2._audioContext.suspend(),this._useCustomUnlockedButton||(this._v2._unmuteUIEnabled=!0)}unlock(){if(this._audioContext?.state==="running"){this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this));return}this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",()=>{this.unlocked&&this._audioContext?.state!=="running"&&this._resumeAudioContextAsync()},{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){return this._v2._isUsingOfflineAudioContext?Promise.resolve():this._v2._audioContext.resume()}dispose(){this._v2.dispose(),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.masterGain.gain.value}setGlobalVolume(t){this.masterGain.gain.value=t}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._v2._audioContext.destination)}async _triggerRunningStateAsync(){this._tryToRun||(this._tryToRun=!0,await this._resumeAudioContextAsync(),this._tryToRun=!1,this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))}}export{T as A,K as _,J as a,u as b,v as c,V as d,tt as e};
