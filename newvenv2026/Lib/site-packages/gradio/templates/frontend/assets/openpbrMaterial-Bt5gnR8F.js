const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./openpbr.vertex-CeU_J4uE.js","./index-Dtj0WP_z.js","./index-Dw8Uzof1.js","./index-qRhMeKhs.css","./openpbrUboDeclaration-b_0QqK-r.js","./sceneUboDeclaration-CzV6lZTK.js","./meshUboDeclaration-fjQ1fVkt.js","./vertexColorMixing-C8nU2Ly6.js","./mainUVVaryingDeclaration-CoYBhqQM.js","./helperFunctions-Cj61g9Q2.js","./pbrBRDFFunctions-XImUPJn1.js","./bonesVertex-Cu2q5SsM.js","./bakedVertexAnimation-BPwdbGuk.js","./instancesDeclaration-CzN5SjwP.js","./harmonicsFunctions-C_z-IeJX.js","./clipPlaneVertex-DBRxgsWM.js","./logDepthVertex-Cxbc8VQk.js","./shadowsVertex-BeiWpA5f.js","./morphTargetsVertexDeclaration-DK2xs3Bb.js","./logDepthDeclaration-Dl64zREp.js","./morphTargetsVertex-B3IvvuI9.js","./openpbr.fragment-C1qVV8-V.js","./oitFragment-DhhDjg9_.js","./pbrDebug-Bsc7ZjSJ.js","./shadowsFragmentFunctions-DeigO-FX.js","./samplerFragmentDeclaration-XYabqoq1.js","./imageProcessingFunctions-NR9bFSkV.js","./clipPlaneFragment-Co7herwi.js","./fogFragment-5zMDv_x-.js","./hdrFilteringFunctions-CECi4QTM.js","./openpbr.vertex-B0TtyyxN.js","./vertexColorMixing-OKoD6HcL.js","./openpbrUboDeclaration-CgfKAkyd.js","./sceneUboDeclaration-CuFGPF1s.js","./meshUboDeclaration-ocHX74-g.js","./mainUVVaryingDeclaration-V-5Pz-ey.js","./helperFunctions-vhBENDhA.js","./pbrBRDFFunctions-CP_oLCua.js","./harmonicsFunctions-B68e_voe.js","./logDepthVertex-C8rg8I9G.js","./shadowsVertex-PYxlTXtf.js","./logDepthDeclaration-BfWb0RXK.js","./openpbr.fragment-D9xPxzD1.js","./oitFragment-mNi4YcZ_.js","./pbrDebug-CqHjunul.js","./shadowsFragmentFunctions-BtG1d-8r.js","./bumpFragment-B0cXzddS.js","./imageProcessingFunctions-C0S2Pz8w.js","./fogFragment-CepjM6Lc.js","./hdrFilteringFunctions-D-5zE1ac.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./index-Dw8Uzof1.js";import{ap as b,N as R,F as P,aq as Y,H as Z,L as C,a as K,ag as O,ar as j,as as G,K as z,f as w,m as y,ac as Q,$ as U,u as q,ad as $,ae as J,d as F,at as ee,v as te,af as se,c as ie,x as re,y as ae,w as oe,z as ne,a5 as le,a6 as he,a7 as ue,a8 as _e,p as Te,a9 as Ae,q as fe,aa as k,ab as ce,U as pe,X as me,Y as Ee,Z as Re,a0 as ge,a1 as Se,a2 as Le,a3 as Ie,a4 as Oe,ah as ye,P as Fe,ai as Pe,aj as de,ak as Ne,_ as i,au as o,s as f,am as c,R as Ce}from"./index-Dtj0WP_z.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";const d={effect:null,subMesh:null};class N{populateVectorFromLinkedProperties(t){const r=t.dimension[0];for(const e in this.linkedProperties){const a=this.linkedProperties[e],n=a.numComponents;if(r<n||a.targetUniformComponentOffset>r-n){n==1?C.Error(`Float property ${a.name} has an offset that is too large.`):C.Error(`Vector${n} property ${a.name} won't fit in Vector${r} or has an offset that is too large.`);return}typeof a.value=="number"?N._tmpArray[a.targetUniformComponentOffset]=a.value:a.value.toArray(N._tmpArray,a.targetUniformComponentOffset)}t.fromArray(N._tmpArray)}constructor(t,r){this.linkedProperties={},this.name=t,this.numComponents=r}}N._tmpArray=[0,0,0,0];class A{constructor(t,r,e,a,n=0){this.targetUniformComponentNum=4,this.targetUniformComponentOffset=0,this.name=t,this.targetUniformName=e,this.defaultValue=r,this.value=r,this.targetUniformComponentNum=a,this.targetUniformComponentOffset=n}get numComponents(){return typeof this.defaultValue=="number"?1:this.defaultValue.dimension[0]}}class p{get samplerName(){return this.samplerPrefix+"Sampler"}get samplerInfoName(){return"v"+this.samplerPrefix.charAt(0).toUpperCase()+this.samplerPrefix.slice(1)+"Infos"}get samplerMatrixName(){return this.samplerPrefix+"Matrix"}constructor(t,r,e){this.value=null,this.samplerPrefix="",this.textureDefine="",this.name=t,this.samplerPrefix=r,this.textureDefine=e}}class xe extends de(Ne){}class V extends Pe(xe){constructor(t){super(t),this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.VERTEXALPHA=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHA_FROM_BASE_COLOR_TEXTURE=!1,this.ALPHATESTVALUE="0.5",this.PREMULTIPLYALPHA=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.LODBASEDMICROSFURACE=!0,this.METALLICWORKFLOW=!0,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.SPECULAR_WEIGHT_IN_ALPHA=!1,this.SPECULAR_WEIGHT_FROM_SPECULAR_COLOR_TEXTURE=!1,this.SPECULAR_ROUGHNESS_ANISOTROPY_FROM_TANGENT_TEXTURE=!1,this.COAT_ROUGHNESS_FROM_GREEN_CHANNEL=!1,this.COAT_ROUGHNESS_ANISOTROPY_FROM_TANGENT_TEXTURE=!1,this.USE_GLTF_STYLE_ANISOTROPY=!1,this.THIN_FILM_THICKNESS_FROM_THIN_FILM_TEXTURE=!1,this.FUZZ_ROUGHNESS_FROM_TEXTURE_ALPHA=!1,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.FUZZENVIRONMENTBRDF=!1,this.NORMAL=!1,this.TANGENT=!1,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.ANISOTROPIC=!1,this.ANISOTROPIC_OPENPBR=!0,this.ANISOTROPIC_BASE=!1,this.ANISOTROPIC_COAT=!1,this.FUZZ_IBL_SAMPLES=6,this.FUZZ=!1,this.THIN_FILM=!1,this.IRIDESCENCE=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.CLUSTLIGHT_SLICES=0,this.CLUSTLIGHT_BATCH=0,this.BRDF_V_HEIGHT_CORRELATED=!0,this.MS_BRDF_ENERGY_CONSERVATION=!0,this.SPHERICAL_HARMONICS=!0,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!0,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=1,this.CONDUCTOR_SPECULAR_MODEL=1,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.NORMALXYSCALE=!0}}class Me extends ye(Fe){}class s extends Me{get geometryTangentAngle(){return Math.atan2(this.geometryTangent.y,this.geometryTangent.x)}set geometryTangentAngle(t){this.geometryTangent=new b(Math.cos(t),Math.sin(t))}get geometryCoatTangentAngle(){return Math.atan2(this.geometryCoatTangent.y,this.geometryCoatTangent.x)}set geometryCoatTangentAngle(t){this.geometryCoatTangent=new b(Math.cos(t),Math.sin(t))}get usePhysicalLightFalloff(){return this._lightFalloff===R.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(t){t!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),t?this._lightFalloff=R.LIGHTFALLOFF_PHYSICAL:this._lightFalloff=R.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===R.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(t){t!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),t?this._lightFalloff=R.LIGHTFALLOFF_GLTF:this._lightFalloff=R.LIGHTFALLOFF_STANDARD)}get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(t){this._realTimeFiltering=t,this.markAsDirty(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(t){this._realTimeFilteringQuality=t,this.markAsDirty(1)}get fuzzSampleNumber(){return this._fuzzSampleNumber}set fuzzSampleNumber(t){this._fuzzSampleNumber=t,this.markAsDirty(1)}get canRenderToMRT(){return!0}constructor(t,r,e=!1){super(t,r,void 0,e||s.ForceGLSL),this._baseWeight=new A("base_weight",1,"vBaseWeight",1),this._baseWeightTexture=new p("base_weight","baseWeight","BASE_WEIGHT"),this._baseColor=new A("base_color",P.White(),"vBaseColor",4),this._baseColorTexture=new p("base_color","baseColor","BASE_COLOR"),this._baseDiffuseRoughness=new A("base_diffuse_roughness",0,"vBaseDiffuseRoughness",1),this._baseDiffuseRoughnessTexture=new p("base_diffuse_roughness","baseDiffuseRoughness","BASE_DIFFUSE_ROUGHNESS"),this._baseMetalness=new A("base_metalness",0,"vReflectanceInfo",4,0),this._baseMetalnessTexture=new p("base_metalness","baseMetalness","BASE_METALNESS"),this._specularWeight=new A("specular_weight",1,"vReflectanceInfo",4,3),this._specularWeightTexture=new p("specular_weight","specularWeight","SPECULAR_WEIGHT"),this._specularColor=new A("specular_color",P.White(),"vSpecularColor",4),this._specularColorTexture=new p("specular_color","specularColor","SPECULAR_COLOR"),this._specularRoughness=new A("specular_roughness",.3,"vReflectanceInfo",4,1),this._specularRoughnessTexture=new p("specular_roughness","specularRoughness","SPECULAR_ROUGHNESS"),this._specularRoughnessAnisotropy=new A("specular_roughness_anisotropy",0,"vSpecularAnisotropy",3,2),this._specularRoughnessAnisotropyTexture=new p("specular_roughness_anisotropy","specularRoughnessAnisotropy","SPECULAR_ROUGHNESS_ANISOTROPY"),this._specularIor=new A("specular_ior",1.5,"vReflectanceInfo",4,2),this._coatWeight=new A("coat_weight",0,"vCoatWeight",1,0),this._coatWeightTexture=new p("coat_weight","coatWeight","COAT_WEIGHT"),this._coatColor=new A("coat_color",P.White(),"vCoatColor",3,0),this._coatColorTexture=new p("coat_color","coatColor","COAT_COLOR"),this._coatRoughness=new A("coat_roughness",0,"vCoatRoughness",1,0),this._coatRoughnessTexture=new p("coat_roughness","coatRoughness","COAT_ROUGHNESS"),this._coatRoughnessAnisotropy=new A("coat_roughness_anisotropy",0,"vCoatRoughnessAnisotropy",1),this._coatRoughnessAnisotropyTexture=new p("coat_roughness_anisotropy","coatRoughnessAnisotropy","COAT_ROUGHNESS_ANISOTROPY"),this._coatIor=new A("coat_ior",1.5,"vCoatIor",1,0),this._coatDarkening=new A("coat_darkening",1,"vCoatDarkening",1,0),this._coatDarkeningTexture=new p("coat_darkening","coatDarkening","COAT_DARKENING"),this.useCoatRoughnessFromWeightTexture=!1,this._fuzzWeight=new A("fuzz_weight",0,"vFuzzWeight",1,0),this._fuzzWeightTexture=new p("fuzz_weight","fuzzWeight","FUZZ_WEIGHT"),this._fuzzColor=new A("fuzz_color",P.White(),"vFuzzColor",3,0),this._fuzzColorTexture=new p("fuzz_color","fuzzColor","FUZZ_COLOR"),this._fuzzRoughness=new A("fuzz_roughness",.5,"vFuzzRoughness",1,0),this._fuzzRoughnessTexture=new p("fuzz_roughness","fuzzRoughness","FUZZ_ROUGHNESS"),this._geometryNormalTexture=new p("geometry_normal","geometryNormal","GEOMETRY_NORMAL"),this._geometryTangent=new A("geometry_tangent",new b(1,0),"vSpecularAnisotropy",3,0),this._geometryTangentTexture=new p("geometry_tangent","geometryTangent","GEOMETRY_TANGENT"),this._geometryCoatNormalTexture=new p("geometry_coat_normal","geometryCoatNormal","GEOMETRY_COAT_NORMAL"),this._geometryCoatTangent=new A("geometry_coat_tangent",new b(1,0),"vGeometryCoatTangent",2,0),this._geometryCoatTangentTexture=new p("geometry_coat_tangent","geometryCoatTangent","GEOMETRY_COAT_TANGENT"),this._geometryOpacity=new A("geometry_opacity",1,"vBaseColor",4,3),this._geometryOpacityTexture=new p("geometry_opacity","geometryOpacity","GEOMETRY_OPACITY"),this._emissionLuminance=new A("emission_luminance",1,"vLightingIntensity",4,1),this._emissionColor=new A("emission_color",P.Black(),"vEmissionColor",3),this._emissionColorTexture=new p("emission_color","emissionColor","EMISSION_COLOR"),this._thinFilmWeight=new A("thin_film_weight",0,"vThinFilmWeight",1,0),this._thinFilmWeightTexture=new p("thin_film_weight","thinFilmWeight","THIN_FILM_WEIGHT"),this._thinFilmThickness=new A("thin_film_thickness",.5,"vThinFilmThickness",2,0),this._thinFilmThicknessMin=new A("thin_film_thickness_min",0,"vThinFilmThickness",2,1),this._thinFilmThicknessTexture=new p("thin_film_thickness","thinFilmThickness","THIN_FILM_THICKNESS"),this._thinFilmIor=new A("thin_film_ior",1.4,"vThinFilmIor",1,0),this._ambientOcclusionTexture=new p("ambient_occlusion","ambientOcclusion","AMBIENT_OCCLUSION"),this._uniformsList={},this._samplersList={},this._samplerDefines={},this.directIntensity=1,this.environmentIntensity=1,this.useSpecularWeightFromTextureAlpha=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._lightingInfos=new Y(this.directIntensity,1,this.environmentIntensity,1),this._radianceTexture=null,this._useSpecularWeightFromAlpha=!1,this._useSpecularWeightFromSpecularColorTexture=!1,this._useSpecularRoughnessAnisotropyFromTangentTexture=!1,this._useCoatRoughnessAnisotropyFromTangentTexture=!1,this._useCoatRoughnessFromGreenChannel=!1,this._useGltfStyleAnisotropy=!1,this._useFuzzRoughnessFromTextureAlpha=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromBaseColorTexture=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallicFromMetallicTextureBlue=!1,this._useThinFilmThicknessFromTextureGreen=!1,this._lightFalloff=R.LIGHTFALLOFF_PHYSICAL,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._environmentFuzzBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._fuzzSampleNumber=4,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._renderTargets=new Z(16),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this._transparencyMode=R.MATERIAL_OPAQUE,this.getScene()&&!this.getScene()?.getEngine().isWebGPU&&this.getScene().getEngine().webGLVersion<2&&C.Error("OpenPBRMaterial: WebGL 2.0 or above is required for this material."),s._noiseTextures[this.getScene().uniqueId]||(s._noiseTextures[this.getScene().uniqueId]=new K("https://assets.babylonjs.com/textures/blue_noise/blue_noise_rgb.png",this.getScene(),!1,!0,1),this.getScene().onDisposeObservable.addOnce(()=>{s._noiseTextures[this.getScene().uniqueId]?.dispose(),delete s._noiseTextures[this.getScene().uniqueId]})),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),O.ReflectionTextureEnabled&&this._radianceTexture&&this._radianceTexture.isRenderTarget&&this._renderTargets.push(this._radianceTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=j(this.getScene()),this._environmentFuzzBRDFTexture=G(this.getScene()),this.prePassConfiguration=new z,this._propertyList={};for(const n of Object.getOwnPropertyNames(this)){const u=this[n];u instanceof A&&(this._propertyList[n]=u)}Object.keys(this._propertyList).forEach(n=>{const u=this._propertyList[n];let T=this._uniformsList[u.targetUniformName];T?T.numComponents!==u.targetUniformComponentNum&&C.Error(`Uniform ${u.targetUniformName} already exists of size ${T.numComponents}, but trying to set it to ${u.targetUniformComponentNum}.`):(T=new N(u.targetUniformName,u.targetUniformComponentNum),this._uniformsList[u.targetUniformName]=T),T.linkedProperties[u.name]=u}),this._samplersList={};for(const n of Object.getOwnPropertyNames(this)){const u=this[n];u instanceof p&&(this._samplersList[n]=u)}for(const n in this._samplersList){const T=this._samplersList[n].textureDefine;this._samplerDefines[T]={type:"boolean",default:!1},this._samplerDefines[T+"DIRECTUV"]={type:"number",default:0},this._samplerDefines[T+"_GAMMA"]={type:"boolean",default:!1}}this._baseWeight,this._baseWeightTexture,this._baseColor,this._baseColorTexture,this._baseDiffuseRoughness,this._baseDiffuseRoughnessTexture,this._baseMetalness,this._baseMetalnessTexture,this._specularWeight,this._specularWeightTexture,this._specularColor,this._specularColorTexture,this._specularRoughness,this._specularIor,this._specularRoughnessTexture,this._specularRoughnessAnisotropy,this._specularRoughnessAnisotropyTexture,this._coatWeight,this._coatWeightTexture,this._coatColor,this._coatColorTexture,this._coatRoughness,this._coatRoughnessTexture,this._coatRoughnessAnisotropy,this._coatRoughnessAnisotropyTexture,this._coatIor,this._coatDarkening,this._coatDarkeningTexture,this._fuzzWeight,this._fuzzWeightTexture,this._fuzzColor,this._fuzzColorTexture,this._fuzzRoughness,this._fuzzRoughnessTexture,this._geometryNormalTexture,this._geometryTangent,this._geometryTangentTexture,this._geometryCoatNormalTexture,this._geometryCoatTangent,this._geometryCoatTangentTexture,this._geometryOpacity,this._geometryOpacityTexture,this._thinFilmWeight,this._thinFilmWeightTexture,this._thinFilmThickness,this._thinFilmThicknessMin,this._thinFilmThicknessTexture,this._thinFilmIor,this._emissionLuminance,this._emissionColor,this._emissionColorTexture,this._ambientOcclusionTexture}get hasRenderTargetTextures(){return O.ReflectionTextureEnabled&&this._radianceTexture&&this._radianceTexture.isRenderTarget?!0:this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"OpenPBRMaterial"}get transparencyMode(){return this._transparencyMode}set transparencyMode(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._markAllSubMeshesAsTexturesAndMiscDirty())}_shouldUseAlphaFromBaseColorTexture(){return this._hasAlphaChannel()&&this._transparencyMode!==R.MATERIAL_OPAQUE&&!this.geometryOpacityTexture}_hasAlphaChannel(){return this.baseColorTexture!=null&&this.baseColorTexture.hasAlpha&&this._useAlphaFromBaseColorTexture||this.geometryOpacityTexture!=null}clone(t,r=!0,e=""){const a=w.Clone(()=>new s(t,this.getScene()),this,{cloneTexturesOnlyOnce:r});return a.id=t,a.name=t,this.stencil.copyTo(a.stencil),this._clonePlugins(a,e),a}serialize(){const t=super.serialize();return t.customType="BABYLON.OpenPBRMaterial",t}static Parse(t,r,e){const a=w.Parse(()=>new s(t.name,r),t,r,e);return t.stencil&&a.stencil.parse(t.stencil,r,e),R._ParsePlugins(t,a,r,e),a}forceCompilation(t,r,e){const a={clipPlane:!1,useInstances:!1,...e};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo),(()=>{if(this._breakShaderLoadedCheck)return;const u=new V({...this._eventInfo.defineNames||{},...this._samplerDefines||{}}),T=this._prepareEffect(t,t,u,void 0,void 0,a.useInstances,a.clipPlane);this._onEffectCreatedObservable&&(d.effect=T,d.subMesh=null,this._onEffectCreatedObservable.notifyObservers(d)),T.isReady()?r&&r(this):T.onCompileObservable.add(()=>{r&&r(this)})})()}isReadyForSubMesh(t,r,e){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const a=r._drawWrapper;if(a.effect&&this.isFrozen&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===e)return!0;r.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),r.materialDefines=new V({...this._eventInfo.defineNames||{},...this._samplerDefines||{}}));const n=r.materialDefines;if(this._isReadyForSubMesh(r))return!0;const u=this.getScene(),T=u.getEngine();if(n._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,u.texturesEnabled)){for(const m in this._samplersList){const E=this._samplersList[m];if(E.value&&!E.value.isReadyOrNotBlocking())return!1}const h=this._getRadianceTexture();if(h&&O.ReflectionTextureEnabled){if(!h.isReadyOrNotBlocking())return!1;if(h.irradianceTexture){if(!h.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!h.sphericalPolynomial&&h.getInternalTexture()?._sphericalPolynomialPromise)return!1}if(this._environmentBRDFTexture&&O.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady()||this._environmentFuzzBRDFTexture&&O.ReflectionTextureEnabled&&!this._environmentFuzzBRDFTexture.isReady()||s._noiseTextures[u.uniqueId]&&!s._noiseTextures[u.uniqueId].isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=n,this._eventInfo.subMesh=r,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh||n._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(n.AREALIGHTUSED){for(let h=0;h<t.lightSources.length;h++)if(!t.lightSources[h]._isReady())return!1}!T.getCaps().standardDerivatives&&!t.isVerticesDataPresent(y.NormalKind)&&(t.createNormals(!0),C.Warn("OpenPBRMaterial: Normals have been created for the mesh: "+t.name));const g=r.effect,S=n._areLightsDisposed;let _=this._prepareEffect(t,r.getRenderingMesh(),n,this.onCompiled,this.onError,e,null),l=!1;if(_)if(this._onEffectCreatedObservable&&(d.effect=_,d.subMesh=r,this._onEffectCreatedObservable.notifyObservers(d)),this.allowShaderHotSwapping&&g&&!_.isReady()){if(_=g,n.markAsUnprocessed(),l=this.isFrozen,S)return n._areLightsDisposed=!0,!1}else u.resetCachedMaterial(),r.setEffect(_,n,this._materialContext);return!r.effect||!r.effect.isReady()?!1:(n._renderId=u.getRenderId(),a._wasPreviouslyReady=!l,a._wasPreviouslyUsingInstances=!!e,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const t=this._uniformBuffer;t.addUniform("vTangentSpaceParams",2),t.addUniform("vLightingIntensity",4),t.addUniform("pointSize",1),t.addUniform("vDebugMode",2),t.addUniform("cameraInfo",4),Q(t,!0,!0,!0,!0,!0),Object.values(this._uniformsList).forEach(r=>{t.addUniform(r.name,r.numComponents)}),Object.values(this._samplersList).forEach(r=>{t.addUniform(r.samplerInfoName,2),t.addUniform(r.samplerMatrixName,16)}),super.buildUniformLayout()}bindForSubMesh(t,r,e){const a=this.getScene(),n=e.materialDefines;if(!n)return;const u=e.effect;if(!u)return;this._activeEffect=u,r.getMeshUniformBuffer().bindToEffect(u,"Mesh"),r.transferToEffect(t);const T=a.getEngine();this._uniformBuffer.bindToEffect(u,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,r,t,this.isFrozen),U.Bind(T.currentRenderPassId,this._activeEffect,r,t,this);const g=a.activeCamera;g?this._uniformBuffer.updateFloat4("cameraInfo",g.minZ,g.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=e,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),n.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(a,u,e,r.visibility);q(r,this._activeEffect,this.prePassConfiguration);let _=null;const l=this._uniformBuffer;if(S){if(this.bindViewProjection(u),_=this._getRadianceTexture(),!l.useUbo||!this.isFrozen||!l.isSync||e._drawWrapper._forceRebindOnNextCall){if(a.texturesEnabled){for(const h in this._samplersList){const m=this._samplersList[h];m.value&&(l.updateFloat2(m.samplerInfoName,m.value.coordinatesIndex,m.value.level),$(m.value,l,m.samplerPrefix))}this.geometryNormalTexture&&(a._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),J(a,n,l,P.White(),_,this.realTimeFiltering,!0,!0,!0,!0,!0)}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),Object.values(this._uniformsList).forEach(h=>{h.numComponents===4?(h.populateVectorFromLinkedProperties(F.Vector4[0]),l.updateVector4(h.name,F.Vector4[0])):h.numComponents===3?(h.populateVectorFromLinkedProperties(F.Vector3[0]),l.updateVector3(h.name,F.Vector3[0])):h.numComponents===2?(h.populateVectorFromLinkedProperties(F.Vector2[0]),l.updateFloat2(h.name,F.Vector2[0].x,F.Vector2[0].y)):h.numComponents===1&&l.updateFloat(h.name,h.linkedProperties[Object.keys(h.linkedProperties)[0]].value)}),this._lightingInfos.x=this.directIntensity,this._lightingInfos.y=this.emissionLuminance,this._lightingInfos.z=this.environmentIntensity*a.environmentIntensity,this._lightingInfos.w=1,l.updateVector4("vLightingIntensity",this._lightingInfos),l.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(a.texturesEnabled){for(const h in this._samplersList){const m=this._samplersList[h];m.value&&l.setTexture(m.samplerName,m.value)}ee(a,n,l,_,this.realTimeFiltering),n.ENVIRONMENTBRDF&&l.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),n.FUZZENVIRONMENTBRDF&&l.setTexture("environmentFuzzBrdfSampler",this._environmentFuzzBRDFTexture),(n.ANISOTROPIC||n.FUZZ)&&l.setTexture("blueNoiseSampler",s._noiseTextures[this.getScene().uniqueId])}this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(r)&&this.getScene().depthPeelingRenderer.bind(u),this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),te(this._activeEffect,this,a),this.bindEyePosition(u)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(S||!this.isFrozen)&&(a.lightsEnabled&&!this._disableLighting&&se(a,r,this._activeEffect,n,this._maxSimultaneousLights),(a.fogEnabled&&r.applyFog&&a.fogMode!==ie.FOGMODE_NONE||_||r.receiveShadows||n.PREPASS)&&this.bindView(u),re(a,r,this._activeEffect,!0),n.NUM_MORPH_INFLUENCERS&&ae(r,this._activeEffect),n.BAKED_VERTEX_ANIMATION_TEXTURE&&r.bakedVertexAnimationManager?.bind(u,n.INSTANCES),this._imageProcessingConfiguration.bind(this._activeEffect),oe(n,this._activeEffect,a)),this._afterBind(r,this._activeEffect,e),l.update()}getAnimatables(){const t=super.getAnimatables();for(const r in this._samplersList){const e=this._samplersList[r];e.value&&e.value.animations&&e.value.animations.length>0&&t.push(e.value)}return this._radianceTexture&&this._radianceTexture.animations&&this._radianceTexture.animations.length>0&&t.push(this._radianceTexture),t}getActiveTextures(){const t=super.getActiveTextures();for(const r in this._samplersList){const e=this._samplersList[r];e.value&&t.push(e.value)}return this._radianceTexture&&t.push(this._radianceTexture),t}hasTexture(t){if(super.hasTexture(t))return!0;for(const r in this._samplersList)if(this._samplersList[r].value===t)return!0;return this._radianceTexture===t}setPrePassRenderer(){return!1}dispose(t,r){if(this._breakShaderLoadedCheck=!0,r){this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._environmentFuzzBRDFTexture&&this.getScene().environmentFuzzBRDFTexture!==this._environmentFuzzBRDFTexture&&this._environmentFuzzBRDFTexture.dispose();for(const e in this._samplersList)this._samplersList[e].value?.dispose();this._radianceTexture?.dispose()}this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(t,r)}_getRadianceTexture(){return this._radianceTexture?this._radianceTexture:this.getScene().environmentTexture}_prepareEffect(t,r,e,a=null,n=null,u=null,T=null){if(this._prepareDefines(t,r,e,u,T),!e.isDirty)return null;e.markAsProcessed();const S=this.getScene().getEngine(),_=new ne;let l=0;e.USESPHERICALINVERTEX&&_.addFallback(l++,"USESPHERICALINVERTEX"),e.FOG&&_.addFallback(l,"FOG"),e.SPECULARAA&&_.addFallback(l,"SPECULARAA"),e.POINTSIZE&&_.addFallback(l,"POINTSIZE"),e.LOGARITHMICDEPTH&&_.addFallback(l,"LOGARITHMICDEPTH"),e.PARALLAX&&_.addFallback(l,"PARALLAX"),e.PARALLAX_RHS&&_.addFallback(l,"PARALLAX_RHS"),e.PARALLAXOCCLUSION&&_.addFallback(l++,"PARALLAXOCCLUSION"),e.ENVIRONMENTBRDF&&_.addFallback(l++,"ENVIRONMENTBRDF"),e.TANGENT&&_.addFallback(l++,"TANGENT"),l=le(e,_,this._maxSimultaneousLights,l++),e.SPECULARTERM&&_.addFallback(l++,"SPECULARTERM"),e.USESPHERICALFROMREFLECTIONMAP&&_.addFallback(l++,"USESPHERICALFROMREFLECTIONMAP"),e.USEIRRADIANCEMAP&&_.addFallback(l++,"USEIRRADIANCEMAP"),e.NORMAL&&_.addFallback(l++,"NORMAL"),e.VERTEXCOLOR&&_.addFallback(l++,"VERTEXCOLOR"),e.MORPHTARGETS&&_.addFallback(l++,"MORPHTARGETS"),e.MULTIVIEW&&_.addFallback(0,"MULTIVIEW");const h=[y.PositionKind];e.NORMAL&&h.push(y.NormalKind),e.TANGENT&&h.push(y.TangentKind);for(let I=1;I<=6;++I)e["UV"+I]&&h.push(`uv${I===1?"":I}`);e.VERTEXCOLOR&&h.push(y.ColorKind),he(h,t,e,_),ue(h,e),_e(h,t,e),Te(h,t,e);let m="openpbr";const E=["world","view","viewProjection","vEyePosition","vLightsType","visibility","vFogInfos","vFogColor","pointSize","mBones","normalMatrix","vLightingIntensity","logarithmicDepthConstant","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"];for(const I in this._uniformsList)E.push(I);const L=["environmentBrdfSampler","blueNoiseSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"];e.FUZZENVIRONMENTBRDF&&L.push("environmentFuzzBrdfSampler");for(const I in this._samplersList){const v=this._samplersList[I];L.push(v.samplerName),E.push(v.samplerInfoName),E.push(v.samplerMatrixName)}Ae(E,L,!0);const M=["Material","Scene","Mesh"],H={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:e.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=_,this._eventInfo.fallbackRank=l,this._eventInfo.defines=e,this._eventInfo.uniforms=E,this._eventInfo.attributes=h,this._eventInfo.samplers=L,this._eventInfo.uniformBuffersNames=M,this._eventInfo.customCode=void 0,this._eventInfo.mesh=t,this._eventInfo.indexParameters=H,this._callbackPluginEventGeneric(128,this._eventInfo),U.AddUniformsAndSamplers(E,L),z.AddUniforms(E),fe(E),k&&(k.PrepareUniforms(E,e),k.PrepareSamplers(L,e)),ce({uniformsNames:E,uniformBuffersNames:M,samplers:L,defines:e,maxSimultaneousLights:this._maxSimultaneousLights});const B={};this.customShaderNameResolve&&(m=this.customShaderNameResolve(m,E,M,L,e,h,B));const W=e.toString(),X=S.createEffect(m,{attributes:h,uniformsNames:E,uniformBuffersNames:M,samplers:L,defines:W,fallbacks:_,onCompiled:a,onError:n,indexParameters:H,processFinalCode:B.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:e.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{this.shaderLanguage===1?await Promise.all([D(()=>import("./openpbr.vertex-CeU_J4uE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url),D(()=>import("./openpbr.fragment-C1qVV8-V.js"),__vite__mapDeps([21,1,2,3,22,4,5,6,23,8,24,25,26,27,19,28,9,29,14,10]),import.meta.url)]):await Promise.all([D(()=>import("./openpbr.vertex-B0TtyyxN.js"),__vite__mapDeps([30,1,2,3,31,32,33,34,35,36,37,38,39,40,41]),import.meta.url),D(()=>import("./openpbr.fragment-D9xPxzD1.js"),__vite__mapDeps([42,1,2,3,43,32,33,34,44,35,45,46,47,41,48,36,49,38,37]),import.meta.url)]),this._shadersLoaded=!0}},S);return this._eventInfo.customCode=void 0,X}_prepareDefines(t,r,e,a=null,n=null){const u=r.hasThinInstances,T=this.getScene(),g=T.getEngine();pe(T,t,e,!0,this._maxSimultaneousLights,this._disableLighting),e._needNormals=!0,me(T,e);const S=this.needAlphaBlendingForMesh(t)&&this.getScene().useOrderIndependentTransparency;if(Ee(T,e,this.canRenderToMRT&&!S),Re(T,e,S),U.PrepareDefines(g.currentRenderPassId,t,e),e.METALLICWORKFLOW=!0,e._areTexturesDirty){e._needUVs=!1;for(let _=1;_<=6;++_)e["MAINUV"+_]=!1;if(T.texturesEnabled){for(const h in this._samplersList){const m=this._samplersList[h];m.value?(ge(m.value,e,m.textureDefine),e[m.textureDefine+"_GAMMA"]=m.value.gammaSpace):e[m.textureDefine]=!1}const _=this._getRadianceTexture(),l=this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||g.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture!=null;Se(T,_,e,this.realTimeFiltering,this.realTimeFilteringQuality,!l),this._baseMetalnessTexture&&(e.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed),e.SPECULAR_WEIGHT_IN_ALPHA=this._useSpecularWeightFromAlpha,e.SPECULAR_WEIGHT_FROM_SPECULAR_COLOR_TEXTURE=this._useSpecularWeightFromSpecularColorTexture,e.SPECULAR_ROUGHNESS_ANISOTROPY_FROM_TANGENT_TEXTURE=this._useSpecularRoughnessAnisotropyFromTangentTexture,e.COAT_ROUGHNESS_ANISOTROPY_FROM_TANGENT_TEXTURE=this._useCoatRoughnessAnisotropyFromTangentTexture,e.COAT_ROUGHNESS_FROM_GREEN_CHANNEL=this._useCoatRoughnessFromGreenChannel,e.ROUGHNESSSTOREINMETALMAPGREEN=this._useRoughnessFromMetallicTextureGreen,e.FUZZ_ROUGHNESS_FROM_TEXTURE_ALPHA=this._useFuzzRoughnessFromTextureAlpha,e.METALLNESSSTOREINMETALMAPBLUE=this._useMetallicFromMetallicTextureBlue,e.THIN_FILM_THICKNESS_FROM_THIN_FILM_TEXTURE=this._useThinFilmThicknessFromTextureGreen,this.geometryNormalTexture?(this._useParallax&&this.baseColorTexture&&O.DiffuseTextureEnabled?(e.PARALLAX=!0,e.PARALLAX_RHS=T.useRightHandedSystem,e.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):e.PARALLAX=!1,e.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(e.PARALLAX=!1,e.PARALLAX_RHS=!1,e.PARALLAXOCCLUSION=!1,e.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&O.ReflectionTextureEnabled?(e.ENVIRONMENTBRDF=!0,e.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(e.ENVIRONMENTBRDF=!1,e.ENVIRONMENTBRDF_RGBD=!1),this._environmentFuzzBRDFTexture?e.FUZZENVIRONMENTBRDF=!0:e.FUZZENVIRONMENTBRDF=!1,this._shouldUseAlphaFromBaseColorTexture()?e.ALPHA_FROM_BASE_COLOR_TEXTURE=!0:e.ALPHA_FROM_BASE_COLOR_TEXTURE=!1}this._lightFalloff===R.LIGHTFALLOFF_STANDARD?(e.USEPHYSICALLIGHTFALLOFF=!1,e.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===R.LIGHTFALLOFF_GLTF?(e.USEPHYSICALLIGHTFALLOFF=!1,e.USEGLTFLIGHTFALLOFF=!0):(e.USEPHYSICALLIGHTFALLOFF=!0,e.USEGLTFLIGHTFALLOFF=!1),!this.backFaceCulling&&this._twoSidedLighting?e.TWOSIDEDLIGHTING=!0:e.TWOSIDEDLIGHTING=!1,e.MIRRORED=!!T._mirroredCameraPosition,e.SPECULARAA=g.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(e._areTexturesDirty||e._areMiscDirty)&&(e.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,e.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,e.ALPHABLEND=this.needAlphaBlendingForMesh(t)),e._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(e),e.FORCENORMALFORWARD=this._forceNormalForward,e.RADIANCEOCCLUSION=this._useRadianceOcclusion,e.HORIZONOCCLUSION=this._useHorizonOcclusion,(this.specularRoughnessAnisotropy>0||this.coatRoughnessAnisotropy>0)&&s._noiseTextures[T.uniqueId]&&O.ReflectionTextureEnabled?(e.ANISOTROPIC=!0,t.isVerticesDataPresent(y.TangentKind)||(e._needUVs=!0,e.MAINUV1=!0),this._useGltfStyleAnisotropy&&(e.USE_GLTF_STYLE_ANISOTROPY=!0),e.ANISOTROPIC_BASE=this.specularRoughnessAnisotropy>0,e.ANISOTROPIC_COAT=this.coatRoughnessAnisotropy>0):(e.ANISOTROPIC=!1,e.USE_GLTF_STYLE_ANISOTROPY=!1,e.ANISOTROPIC_BASE=!1,e.ANISOTROPIC_COAT=!1),e.THIN_FILM=this.thinFilmWeight>0,e.IRIDESCENCE=this.thinFilmWeight>0,e.FUZZ=this.fuzzWeight>0&&O.ReflectionTextureEnabled,e.FUZZ?(t.isVerticesDataPresent(y.TangentKind)||(e._needUVs=!0,e.MAINUV1=!0),this._environmentFuzzBRDFTexture=G(this.getScene()),e.FUZZ_IBL_SAMPLES=this.fuzzSampleNumber):(this._environmentFuzzBRDFTexture=null,e.FUZZENVIRONMENTBRDF=!1,e.FUZZ_IBL_SAMPLES=0),e._areMiscDirty&&(Le(t,T,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(t),e,this._applyDecalMapAfterDetailMap,this._useVertexPulling,r,this._isVertexOutputInvariant),e.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!t.isVerticesDataPresent(y.NormalKind),e.DEBUGMODE=this._debugMode),Ie(T,g,this,e,!!a,n,u),this._eventInfo.defines=e,this._eventInfo.mesh=t,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Oe(t,e,!0,!0,!0,this._transparencyMode!==R.MATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}}s._noiseTextures={};s.ForceGLSL=!1;i([o("_markAllSubMeshesAsTexturesDirty","baseWeight")],s.prototype,"_baseWeight",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseWeightTexture")],s.prototype,"_baseWeightTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseColor")],s.prototype,"_baseColor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseColorTexture")],s.prototype,"_baseColorTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseDiffuseRoughness")],s.prototype,"_baseDiffuseRoughness",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseDiffuseRoughnessTexture")],s.prototype,"_baseDiffuseRoughnessTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseMetalness")],s.prototype,"_baseMetalness",void 0);i([o("_markAllSubMeshesAsTexturesDirty","baseMetalnessTexture")],s.prototype,"_baseMetalnessTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularWeight")],s.prototype,"_specularWeight",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularWeightTexture")],s.prototype,"_specularWeightTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularColor")],s.prototype,"_specularColor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularColorTexture")],s.prototype,"_specularColorTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularRoughness")],s.prototype,"_specularRoughness",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularRoughnessTexture")],s.prototype,"_specularRoughnessTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularRoughnessAnisotropy")],s.prototype,"_specularRoughnessAnisotropy",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularRoughnessAnisotropyTexture")],s.prototype,"_specularRoughnessAnisotropyTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","specularIor")],s.prototype,"_specularIor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatWeight")],s.prototype,"_coatWeight",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatWeightTexture")],s.prototype,"_coatWeightTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatColor")],s.prototype,"_coatColor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatColorTexture")],s.prototype,"_coatColorTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatRoughness")],s.prototype,"_coatRoughness",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatRoughnessTexture")],s.prototype,"_coatRoughnessTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatRoughnessAnisotropy")],s.prototype,"_coatRoughnessAnisotropy",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatRoughnessAnisotropyTexture")],s.prototype,"_coatRoughnessAnisotropyTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatIor")],s.prototype,"_coatIor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatDarkening")],s.prototype,"_coatDarkening",void 0);i([o("_markAllSubMeshesAsTexturesDirty","coatDarkeningTexture")],s.prototype,"_coatDarkeningTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","fuzzWeight")],s.prototype,"_fuzzWeight",void 0);i([o("_markAllSubMeshesAsTexturesDirty","fuzzWeightTexture")],s.prototype,"_fuzzWeightTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","fuzzColor")],s.prototype,"_fuzzColor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","fuzzColorTexture")],s.prototype,"_fuzzColorTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","fuzzRoughness")],s.prototype,"_fuzzRoughness",void 0);i([o("_markAllSubMeshesAsTexturesDirty","fuzzRoughnessTexture")],s.prototype,"_fuzzRoughnessTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryNormalTexture")],s.prototype,"_geometryNormalTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryTangent")],s.prototype,"_geometryTangent",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryTangentTexture")],s.prototype,"_geometryTangentTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryCoatNormalTexture")],s.prototype,"_geometryCoatNormalTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryCoatTangent")],s.prototype,"_geometryCoatTangent",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryCoatTangentTexture")],s.prototype,"_geometryCoatTangentTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryOpacity")],s.prototype,"_geometryOpacity",void 0);i([o("_markAllSubMeshesAsTexturesDirty","geometryOpacityTexture")],s.prototype,"_geometryOpacityTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","emissionLuminance")],s.prototype,"_emissionLuminance",void 0);i([o("_markAllSubMeshesAsTexturesDirty","emissionColor")],s.prototype,"_emissionColor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","emissionColorTexture")],s.prototype,"_emissionColorTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","thinFilmWeight")],s.prototype,"_thinFilmWeight",void 0);i([o("_markAllSubMeshesAsTexturesDirty","thinFilmWeightTexture")],s.prototype,"_thinFilmWeightTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","thinFilmThickness")],s.prototype,"_thinFilmThickness",void 0);i([o("_markAllSubMeshesAsTexturesDirty","thinFilmThicknessMin")],s.prototype,"_thinFilmThicknessMin",void 0);i([o("_markAllSubMeshesAsTexturesDirty","thinFilmThicknessTexture")],s.prototype,"_thinFilmThicknessTexture",void 0);i([o("_markAllSubMeshesAsTexturesDirty","thinFilmIor")],s.prototype,"_thinFilmIor",void 0);i([o("_markAllSubMeshesAsTexturesDirty","ambientOcclusionTexture")],s.prototype,"_ambientOcclusionTexture",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"directIntensity",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"environmentIntensity",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useSpecularWeightFromTextureAlpha",void 0);i([f(),c("_markAllSubMeshesAsTexturesAndMiscDirty")],s.prototype,"forceAlphaTest",void 0);i([f(),c("_markAllSubMeshesAsTexturesAndMiscDirty")],s.prototype,"alphaCutOff",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAmbientInGrayScale",void 0);i([f()],s.prototype,"usePhysicalLightFalloff",null);i([f()],s.prototype,"useGLTFLightFalloff",null);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useObjectSpaceNormalMap",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useParallax",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useParallaxOcclusion",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"parallaxScaleBias",void 0);i([f(),c("_markAllSubMeshesAsLightsDirty")],s.prototype,"disableLighting",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"forceIrradianceInFragment",void 0);i([f(),c("_markAllSubMeshesAsLightsDirty")],s.prototype,"maxSimultaneousLights",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertNormalMapX",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertNormalMapY",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"twoSidedLighting",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAlphaFresnel",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useLinearAlphaFresnel",void 0);i([c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"environmentBRDFTexture",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"forceNormalForward",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"enableSpecularAntiAliasing",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useHorizonOcclusion",void 0);i([f(),c("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useRadianceOcclusion",void 0);i([f(),c("_markAllSubMeshesAsMiscDirty")],s.prototype,"unlit",void 0);i([f(),c("_markAllSubMeshesAsMiscDirty")],s.prototype,"applyDecalMapAfterDetailMap",void 0);i([c("_markAllSubMeshesAsMiscDirty")],s.prototype,"debugMode",void 0);i([f()],s.prototype,"transparencyMode",null);Ce("BABYLON.OpenPBRMaterial",s);export{s as OpenPBRMaterial,V as OpenPBRMaterialDefines};
