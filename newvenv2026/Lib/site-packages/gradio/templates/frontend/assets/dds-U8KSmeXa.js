import{aU as d,aV as w,aI as O,L as H,aW as At}from"./index-Dtj0WP_z.js";import"./abstractEngine.cubeTexture-DHkQQ0eN.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";const ut=542327876,K=131072,Q=512,Y=4,Z=64,$=131072;function E(_){return _.charCodeAt(0)+(_.charCodeAt(1)<<8)+(_.charCodeAt(2)<<16)+(_.charCodeAt(3)<<24)}function yt(_){return String.fromCharCode(_&255,_>>8&255,_>>16&255,_>>24&255)}const S=E("DXT1"),v=E("DXT3"),tt=E("DXT5"),z=E("DX10"),rt=113,et=116,at=2,ft=10,pt=88,N=31,Ft=0,mt=1,ot=2,st=3,T=4,nt=7,V=20,ct=21,Ct=22,Gt=23,bt=24,Bt=25,Rt=26,_t=28,ht=32;class i{static GetDDSInfo(a){const s=new Int32Array(a.buffer,a.byteOffset,N),o=new Int32Array(a.buffer,a.byteOffset,N+4);let n=1;s[ot]&K&&(n=Math.max(1,s[nt]));const u=s[ct],p=u===z?o[ht]:0;let r=0;switch(u){case rt:r=2;break;case et:r=1;break;case z:if(p===ft){r=2;break}if(p===at){r=1;break}}return{width:s[T],height:s[st],mipmapCount:n,isFourCC:(s[V]&Y)===Y,isRGB:(s[V]&Z)===Z,isLuminance:(s[V]&$)===$,isCube:(s[_t]&Q)===Q,isCompressed:u===S||u===v||u===tt,dxgiFormat:p,textureType:r}}static _GetHalfFloatAsFloatRGBAArrayBuffer(a,s,o,n,u,p){const r=new Float32Array(n),c=new Uint16Array(u,o);let t=0;for(let e=0;e<s;e++)for(let l=0;l<a;l++){const f=(l+e*a)*4;r[t]=d(c[f]),r[t+1]=d(c[f+1]),r[t+2]=d(c[f+2]),i.StoreLODInAlphaChannel?r[t+3]=p:r[t+3]=d(c[f+3]),t+=4}return r}static _GetHalfFloatRGBAArrayBuffer(a,s,o,n,u,p){if(i.StoreLODInAlphaChannel){const r=new Uint16Array(n),c=new Uint16Array(u,o);let t=0;for(let e=0;e<s;e++)for(let l=0;l<a;l++){const f=(l+e*a)*4;r[t]=c[f],r[t+1]=c[f+1],r[t+2]=c[f+2],r[t+3]=w(p),t+=4}return r}return new Uint16Array(u,o,n)}static _GetFloatRGBAArrayBuffer(a,s,o,n,u,p){if(i.StoreLODInAlphaChannel){const r=new Float32Array(n),c=new Float32Array(u,o);let t=0;for(let e=0;e<s;e++)for(let l=0;l<a;l++){const f=(l+e*a)*4;r[t]=c[f],r[t+1]=c[f+1],r[t+2]=c[f+2],r[t+3]=p,t+=4}return r}return new Float32Array(u,o,n)}static _GetFloatAsHalfFloatRGBAArrayBuffer(a,s,o,n,u,p){const r=new Uint16Array(n),c=new Float32Array(u,o);let t=0;for(let e=0;e<s;e++)for(let l=0;l<a;l++)r[t]=w(c[t]),r[t+1]=w(c[t+1]),r[t+2]=w(c[t+2]),i.StoreLODInAlphaChannel?r[t+3]=w(p):r[t+3]=w(c[t+3]),t+=4;return r}static _GetFloatAsUIntRGBAArrayBuffer(a,s,o,n,u,p){const r=new Uint8Array(n),c=new Float32Array(u,o);let t=0;for(let e=0;e<s;e++)for(let l=0;l<a;l++){const f=(l+e*a)*4;r[t]=O(c[f])*255,r[t+1]=O(c[f+1])*255,r[t+2]=O(c[f+2])*255,i.StoreLODInAlphaChannel?r[t+3]=p:r[t+3]=O(c[f+3])*255,t+=4}return r}static _GetHalfFloatAsUIntRGBAArrayBuffer(a,s,o,n,u,p){const r=new Uint8Array(n),c=new Uint16Array(u,o);let t=0;for(let e=0;e<s;e++)for(let l=0;l<a;l++){const f=(l+e*a)*4;r[t]=O(d(c[f]))*255,r[t+1]=O(d(c[f+1]))*255,r[t+2]=O(d(c[f+2]))*255,i.StoreLODInAlphaChannel?r[t+3]=p:r[t+3]=O(d(c[f+3]))*255,t+=4}return r}static _GetRGBAArrayBuffer(a,s,o,n,u,p,r,c,t){const e=new Uint8Array(n),l=new Uint8Array(u,o);let f=0;for(let B=0;B<s;B++)for(let A=0;A<a;A++){const y=(A+B*a)*4;e[f]=l[y+p],e[f+1]=l[y+r],e[f+2]=l[y+c],e[f+3]=l[y+t],f+=4}return e}static _ExtractLongWordOrder(a){return a===0||a===255||a===-16777216?0:1+i._ExtractLongWordOrder(a>>8)}static _GetRGBArrayBuffer(a,s,o,n,u,p,r,c){const t=new Uint8Array(n),e=new Uint8Array(u,o);let l=0;for(let f=0;f<s;f++)for(let B=0;B<a;B++){const A=(B+f*a)*3;t[l]=e[A+p],t[l+1]=e[A+r],t[l+2]=e[A+c],l+=3}return t}static _GetLuminanceArrayBuffer(a,s,o,n,u){const p=new Uint8Array(n),r=new Uint8Array(u,o);let c=0;for(let t=0;t<s;t++)for(let e=0;e<a;e++){const l=e+t*a;p[c]=r[l],c++}return p}static UploadDDSLevels(a,s,o,n,u,p,r=-1,c,t=!0){let e=null;n.sphericalPolynomial&&(e=[]);const l=!!a.getCaps().s3tc;s.generateMipMaps=u;const f=new Int32Array(o.buffer,o.byteOffset,N);let B,A,y,F=0,G,h,X,I,L=0,M=1;if(f[Ft]!==ut){H.Error("Invalid magic number in DDS header");return}if(!n.isFourCC&&!n.isRGB&&!n.isLuminance){H.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(n.isCompressed&&!l){H.Error("Compressed textures are not supported on this platform.");return}let m=f[Ct];G=f[mt]+4;let g=!1;if(n.isFourCC)switch(B=f[ct],B){case S:M=8,L=33777;break;case v:M=16,L=33778;break;case tt:M=16,L=33779;break;case rt:g=!0,m=64;break;case et:g=!0,m=128;break;case z:{G+=20;let b=!1;switch(n.dxgiFormat){case ft:g=!0,m=64,b=!0;break;case at:g=!0,m=128,b=!0;break;case pt:n.isRGB=!0,n.isFourCC=!1,m=32,b=!0;break}if(b)break}default:H.Error(["Unsupported FourCC code:",yt(B)]);return}const j=i._ExtractLongWordOrder(f[Gt]),q=i._ExtractLongWordOrder(f[bt]),J=i._ExtractLongWordOrder(f[Bt]),lt=i._ExtractLongWordOrder(f[Rt]);g&&(L=a._getRGBABufferInternalSizedFormat(n.textureType)),X=1,f[ot]&K&&u!==!1&&(X=Math.max(1,f[nt]));const it=c||0,k=a.getCaps();for(let b=it;b<p;b++){for(A=f[T],y=f[st],I=0;I<X;++I){if(r===-1||r===I){const C=r===-1?I:0;if(!n.isCompressed&&n.isFourCC){s.format=5,F=A*y*4;let R=null;if(a._badOS||a._badDesktopOS||!k.textureHalfFloat&&!k.textureFloat)m===128?(R=i._GetFloatAsUIntRGBAArrayBuffer(A,y,o.byteOffset+G,F,o.buffer,C),e&&C==0&&e.push(i._GetFloatRGBAArrayBuffer(A,y,o.byteOffset+G,F,o.buffer,C))):m===64&&(R=i._GetHalfFloatAsUIntRGBAArrayBuffer(A,y,o.byteOffset+G,F,o.buffer,C),e&&C==0&&e.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(A,y,o.byteOffset+G,F,o.buffer,C))),s.type=0;else{const P=k.textureFloat&&(t&&k.textureFloatLinearFiltering||!t),D=k.textureHalfFloat&&(t&&k.textureHalfFloatLinearFiltering||!t),W=(m===128||m===64&&!D)&&P?1:(m===64||m===128&&!P)&&D?2:0;let U,x=null;switch(m){case 128:{switch(W){case 1:U=i._GetFloatRGBAArrayBuffer,x=null;break;case 2:U=i._GetFloatAsHalfFloatRGBAArrayBuffer,x=i._GetFloatRGBAArrayBuffer;break;case 0:U=i._GetFloatAsUIntRGBAArrayBuffer,x=i._GetFloatRGBAArrayBuffer;break}break}default:{switch(W){case 1:U=i._GetHalfFloatAsFloatRGBAArrayBuffer,x=null;break;case 2:U=i._GetHalfFloatRGBAArrayBuffer,x=i._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:U=i._GetHalfFloatAsUIntRGBAArrayBuffer,x=i._GetHalfFloatAsFloatRGBAArrayBuffer;break}break}}s.type=W,R=U(A,y,o.byteOffset+G,F,o.buffer,C),e&&C==0&&e.push(x?x(A,y,o.byteOffset+G,F,o.buffer,C):R)}R&&a._uploadDataToTextureDirectly(s,R,b,C)}else if(n.isRGB)s.type=0,m===24?(s.format=4,F=A*y*3,h=i._GetRGBArrayBuffer(A,y,o.byteOffset+G,F,o.buffer,j,q,J),a._uploadDataToTextureDirectly(s,h,b,C)):(s.format=5,F=A*y*4,h=i._GetRGBAArrayBuffer(A,y,o.byteOffset+G,F,o.buffer,j,q,J,lt),a._uploadDataToTextureDirectly(s,h,b,C));else if(n.isLuminance){const R=a._getUnpackAlignement(),P=A;F=Math.floor((A+R-1)/R)*R*(y-1)+P,h=i._GetLuminanceArrayBuffer(A,y,o.byteOffset+G,F,o.buffer),s.format=1,s.type=0,a._uploadDataToTextureDirectly(s,h,b,C)}else F=Math.max(4,A)/4*Math.max(4,y)/4*M,h=new Uint8Array(o.buffer,o.byteOffset+G,F),s.type=0,a._uploadCompressedDataToTextureDirectly(s,L,A,y,h,b,C)}G+=m?A*y*(m/8):F,A*=.5,y*=.5,A=Math.max(1,A),y=Math.max(1,y)}if(c!==void 0)break}e&&e.length>0?n.sphericalPolynomial=At.ConvertCubeMapToSphericalPolynomial({size:f[T],right:e[0],left:e[1],up:e[2],down:e[3],front:e[4],back:e[5],format:5,type:1,gammaSpace:!1}):n.sphericalPolynomial=void 0}}i.StoreLODInAlphaChannel=!1;export{i as DDSTools};
