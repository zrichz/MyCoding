import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import"./i18n-CyvX8KmK.js";import{G as Ee}from"./utils.svelte-Ceck75cM.js";import{createEventDispatcher as Me,onMount as Ae,tick as U}from"./svelte/svelte_svelte.js";import{e as Re,c as Le,g as Ne,h as ze,I as Ge,T as He,r as Ue,S as We,B as je}from"./IconButtonWrapper-D4LMIc_2.js";import"./svelte/svelte_internal_flags_legacy.js";import{fade as V}from"./svelte/svelte_transition.js";import{BaseDropdown as qe,BaseDropdownOptions as ue}from"./Index-63mAm9d6.js";import{S as Fe}from"./StreamingBar-C6ky6DsM.js";import{default as Lt}from"./Example-BWoz5coS.js";import"./svelte/svelte_store.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_events.js";import"./MarkdownCode-C7jLnxqj.js";import"./prism-python-B1e-54E9.js";import"./Example-Ctdnw0MA.js";var Je=e.from_html('<div class="s s--slider svelte-1io85vl" style="font-size:var(--font-size-sm)px"><button role="switch" class="svelte-1io85vl"></button> <span> </span></div>');function Ke(G,C){e.push(C,!1);let t=e.prop(C,"label",12),p=e.prop(C,"checked",12,!1),h=e.prop(C,"disabled",12,!1);const _=Me();function B(c){const $=c.target.getAttribute("aria-checked");p($!=="true"),_("click",{checked:p()})}var A={get label(){return t()},set label(c){t(c),e.flush()},get checked(){return p()},set checked(c){p(c),e.flush()},get disabled(){return h()},set disabled(c){h(c),e.flush()}};e.init();var E=Je(),I=e.child(E),m=e.sibling(I,2),x=e.child(m,!0);return e.reset(m),e.reset(E),e.template_effect(()=>{e.set_attribute(I,"aria-checked",p()),I.disabled=h(),e.set_text(x,t())}),e.event("click",I,B),e.append(G,E),e.pop(A)}var Qe=e.from_html("<div><!></div>"),Ve=e.from_html('<div class="loading-overlay svelte-1p54cvv"><div class="loading-spinner svelte-1p54cvv"></div> <div class="loading-text svelte-1p54cvv">Converting to dialogue format...</div></div>'),Xe=e.from_html('<textarea rows="1" readonly="" class="svelte-1p54cvv"></textarea>'),Ye=e.from_html('<div id="tag-menu" class="tag-menu svelte-1p54cvv"><!></div>'),Ze=e.from_html('<div><button class="add-button svelte-1p54cvv" aria-label="Add new line"><!></button></div>'),et=e.from_html('<div class="dialogue-line svelte-1p54cvv"><div class="speaker-column svelte-1p54cvv" role="button" tabindex="0"><!></div> <div class="text-column svelte-1p54cvv"><div class="input-container svelte-1p54cvv"><textarea rows="1" class="svelte-1p54cvv"></textarea> <!></div></div> <!> <div><button class="delete-button svelte-1p54cvv" aria-label="Remove current line"><!></button></div></div>'),tt=e.from_html("<div><!> <!></div>"),st=e.from_html('<div class="loading-overlay svelte-1p54cvv"><div class="loading-spinner svelte-1p54cvv"></div> <div class="loading-text svelte-1p54cvv">Converting to plain text...</div></div>'),rt=e.from_html('<div id="tag-menu" class="tag-menu-plain-text svelte-1p54cvv"><!></div>'),at=e.from_html('<div><!> <textarea data-testid="textbox" class="svelte-1p54cvv"></textarea> <!></div>'),ot=e.from_html('<div class="submit-container svelte-1p54cvv"><button class="submit-button svelte-1p54cvv"><!></button></div>'),lt=e.from_html("<label><!> <!> <!> <!> <!></label>");function it(G,C){e.push(C,!0),e.rest_props(C,["$$slots","$$events","$$legacy"]);const t=C.gradio;let p=e.derived(()=>!1),h=e.derived(()=>!t.shared.interactive),_=e.state(e.proxy([]));e.user_effect(()=>{t.props.value&&t.props.value.length&&typeof t.props.value!="string"?e.set(_,[...t.props.value],!0):t.props.value&&typeof t.props.value!="string"?e.set(_,[{speaker:`${t.props.speakers.length?t.props.speakers[0]:""}`,text:""}],!0):typeof t.props.value=="string"&&(e.set(w,t.props.value,!0),e.set(p,!0))});let B=e.derived(()=>t.props.buttons||["copy"]),A=s=>{t.dispatch("custom_button_click",{id:s})},E=e.state(e.proxy(t.props.value));e.user_effect(()=>{e.get(E)!=t.props.value&&(e.set(E,t.props.value,!0),t.dispatch("change"))});let I,m=e.state(!1),x=e.state(-1),c=e.state(0),k=e.state(e.proxy([])),$=e.proxy([]),T,re=e.state(0),W=e.state(!1),X,w=e.state(""),j=e.state(null),R=e.state(!1),L=e.state(!1);const ae=["red","green","blue","yellow","purple","teal","orange","cyan","lime","pink"],ge={red:"rgba(254, 202, 202, 0.7)",green:"rgba(209, 250, 229, 0.7)",blue:"rgba(219, 234, 254, 0.7)",yellow:"rgba(254, 243, 199, 0.7)",purple:"rgba(233, 213, 255, 0.7)",teal:"rgba(204, 251, 241, 0.7)",orange:"rgba(254, 215, 170, 0.7)",cyan:"rgba(207, 250, 254, 0.7)",lime:"rgba(217, 249, 157, 0.7)",pink:"rgba(252, 231, 243, 0.7)"};let fe=e.derived(()=>{let s={};return t.props.color_map?s={...t.props.color_map}:(s={},t.props.speakers.forEach((r,a)=>{const d=ae[a%ae.length];s[r]=ge[d]})),s});function _e(s){const r=t.props.speakers.length>0?t.props.speakers[0]:"";e.set(_,[...e.get(_).slice(0,s+1),{speaker:r,text:""},...e.get(_).slice(s+1)],!0),U().then(()=>{$[s+1]&&$[s+1].focus()}),t.props.value=[...e.get(_)]}function me(s){e.set(_,[...e.get(_).slice(0,s),...e.get(_).slice(s+1)],!0),t.props.value=[...e.get(_)]}function Y(s,r,a){e.get(_)[s][r]=a,e.set(_,[...e.get(_)],!0),t.props.value=[...e.get(_)]}function q(s,r){const a=s.target||HTMLTextAreaElement;a&&!$[r]&&($[r]=a);const d=a.selectionStart||0,f=a.value;let g=!1,n=-1;if(f[d-1]===":"){e.set(x,r,!0),n=d;const o=he(f,d);e.set(k,t.props.tags.filter(l=>o===""||l.toLowerCase().includes(o.toLowerCase())),!0),g=e.get(k).length>0,e.set(c,0)}else{const o=f.lastIndexOf(":",d-1);if(o>=0&&!f.substring(o+1,d).includes(" ")){e.set(x,r,!0),n=o+1;const l=f.substring(o+1,d);e.set(k,t.props.tags.filter(v=>l===""||v.toLowerCase().includes(l.toLowerCase())),!0),g=e.get(k).length>0,e.set(c,0)}}if(g&&n!==-1){e.set(m,!0);const o=a.getBoundingClientRect();if(I){const l=I.getBoundingClientRect();e.set(re,l.top+o.height*(r+1.5))}}else e.set(m,!1);t.dispatch("input")}function he(s,r){const a=s.lastIndexOf(":",r-1);return a>=0?s.substring(a+1,r):""}async function oe(){const s=e.get(k)[e.get(c)];if(s){let r,a;e.get(p)?(a=T,r=e.get(w)):(a=$[e.get(x)],r=e.get(_)[e.get(x)].text);const d=a?.selectionStart||0,f=r.lastIndexOf(":",d-1);if(f>=0){const g=r.substring(0,f),n=r.substring(d);if(e.get(p)){const o=`${g}${s} ${n}`;e.set(w,o),t.props.speakers.length===0?t.props.value=o:t.props.value=await t.shared.server.unformat({text:o}),U().then(()=>{if(T){const l=g.length+s.length+1;T.setSelectionRange(l,l),T.focus()}})}else{const o=g.replace(/\[S\d+\]/g,"").trim(),l=`${o}${s} ${n}`;Y(e.get(x),"text",l),U().then(()=>{const v=$[e.get(x)];if(v){const y=o.length+s.length+1;v.setSelectionRange(y,y),v.focus()}})}}e.set(m,!1),e.set(c,0)}}async function le(s){const r=t.props.tags[s.detail.target.dataset.index];if(r){let a,d;e.get(p)?(d=T,a=e.get(w)):(d=$[e.get(x)],a=e.get(_)[e.get(x)].text);const f=d?.selectionStart||0,g=a.lastIndexOf(":",f-1);if(g>=0){const n=a.substring(0,g),o=a.substring(f);if(e.get(p)){const l=`${n}${r} ${o}`;e.set(w,l),t.props.speakers.length===0?t.props.value=l:t.props.value=await t.shared.server.unformat({text:l}),U().then(()=>{if(T){const v=n.length+r.length+1;T.setSelectionRange(v,v),T.focus()}})}else{const l=n.replace(/\[S\d+\]/g,"").trim(),v=`${l}${r} ${o}`;Y(e.get(x),"text",v),U().then(()=>{const y=$[e.get(x)];if(y){const N=l.length+r.length+1;y.setSelectionRange(N,N),y.focus()}})}}e.set(m,!1),e.set(c,0)}}function be(s){if(e.get(m)){const r=s.target,a=document.getElementById("tag-menu");a&&!a.contains(r)&&e.set(m,!1)}}async function Z(s){return typeof s=="string"?s:await t.shared.server.format(s)}async function xe(){if("clipboard"in navigator){const s=await Z(t.props.value);await navigator.clipboard.writeText(s),ke()}}function ke(){e.set(W,!0),X&&clearTimeout(X),X=setTimeout(()=>{e.set(W,!1)},1e3)}async function we(){e.get(p)&&(t.props.value=await t.shared.server.unformat({text:e.get(w)})),t.dispatch("submit")}Ae(async()=>{if(typeof t.props.value=="string")e.set(w,t.props.value,!0);else if(t.props.value&&t.props.value.length>0){const s=await Z(t.props.value);e.set(w,s,!0)}else e.set(w,"")});var F=lt();e.event("click",e.window,be);let ie;var ne=e.child(F);{var ye=s=>{Le(s,{get buttons(){return e.get(B)},on_custom_button_click:A,children:(r,a)=>{var d=e.comment(),f=e.first_child(d);{var g=n=>{{let o=e.derived(()=>e.get(W)?Ne:ze),l=e.derived(()=>e.get(W)?"Copied":"Copy");Ge(n,{get Icon(){return e.get(o)},get label(){return e.get(l)},$$events:{click:xe}})}};e.if(f,n=>{e.get(B).some(o=>typeof o=="string"&&o==="copy")&&n(g)})}e.append(r,d)},$$slots:{default:!0}})};e.if(ne,s=>{t.shared.show_label&&(e.get(B).some(r=>typeof r=="string"&&r==="copy")||e.get(B).some(r=>typeof r!="string"))&&s(ye)})}var pe=e.sibling(ne,2);Re(pe,{get show_label(){return t.shared.show_label},get info(){return t.props.info},children:(s,r)=>{e.next();var a=e.text();e.template_effect(()=>e.set_text(a,t.shared.label||"Dialogue")),e.append(s,a)},$$slots:{default:!0}});var ce=e.sibling(pe,2);{var $e=s=>{var r=Qe();let a;var d=e.child(r);{let f=e.derived(()=>e.get(L)||e.get(R));Ke(d,{label:"Plain Text",get disabled(){return e.get(f)},get checked(){return e.get(p)},set checked(g){e.set(p,g)},$$events:{click:async g=>{if(g.detail.checked){e.set(L,!0);try{e.set(w,await Z(e.get(_)),!0)}finally{e.set(L,!1)}}else{e.set(R,!0);try{t.props.value=await t.shared.server.unformat({text:e.get(w)}),e.set(_,[...t.props.value],!0)}finally{e.set(R,!1)}}}}})}e.reset(r),e.template_effect(()=>a=e.set_class(r,1,"switch-container top-switch svelte-1p54cvv",null,a,{"switch-disabled":e.get(L)||e.get(R)})),e.append(s,r)};e.if(ce,s=>{t.props.ui_mode==="both"&&s($e)})}var de=e.sibling(ce,2);{var Ce=s=>{var r=tt();let a;var d=e.child(r);{var f=n=>{var o=Ve();e.transition(3,o,()=>V,()=>({duration:200})),e.append(n,o)};e.if(d,n=>{e.get(R)&&n(f)})}var g=e.sibling(d,2);e.each(g,17,()=>e.get(_),e.index,(n,o,l)=>{var v=et(),y=e.child(v),N=e.child(y);{var u=i=>{var b=Xe();e.remove_textarea_child(b),e.template_effect(()=>b.disabled=e.get(h)),e.bind_value(b,()=>e.get(o).speaker,S=>e.get(o).speaker=S),e.append(i,b)},O=i=>{{let b=e.derived(()=>t.props.speakers.map(S=>[S,S]));qe(i,{label:"",show_label:!1,container:!0,interactive:!0,get value(){return e.get(o).speaker},get choices(){return e.get(b)},on_change:S=>Y(l,"speaker",S)})}};e.if(N,i=>{e.get(h)?i(u):i(O,!1)})}e.reset(y);var H=e.sibling(y,2),J=e.child(H),D=e.child(J);e.remove_textarea_child(D),e.bind_this(D,(i,b)=>$[b]=i,i=>$?.[i],()=>[l]);var ee=e.sibling(D,2);{var P=i=>{var b=Ye(),S=e.child(b);{let z=e.derived(()=>t.props.tags.map((M,Pe)=>[M,Pe])),se=e.derived(()=>e.get(k).map(M=>t.props.tags.indexOf(M))),Oe=e.derived(()=>e.get(k).map(M=>t.props.tags.indexOf(M))[e.get(c)]);ue(S,{get choices(){return e.get(z)},get filtered_indices(){return e.get(se)},get active_index(){return e.get(Oe)},show_options:!0,get offset_from_top(){return e.get(re)},from_top:!0,$$events:{change:M=>le(M)}})}e.reset(b),e.transition(3,b,()=>V,()=>({duration:100})),e.append(i,b)};e.if(ee,i=>{e.get(m)&&e.get(x)===l&&i(P)})}e.reset(J),e.reset(H);var K=e.sibling(H,2);{var Te=i=>{var b=Ze();let S;var z=e.child(b),se=e.child(z);Ue(se),e.reset(z),e.reset(b),e.template_effect(()=>{S=e.set_class(b,1,"svelte-1p54cvv",null,S,{"action-column":l==0,hidden:e.get(h)}),z.disabled=e.get(h)}),e.event("click",z,()=>_e(l)),e.append(i,b)};e.if(K,i=>{(t.props.max_lines==null||t.props.max_lines&&l<t.props.max_lines-1)&&i(Te)})}var te=e.sibling(K,2);let ve;var Q=e.child(te),Be=e.child(Q);He(Be),e.reset(Q),e.reset(te),e.reset(v),e.template_effect(()=>{e.set_style(v,`--speaker-bg-color: ${(e.get(h)&&(e.get(j)===null||e.get(j)===e.get(o).speaker)&&e.get(fe)[e.get(o).speaker]||"transparent")??""}`),e.set_attribute(D,"placeholder",t.props.placeholder),D.disabled=e.get(h),ve=e.set_class(te,1,"action-column svelte-1p54cvv",null,ve,{hidden:e.get(h)||l==0}),Q.disabled=e.get(h)}),e.event("mouseenter",y,()=>e.get(h)&&e.set(j,e.get(o).speaker,!0)),e.event("mouseleave",y,()=>e.get(h)&&e.set(j,null)),e.bind_value(D,()=>e.get(o).text,i=>e.get(o).text=i),e.event("input",D,i=>q(i,l)),e.event("focus",D,i=>q(i,l)),e.event("keydown",D,i=>{i.key==="Escape"&&e.get(m)?(e.set(m,!1),e.set(c,0),i.preventDefault()):e.get(m)&&e.get(x)===l&&(i.key==="ArrowDown"?(e.set(c,Math.min(e.get(c)+1,e.get(k).length-1),!0),i.preventDefault()):i.key==="ArrowUp"?(e.set(c,Math.max(e.get(c)-1,0),!0),i.preventDefault()):i.key==="Enter"&&(e.get(k)[e.get(c)]&&oe(),i.preventDefault()))}),e.event("click",Q,()=>me(l)),e.append(n,v)}),e.reset(r),e.bind_this(r,n=>I=n,()=>I),e.template_effect(()=>a=e.set_class(r,1,"dialogue-container svelte-1p54cvv",null,a,{loading:e.get(R)})),e.append(s,r)},Ie=s=>{var r=e.comment(),a=e.first_child(r);{var d=f=>{var g=at();let n;var o=e.child(g);{var l=u=>{var O=st();e.transition(3,O,()=>V,()=>({duration:200})),e.append(u,O)};e.if(o,u=>{e.get(L)&&u(l)})}var v=e.sibling(o,2);e.remove_textarea_child(v),e.set_attribute(v,"rows",5),e.bind_this(v,u=>T=u,()=>T);var y=e.sibling(v,2);{var N=u=>{var O=rt(),H=e.child(O);{let J=e.derived(()=>t.props.tags.map((P,K)=>[P,K])),D=e.derived(()=>e.get(k).map(P=>t.props.tags.indexOf(P))),ee=e.derived(()=>e.get(k).map(P=>t.props.tags.indexOf(P))[e.get(c)]);ue(H,{get choices(){return e.get(J)},get filtered_indices(){return e.get(D)},get active_index(){return e.get(ee)},show_options:!0,$$events:{change:P=>le(P)}})}e.reset(O),e.transition(3,O,()=>V,()=>({duration:100})),e.append(u,O)};e.if(y,u=>{e.get(m)&&u(N)})}e.reset(g),e.template_effect(()=>{n=e.set_class(g,1,"textarea-container svelte-1p54cvv",null,n,{loading:e.get(L)}),e.set_attribute(v,"placeholder",t.props.placeholder),v.disabled=e.get(h)}),e.bind_value(v,()=>e.get(w),u=>e.set(w,u)),e.event("input",v,u=>{q(u,0),t.props.value=e.get(w)}),e.event("focus",v,u=>q(u,0)),e.event("keydown",v,u=>{u.key==="Escape"&&e.get(m)?(e.set(m,!1),e.set(c,0),u.preventDefault()):e.get(m)&&(u.key==="ArrowDown"?(e.set(c,Math.min(e.get(c)+1,e.get(k).length-1),!0),u.preventDefault()):u.key==="ArrowUp"?(e.set(c,Math.max(e.get(c)-1,0),!0),u.preventDefault()):u.key==="Enter"&&(e.get(k)[e.get(c)]&&oe(),u.preventDefault()))}),e.append(f,g)};e.if(a,f=>{(e.get(p)||t.props.ui_mode!=="dialogue")&&f(d)},!0)}e.append(s,r)};e.if(de,s=>{!e.get(p)&&t.props.ui_mode!=="text"?s(Ce):s(Ie,!1)})}var De=e.sibling(de,2);{var Se=s=>{var r=ot(),a=e.child(r),d=e.child(a);{var f=n=>{var o=e.text();e.template_effect(()=>e.set_text(o,t.props.submit_btn)),e.append(n,o)},g=n=>{We(n)};e.if(d,n=>{typeof t.props.submit_btn=="string"?n(f):n(g,!1)})}e.reset(a),e.reset(r),e.template_effect(()=>a.disabled=e.get(h)),e.event("click",a,we),e.append(s,r)};e.if(De,s=>{t.props.submit_btn&&!e.get(h)&&s(Se)})}e.reset(F),e.template_effect(()=>ie=e.set_class(F,1,"svelte-1p54cvv",null,ie,{container:t.shared.container})),e.append(G,F),e.pop()}var nt=e.from_html("<!> <!>",1);function Mt(G,C){e.push(C,!0);const t=e.rest_props(C,["$$slots","$$events","$$legacy"]),p=new Ee(t);je(G,{get visible(){return p.shared.visible},get elem_id(){return p.shared.elem_id},get elem_classes(){return p.shared.elem_classes},get scale(){return p.shared.scale},get min_width(){return p.shared.min_width},allow_overflow:!0,get padding(){return p.shared.container},children:(h,_)=>{var B=nt(),A=e.first_child(B);{var E=m=>{Fe(m,e.spread_props({get autoscroll(){return p.shared.autoscroll},get i18n(){return p.i18n}},()=>p.shared.loading_status,{on_clear_status:()=>p.dispatch("clear_status",p.shared.loading_status)}))};e.if(A,m=>{p.shared.loading_status&&m(E)})}var I=e.sibling(A,2);it(I,{get gradio(){return p}}),e.append(h,B)},$$slots:{default:!0}}),e.pop()}export{it as BaseDialogue,Lt as BaseExample,Mt as default};
