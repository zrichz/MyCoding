import{B as z,M as x,O as C,V as y,a as M,d as S,e as P,f as R,G as D,_ as n,s as _,g as v,h as A,R as E}from"./index-Dtj0WP_z.js";import"./abstractEngine.cubeTexture-DHkQQ0eN.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";const L=.8;class a extends z{set boundingBoxSize(t){if(this._boundingBoxSize&&this._boundingBoxSize.equals(t))return;this._boundingBoxSize=t;const i=this.getScene();i&&i.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(t){this._rotationY=t,this.setReflectionTextureMatrix(x.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,i,e){let r="";for(const s of t)r+=s;return new a(r,i,null,e,t)}static CreateFromPrefilteredData(t,i,e=null,r=!0){const s=i.useDelayedTextureLoading;i.useDelayedTextureLoading=!1;const o=new a(t,i,null,!1,null,null,null,void 0,!0,e,r);return i.useDelayedTextureLoading=s,o}constructor(t,i,e=null,r=!1,s=null,o=null,l=null,u=5,c=!1,h=null,f=!1,g=L,m=0,p,d){super(i),this.onLoadObservable=new C,this.boundingBoxPosition=y.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new x,this._buffer=null,this.name=t,this.url=t,this._noMipmap=r,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=x.Identity(),this.coordinatesMode=M.CUBIC_MODE;let b=null,B=null;e!==null&&!Array.isArray(e)?(b=e.extensions??null,this._noMipmap=e.noMipmap??!1,s=e.files??null,B=e.buffer??null,this._format=e.format??5,c=e.prefiltered??!1,h=e.forcedExtension??null,this._createPolynomials=e.createPolynomials??!1,this._lodScale=e.lodScale??L,this._lodOffset=e.lodOffset??0,this._loaderOptions=e.loaderOptions,this._useSRGBBuffer=e.useSRGBBuffer,o=e.onLoad??null,l=e.onError??null):(this._noMipmap=r,this._format=u,this._createPolynomials=f,b=e,this._loaderOptions=p,this._useSRGBBuffer=d,this._lodScale=g,this._lodOffset=m),!(!t&&!s)&&this.updateURL(t,h,o,c,l,b,this.getScene()?.useDelayedTextureLoading,s,B)}getClassName(){return"CubeTexture"}updateURL(t,i=null,e=null,r=!1,s=null,o=null,l=!1,u=null,c=null){(!this.name||this.name.startsWith("data:"))&&(this.name=t),this.url=t,i&&(this._forcedExtension=i);const h=t.lastIndexOf("."),f=i||(h>-1?t.substring(h).toLowerCase():""),g=f.indexOf(".dds")===0,m=f.indexOf(".env")===0,p=f.indexOf(".basis")===0;if(m?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=r,r&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),u)this._files=u;else if(!p&&!m&&!g&&!o&&(o=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,o){for(let d=0;d<o.length;d++)this._files.push(t+o[d]);this._extensions=o}this._buffer=c,l?(this.delayLoadState=4,this._delayedOnLoad=e,this._delayedOnError=s):this._loadTexture(e,s)}delayLoad(t){this.delayLoadState===4&&(t&&(this._forcedExtension=t),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(t){if(t.updateFlag===this._textureMatrix.updateFlag||(t.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,s=>s.getActiveTextures().indexOf(this)!==-1),this._textureMatrix=t,!this.getScene()?.useRightHandedSystem))return;const i=S.Vector3[0],e=S.Quaternion[0],r=S.Vector3[1];this._textureMatrix.decompose(i,e,r),e.z*=-1,e.w*=-1,x.ComposeToRef(i,e,r,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(t=null,i=null){const e=this.getScene(),r=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const s=()=>{this.onLoadObservable.notifyObservers(this),r&&(r.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),t&&t()},o=(l,u)=>{this._loadingError=!0,this._errorObject={message:l,exception:u},i&&i(l,u),M.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?P.SetImmediate(()=>s()):this._texture.onLoadedObservable.add(()=>s()):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,e,this._lodScale,this._lodOffset,t,o,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,e,this._files,this._noMipmap,t,o,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add(()=>this.onLoadObservable.notifyObservers(this)))}static Parse(t,i,e){const r=R.Parse(()=>{let s=!1;return t.prefiltered&&(s=t.prefiltered),new a(e+(t.url??t.name),i,t.extensions,!1,t.files||null,null,null,void 0,s,t.forcedExtension)},t,i);if(t.boundingBoxPosition&&(r.boundingBoxPosition=y.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(r.boundingBoxSize=y.FromArray(t.boundingBoxSize)),t.animations)for(let s=0;s<t.animations.length;s++){const o=t.animations[s],l=D("BABYLON.Animation");l&&r.animations.push(l.Parse(o))}return r}clone(){let t=0;const i=R.Clone(()=>{const e=new a(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=e.uniqueId,e},this);return i.uniqueId=t,i}}n([_()],a.prototype,"url",void 0);n([v()],a.prototype,"boundingBoxPosition",void 0);n([v()],a.prototype,"boundingBoxSize",null);n([_("rotationY")],a.prototype,"rotationY",null);n([_("files")],a.prototype,"_files",void 0);n([_("forcedExtension")],a.prototype,"_forcedExtension",void 0);n([_("extensions")],a.prototype,"_extensions",void 0);n([A("textureMatrix")],a.prototype,"_textureMatrix",void 0);n([A("textureMatrixRefraction")],a.prototype,"_textureMatrixRefraction",void 0);M._CubeTextureParser=a.Parse;E("BABYLON.CubeTexture",a);export{a as CubeTexture};
