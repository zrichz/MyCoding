import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_legacy.js";import"./i18n-CyvX8KmK.js";import{u as Be,S as dt,c as ut,G as ct}from"./utils.svelte-Ceck75cM.js";import{I as Me}from"./Image-Bdf4wQSw.js";import"./ImagePreview-CBoeGuoF.js";import{I as ve,g as Pe,h as Xe,c as Ye,l as gt,j as ft,D as pt,a5 as vt,f as ht,s as mt,F as Fe,a6 as bt,v as Ge,T as wt,C as kt,a7 as yt,B as xt,b as Ct,a8 as qt}from"./IconButtonWrapper-D4LMIc_2.js";import{createEventDispatcher as We,onDestroy as $e,onMount as De,tick as Ht}from"./svelte/svelte_svelte.js";import{S as zt}from"./ShareButton-DGzDjeX1.js";import{M as Ue}from"./MarkdownCode-C7jLnxqj.js";import{slide as jt}from"./svelte/svelte_transition.js";import{d as Lt}from"./index-CnqicUFC.js";import{S as Vt}from"./StreamingBar-C6ky6DsM.js";import"./svelte/svelte_store.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_events.js";import"./FullscreenButton-CdZP1GYm.js";import"./prism-python-B1e-54E9.js";const Mt=async(u,t=1800)=>{let n=[...u],r=await Ee(n);if(r.length>t&&n.length>2){const o=n[0],a=n[n.length-1];n=[o,a],r=await Ee(n)}return r.length>t&&n.length>0&&(n=n.map(a=>{if(a.type==="text"){const d=Math.floor(t/n.length)-20;if(a.content.length>d)return{...a,content:a.content.substring(0,d)+"..."}}return a}),r=await Ee(n)),r},Ee=async u=>(await Promise.all(u.map(async n=>{if(n.role==="system")return"";let r=n.role==="user"?"ðŸ˜ƒ":"ðŸ¤–",o="";if(n.type==="text"){const a={audio:/<audio.*?src="(\/file=.*?)"/g,video:/<video.*?src="(\/file=.*?)"/g,image:/<img.*?src="(\/file=.*?)".*?\/>|!\[.*?\]\((\/file=.*?)\)/g};o=n.content;for(let[d,s]of Object.entries(a)){let b;for(;(b=s.exec(n.content))!==null;){const q=b[1]||b[2],h=await Be(q);o=o.replace(q,h)}}}else{if(!n.content.value)return"";const a=n.content.component==="video"?n.content.value?.video.path:n.content.value,d=await Be(a);n.content.component==="audio"?o=`<audio controls src="${d}"></audio>`:n.content.component==="video"?o=d:n.content.component==="image"&&(o=`<img src="${d}" />`)}return`${r}: ${o}`}))).filter(n=>n!=="").join(`
`),It=(u,t)=>u.replace('src="/file',`src="${t}file`);function Tt(u,t){if(!u){const n=t?.path;if(n){const r=n.toLowerCase();if(r.endsWith(".glb")||r.endsWith(".gltf")||r.endsWith(".obj")||r.endsWith(".stl")||r.endsWith(".splat")||r.endsWith(".ply"))return"model3d"}return"file"}return u.includes("audio")?"audio":u.includes("video")?"video":u.includes("image")?"image":u.includes("model")?"model3d":"file"}function At(u){const t=Array.isArray(u.file)?u.file[0]:u.file;return{component:Tt(t?.mime_type,t),value:u.file,alt_text:u.alt_text,constructor_args:{},props:{}}}function Dt(u,t,n,r){let o;return t.type==="text"?o={role:u.role,metadata:u.metadata,content:It(t.text,n),type:"text",index:r,options:u.options}:t.type==="file"?o={role:u.role,metadata:u.metadata,content:At(t),type:"component",index:r,options:u.options}:o={role:u.role,metadata:u.metadata,content:t,type:"component",index:r,options:u.options},o}function Et(u,t){if(u===null)return u;const n=new Map;return u.flatMap((r,o)=>{const a=r.content.map(d=>Dt(r,d,t,o));for(const d of a){const{id:s,title:b,parent_id:q}=r.metadata||{};if(q){const h=n.get(String(q));if(h){const v={...d,children:[]};return h.children.push(v),s&&b&&n.set(String(s),v),null}}if(s&&b){const h={...d,children:[]};return n.set(String(s),h),h}}return a}).filter(r=>r!==null)}function St(u){return u.type==="component"}function Te(u,t){const n=u[u.length-1].role==="assistant",r=u[u.length-1].index;return JSON.stringify(r)===JSON.stringify(t[t.length-1].index)&&n}function Bt(u,t=!0){const n=[];let r=[],o=null;for(const a of u)if(a.role==="assistant"||a.role==="user"){if(!t){n.push([a]);continue}a.role===o?r.push(a):(r.length>0&&n.push(r),r=[a],o=a.role)}return r.length>0&&n.push(r),n}async function Ft(u,t,n){for(const r of u){if(t[r]||r==="file")continue;const a=await n(r,r==="dataframe"?"component":"base");t[r]=a.default}return t}function Ne(u){if(!u)return[];let t=new Set;return u.forEach(n=>{n.type==="component"&&t.add(n.content.component)}),Array.from(t)}function Ze(u,t=0){let n="";const r="  ".repeat(t);u.metadata?.title&&(n+=`${r}${t>0?"- ":""}${u.metadata.title}
`),typeof u.content=="string"&&(n+=`${r}  ${u.content}
`);const o=u;return o.children?.length>0&&(n+=o.children.map(a=>Ze(a,t+1)).join("")),n}function Oe(u){return Array.isArray(u)?u.map(t=>t.metadata?.title?Ze(t):t.content).join(`
`):u.metadata?.title?Ze(u):u.content}function Se(u){return Array.isArray(u)&&u.every(t=>typeof t.content=="string")||!Array.isArray(u)&&typeof u.content=="string"}var Zt=e.from_svg('<svg width="100%" height="100%" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.25 6.61523H9.375V1.36523H11.25V6.61523ZM3.375 1.36523H8.625V6.91636L7.48425 8.62748L7.16737 10.8464C7.14108 11.0248 7.05166 11.1879 6.91535 11.3061C6.77904 11.4242 6.60488 11.4896 6.4245 11.4902H6.375C6.07672 11.4899 5.79075 11.3713 5.57983 11.1604C5.36892 10.9495 5.2503 10.6635 5.25 10.3652V8.11523H2.25C1.85233 8.11474 1.47109 7.95654 1.18989 7.67535C0.908691 7.39415 0.750496 7.01291 0.75 6.61523V3.99023C0.750992 3.29435 1.02787 2.62724 1.51994 2.13517C2.01201 1.64311 2.67911 1.36623 3.375 1.36523Z" fill="currentColor"></path></svg>');function Pt(u){var t=Zt();e.append(u,t)}var Wt=e.from_svg('<svg width="100%" height="100%" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.25 8.11523H4.5V10.3652C4.5003 10.6635 4.61892 10.9495 4.82983 11.1604C5.04075 11.3713 5.32672 11.4899 5.625 11.4902H6.42488C6.60519 11.4895 6.77926 11.4241 6.91549 11.3059C7.05172 11.1878 7.14109 11.0248 7.16737 10.8464L7.48425 8.62748L8.82562 6.61523H11.25V1.36523H3.375C2.67911 1.36623 2.01201 1.64311 1.51994 2.13517C1.02787 2.62724 0.750992 3.29435 0.75 3.99023V6.61523C0.750496 7.01291 0.908691 7.39415 1.18989 7.67535C1.47109 7.95654 1.85233 8.11474 2.25 8.11523ZM9 2.11523H10.5V5.86523H9V2.11523ZM1.5 3.99023C1.5006 3.49314 1.69833 3.01657 2.04983 2.66507C2.40133 2.31356 2.8779 2.11583 3.375 2.11523H8.25V6.12661L6.76575 8.35298L6.4245 10.7402H5.625C5.52554 10.7402 5.43016 10.7007 5.35983 10.6304C5.28951 10.5601 5.25 10.4647 5.25 10.3652V7.36523H2.25C2.05118 7.36494 1.86059 7.28582 1.72 7.14524C1.57941 7.00465 1.5003 6.81406 1.5 6.61523V3.99023Z" fill="currentColor"></path></svg>');function Ut(u){var t=Wt();e.append(u,t)}var Gt=e.from_svg('<svg width="100%" height="100%" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.75 6.24023H2.625V11.4902H0.75V6.24023ZM8.625 11.4902H3.375V5.93911L4.51575 4.22798L4.83263 2.00911C4.85892 1.83065 4.94834 1.66754 5.08465 1.5494C5.22096 1.43125 5.39512 1.36591 5.5755 1.36523H5.625C5.92328 1.36553 6.20925 1.48415 6.42017 1.69507C6.63108 1.90598 6.7497 2.19196 6.75 2.49023V4.74023H9.75C10.1477 4.74073 10.5289 4.89893 10.8101 5.18012C11.0913 5.46132 11.2495 5.84256 11.25 6.24023V8.86523C11.249 9.56112 10.9721 10.2282 10.4801 10.7203C9.98799 11.2124 9.32089 11.4892 8.625 11.4902Z" fill="currentColor"></path></svg>');function Nt(u){var t=Gt();e.append(u,t)}var Ot=e.from_svg('<svg width="100%" height="100%" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.75 4.74023H7.5V2.49023C7.4997 2.19196 7.38108 1.90598 7.17017 1.69507C6.95925 1.48415 6.67328 1.36553 6.375 1.36523H5.57512C5.39481 1.366 5.22074 1.43138 5.08451 1.54952C4.94828 1.66766 4.85891 1.83072 4.83262 2.00911L4.51575 4.22798L3.17438 6.24023H0.75V11.4902H8.625C9.32089 11.4892 9.98799 11.2124 10.4801 10.7203C10.9721 10.2282 11.249 9.56112 11.25 8.86523V6.24023C11.2495 5.84256 11.0913 5.46132 10.8101 5.18012C10.5289 4.89893 10.1477 4.74073 9.75 4.74023ZM3 10.7402H1.5V6.99023H3V10.7402ZM10.5 8.86523C10.4994 9.36233 10.3017 9.8389 9.95017 10.1904C9.59867 10.5419 9.1221 10.7396 8.625 10.7402H3.75V6.72886L5.23425 4.50248L5.5755 2.11523H6.375C6.47446 2.11523 6.56984 2.15474 6.64017 2.22507C6.71049 2.2954 6.75 2.39078 6.75 2.49023V5.49023H9.75C9.94882 5.49053 10.1394 5.56965 10.28 5.71023C10.4206 5.85082 10.4997 6.04141 10.5 6.24023V8.86523Z" fill="currentColor"></path></svg>');function Jt(u){var t=Ot();e.append(u,t)}var Rt=e.from_svg('<svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none"><path fill="currentColor" d="M6,30H4V2H28l-5.8,9L28,20H6ZM6,18H24.33L19.8,11l4.53-7H6Z"></path></svg>');function Je(u){var t=Rt();e.append(u,t)}var Kt=e.from_svg('<svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none"><path fill="currentColor" d="M4,2H28l-5.8,9L28,20H6v10H4V2z"></path></svg>');function Re(u){var t=Kt();e.append(u,t)}var Qt=e.from_html("<!> <!>",1),Xt=e.from_html('<button class="extra-feedback-option svelte-fvat56"> </button>'),Yt=e.from_html('<div class="extra-feedback no-border svelte-fvat56"><!> <div class="extra-feedback-options svelte-fvat56"></div></div>'),$t=e.from_html("<!> <!>",1);function er(u,t){e.push(t,!1);const n=e.mutable_source();let r=e.prop(t,"i18n",12),o=e.prop(t,"handle_action",12),a=e.prop(t,"feedback_options",12),d=e.prop(t,"selected",12,null);function s(p){d(d()===p?null:p),o()(d())}e.legacy_pre_effect(()=>e.deep_read_state(a()),()=>{e.set(n,a().filter(p=>p!=="Like"&&p!=="Dislike"))}),e.legacy_pre_effect_reset();var b={get i18n(){return r()},set i18n(p){r(p),e.flush()},get handle_action(){return o()},set handle_action(p){o(p),e.flush()},get feedback_options(){return a()},set feedback_options(p){a(p),e.flush()},get selected(){return d()},set selected(p){d(p),e.flush()}};e.init();var q=$t(),h=e.first_child(q);{var v=p=>{var y=Qt(),c=e.first_child(y);{var m=L=>{{let _=e.derived_safe_equal(()=>d()==="Dislike"?Pt:Ut),J=e.derived_safe_equal(()=>(e.deep_read_state(d()),e.deep_read_state(r()),e.untrack(()=>d()==="Dislike"?"Disliked":r()("chatbot.dislike")))),f=e.derived_safe_equal(()=>d()==="Dislike"?"var(--color-accent)":"var(--block-label-text-color)");ve(L,{get Icon(){return e.get(_)},get label(){return e.get(J)},get color(){return e.get(f)},$$events:{click:()=>s("Dislike")}})}};e.if(c,L=>{e.deep_read_state(a()),e.untrack(()=>a().includes("Dislike"))&&L(m)})}var H=e.sibling(c,2);{var F=L=>{{let _=e.derived_safe_equal(()=>d()==="Like"?Nt:Jt),J=e.derived_safe_equal(()=>(e.deep_read_state(d()),e.deep_read_state(r()),e.untrack(()=>d()==="Like"?"Liked":r()("chatbot.like")))),f=e.derived_safe_equal(()=>d()==="Like"?"var(--color-accent)":"var(--block-label-text-color)");ve(L,{get Icon(){return e.get(_)},get label(){return e.get(J)},get color(){return e.get(f)},$$events:{click:()=>s("Like")}})}};e.if(H,L=>{e.deep_read_state(a()),e.untrack(()=>a().includes("Like"))&&L(F)})}e.append(p,y)};e.if(h,p=>{e.deep_read_state(a()),e.untrack(()=>a().includes("Like")||a().includes("Dislike"))&&p(v)})}var x=e.sibling(h,2);{var k=p=>{var y=Yt(),c=e.child(y);{let H=e.derived_safe_equal(()=>(e.deep_read_state(d()),e.get(n),e.deep_read_state(Re),e.deep_read_state(Je),e.untrack(()=>d()&&e.get(n).includes(d())?Re:Je))),F=e.derived_safe_equal(()=>(e.deep_read_state(d()),e.get(n),e.untrack(()=>d()&&e.get(n).includes(d())?"var(--color-accent)":"var(--block-label-text-color)")));ve(c,{get Icon(){return e.get(H)},label:"Feedback",get color(){return e.get(F)}})}var m=e.sibling(c,2);e.each(m,5,()=>e.get(n),e.index,(H,F)=>{var L=Xt();let _;var J=e.child(L,!0);e.reset(L),e.template_effect(()=>{_=e.set_style(L,"",_,{"font-weight":d()===e.get(F)?"bold":"normal"}),e.set_text(J,e.get(F))}),e.event("click",L,()=>{s(e.get(F)),o()(d()?d():null)}),e.append(H,L)}),e.reset(m),e.reset(y),e.append(p,y)};e.if(x,p=>{e.get(n),e.untrack(()=>e.get(n).length>0)&&p(k)})}return e.append(u,q),e.pop(b)}function tr(u,t){e.push(t,!1);const n=We();let r=e.mutable_source(!1),o=e.prop(t,"value",12),a=e.prop(t,"watermark",12,null),d=e.prop(t,"i18n",12),s;function b(){e.set(r,!0),s&&clearTimeout(s),s=setTimeout(()=>{e.set(r,!1)},2e3)}async function q(){if("clipboard"in navigator){n("copy",{value:o()});const v=a()?`${o()}

${a()}`:o();await navigator.clipboard.writeText(v),b()}else{const v=document.createElement("textarea"),x=a()?`${o()}

${a()}`:o();v.value=x,v.style.position="absolute",v.style.left="-999999px",document.body.prepend(v),v.select();try{document.execCommand("copy"),b()}catch(k){console.error(k)}finally{v.remove()}}}$e(()=>{s&&clearTimeout(s)});var h={get value(){return o()},set value(v){o(v),e.flush()},get watermark(){return a()},set watermark(v){a(v),e.flush()},get i18n(){return d()},set i18n(v){d(v),e.flush()}};e.init();{let v=e.derived_safe_equal(()=>(e.get(r),e.deep_read_state(d()),e.untrack(()=>e.get(r)?d()("chatbot.copied_message"):d()("chatbot.copy_message")))),x=e.derived_safe_equal(()=>e.get(r)?Pe:Xe);ve(u,{get label(){return e.get(v)},get Icon(){return e.get(x)},$$events:{click:q}})}return e.pop(h)}var rr=e.from_html("<!> <!>",1),ar=e.from_html("<!> <!> <!> <!> <!> <!> <!>",1),nr=e.from_html("<div><!></div>");function Ke(u,t){e.push(t,!1);const n=e.mutable_source(),r=e.mutable_source();let o=e.prop(t,"i18n",12),a=e.prop(t,"likeable",12),d=e.prop(t,"feedback_options",12),s=e.prop(t,"show_retry",12),b=e.prop(t,"show_undo",12),q=e.prop(t,"show_edit",12),h=e.prop(t,"in_edit_mode",12),v=e.prop(t,"show_copy_button",12),x=e.prop(t,"watermark",12,null),k=e.prop(t,"message",12),p=e.prop(t,"position",12),y=e.prop(t,"avatar",12),c=e.prop(t,"generating",12),m=e.prop(t,"current_feedback",12),H=e.prop(t,"file",12,null),F=e.prop(t,"show_download_button",12,!1),L=e.prop(t,"show_share_button",12,!1),_=e.prop(t,"handle_action",12),J=e.prop(t,"layout",12),f=e.prop(t,"dispatch",12);e.legacy_pre_effect(()=>(e.deep_read_state(k()),Oe),()=>{e.set(n,Se(k())?Oe(k()):"")}),e.legacy_pre_effect(()=>(e.deep_read_state(v()),e.deep_read_state(k()),Se),()=>{e.set(r,v()&&k()&&Se(k()))}),e.legacy_pre_effect_reset();var j={get i18n(){return o()},set i18n(g){o(g),e.flush()},get likeable(){return a()},set likeable(g){a(g),e.flush()},get feedback_options(){return d()},set feedback_options(g){d(g),e.flush()},get show_retry(){return s()},set show_retry(g){s(g),e.flush()},get show_undo(){return b()},set show_undo(g){b(g),e.flush()},get show_edit(){return q()},set show_edit(g){q(g),e.flush()},get in_edit_mode(){return h()},set in_edit_mode(g){h(g),e.flush()},get show_copy_button(){return v()},set show_copy_button(g){v(g),e.flush()},get watermark(){return x()},set watermark(g){x(g),e.flush()},get message(){return k()},set message(g){k(g),e.flush()},get position(){return p()},set position(g){p(g),e.flush()},get avatar(){return y()},set avatar(g){y(g),e.flush()},get generating(){return c()},set generating(g){c(g),e.flush()},get current_feedback(){return m()},set current_feedback(g){m(g),e.flush()},get file(){return H()},set file(g){H(g),e.flush()},get show_download_button(){return F()},set show_download_button(g){F(g),e.flush()},get show_share_button(){return L()},set show_share_button(g){L(g),e.flush()},get handle_action(){return _()},set handle_action(g){_(g),e.flush()},get layout(){return J()},set layout(g){J(g),e.flush()},get dispatch(){return f()},set dispatch(g){f(g),e.flush()}};e.init();var M=e.comment(),D=e.first_child(M);{var G=g=>{var X=nr(),N=e.child(X);Ye(N,{top_panel:!1,children:(V,B)=>{var Y=e.comment(),R=e.first_child(Y);{var P=E=>{var Q=rr(),le=e.first_child(Q);{let I=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o()("chatbot.submit"))));ve(le,{get label(){return e.get(I)},get Icon(){return Pe},get disabled(){return c()},$$events:{click:()=>_()("edit_submit")}})}var Z=e.sibling(le,2);{let I=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o()("chatbot.cancel"))));ve(Z,{get label(){return e.get(I)},get Icon(){return gt},get disabled(){return c()},$$events:{click:()=>_()("edit_cancel")}})}e.append(E,Q)},W=E=>{var Q=ar(),le=e.first_child(Q);{var Z=C=>{tr(C,{get value(){return e.get(n)},get watermark(){return x()},get i18n(){return o()},$$events:{copy:S=>f()("copy",S.detail)}})};e.if(le,C=>{e.get(r)&&C(Z)})}var I=e.sibling(le,2);{var ae=C=>{{let S=e.derived_safe_equal(()=>(e.deep_read_state(H()),e.untrack(()=>H().is_stream?H().url?.replace("playlist.m3u8","playlist-file"):H().url))),re=e.derived_safe_equal(()=>(e.deep_read_state(H()),e.untrack(()=>H().orig_name||H().path||"file")));ft(C,{get href(){return e.get(S)},get download(){return e.get(re)},children:($,l)=>{{let w=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o()("common.download"))));ve($,{get Icon(){return pt},get label(){return e.get(w)}})}},$$slots:{default:!0}})}};e.if(I,C=>{e.deep_read_state(F()),e.deep_read_state(H()),e.untrack(()=>F()&&H()?.url)&&C(ae)})}var de=e.sibling(I,2);{var ue=C=>{zt(C,{get i18n(){return o()},formatter:async S=>{if(!S)return"";let re=await Be(S.url);const $=S.mime_type||"";return $.startsWith("audio/")?`<audio controls src="${re}"></audio>`:$.startsWith("video/")?`<video controls src="${re}"></video>`:$.startsWith("image/")?`<img src="${re}" />`:""},get value(){return H()},$$events:{error:S=>f()("error",S.detail),share:S=>f()("share",S.detail)}})};e.if(de,C=>{L()&&H()&&C(ue)})}var oe=e.sibling(de,2);{var z=C=>{{let S=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o()("chatbot.retry"))));ve(C,{get Icon(){return vt},get label(){return e.get(S)},get disabled(){return c()},$$events:{click:()=>_()("retry")}})}};e.if(oe,C=>{s()&&C(z)})}var T=e.sibling(oe,2);{var O=C=>{{let S=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o()("chatbot.undo"))));ve(C,{get label(){return e.get(S)},get Icon(){return ht},get disabled(){return c()},$$events:{click:()=>_()("undo")}})}};e.if(T,C=>{b()&&C(O)})}var ie=e.sibling(T,2);{var K=C=>{{let S=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o()("chatbot.edit"))));ve(C,{get label(){return e.get(S)},get Icon(){return mt},get disabled(){return c()},$$events:{click:()=>_()("edit")}})}};e.if(ie,C=>{q()&&C(K)})}var ne=e.sibling(ie,2);{var _e=C=>{er(C,{get handle_action(){return _()},get feedback_options(){return d()},get selected(){return m()},get i18n(){return o()}})};e.if(ne,C=>{a()&&C(_e)})}e.append(E,Q)};e.if(R,E=>{h()?E(P):E(W,!1)})}e.append(V,Y)},$$slots:{default:!0}}),e.reset(X),e.template_effect(()=>e.set_class(X,1,`message-buttons-${p()??""} ${J()??""} message-buttons ${y()!==null&&"with-avatar"}`,"svelte-704d7y")),e.append(g,X)};e.if(D,g=>{(e.get(r)||s()||b()||q()||a()||F()||L())&&g(G)})}return e.append(u,M),e.pop(j)}var lr=e.from_html('<track kind="captions"/>'),sr=e.from_html("<div><!></div>");function or(u,t){e.push(t,!1);let n=e.prop(t,"type",12),r=e.prop(t,"components",12),o=e.prop(t,"value",12),a=e.prop(t,"target",12),d=e.prop(t,"theme_mode",12),s=e.prop(t,"props",12),b=e.prop(t,"i18n",12),q=e.prop(t,"upload",12),h=e.prop(t,"_fetch",12),v=e.prop(t,"allow_file_downloads",12),x=e.prop(t,"display_icon_button_wrapper_top_corner",12,!1),k=e.mutable_source(!1),p=e.mutable_source();function y(_){e.set(k,_.detail),e.get(k)&&e.get(p)?e.get(p).requestFullscreen?.():document.fullscreenElement&&document.exitFullscreen?.()}var c={get type(){return n()},set type(_){n(_),e.flush()},get components(){return r()},set components(_){r(_),e.flush()},get value(){return o()},set value(_){o(_),e.flush()},get target(){return a()},set target(_){a(_),e.flush()},get theme_mode(){return d()},set theme_mode(_){d(_),e.flush()},get props(){return s()},set props(_){s(_),e.flush()},get i18n(){return b()},set i18n(_){b(_),e.flush()},get upload(){return q()},set upload(_){q(_),e.flush()},get _fetch(){return h()},set _fetch(_){h(_),e.flush()},get allow_file_downloads(){return v()},set allow_file_downloads(_){v(_),e.flush()},get display_icon_button_wrapper_top_corner(){return x()},set display_icon_button_wrapper_top_corner(_){x(_),e.flush()}};e.init();var m=e.comment(),H=e.first_child(m);{var F=_=>{var J=e.comment(),f=e.first_child(J);{let j=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>!!s().label)));e.component(f,()=>r()[n()],(M,D)=>{D(M,e.spread_props(s,{get value(){return o()},display_icon_button_wrapper_top_corner:!1,get show_label(){return e.get(j)},get i18n(){return b()},get _fetch(){return h()},allow_preview:!1,interactive:!1,mode:"minimal",fixed_height:1,$$events:{load(G){e.bubble_event.call(this,t,G)}}}))})}e.append(_,J)},L=_=>{var J=e.comment(),f=e.first_child(J);{var j=D=>{var G=e.comment(),g=e.first_child(G);{let X=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>!!s().label))),N=e.derived_safe_equal(()=>({dispatch:()=>{},i18n:b()}));e.component(g,()=>r()[n()],(V,B)=>{B(V,e.spread_props(s,{get value(){return o()},get show_label(){return e.get(X)},get i18n(){return b()},interactive:!1,get line_breaks(){return e.deep_read_state(s()),e.untrack(()=>s().line_breaks)},wrap:!0,root:"",get gradio(){return e.get(N)},get datatype(){return e.deep_read_state(s()),e.untrack(()=>s().datatype)},get latex_delimiters(){return e.deep_read_state(s()),e.untrack(()=>s().latex_delimiters)},get col_count(){return e.deep_read_state(s()),e.untrack(()=>s().col_count)},get row_count(){return e.deep_read_state(s()),e.untrack(()=>s().row_count)},$$events:{load(Y){e.bubble_event.call(this,t,Y)}}}))})}e.append(D,G)},M=D=>{var G=e.comment(),g=e.first_child(G);{var X=V=>{var B=e.comment(),Y=e.first_child(B);{let R=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>s().caption||"")));e.component(Y,()=>r()[n()],(P,W)=>{W(P,e.spread_props(s,{get value(){return o()},get target(){return a()},get theme_mode(){return d()},on_change:()=>{},get bokeh_version(){return e.deep_read_state(s()),e.untrack(()=>s().bokeh_version)},get caption(){return e.get(R)},show_actions_button:!0,$$events:{load(E){e.bubble_event.call(this,t,E)}}}))})}e.append(V,B)},N=V=>{var B=e.comment(),Y=e.first_child(B);{var R=W=>{var E=e.comment(),Q=e.first_child(E);{let le=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>!!s().label))),Z=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>({...s().waveform_settings,autoplay:s().autoplay}))));e.component(Q,()=>r()[n()],(I,ae)=>{ae(I,e.spread_props(s,{get value(){return o()},get show_label(){return e.get(le)},show_share_button:!1,get i18n(){return b()},get waveform_settings(){return e.get(Z)},show_download_button:!1,display_icon_button_wrapper_top_corner:!1,minimal:!0,$$events:{load(de){e.bubble_event.call(this,t,de)}}}))})}e.append(W,E)},P=W=>{var E=e.comment(),Q=e.first_child(E);{var le=I=>{var ae=e.comment(),de=e.first_child(ae);{let ue=e.derived_safe_equal(()=>(e.deep_read_state(o()),e.untrack(()=>o().video||o()))),oe=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>!!s().label)));e.component(de,()=>r()[n()],(z,T)=>{T(z,e.spread_props(s,{get autoplay(){return e.deep_read_state(s()),e.untrack(()=>s().autoplay)},get value(){return e.get(ue)},get show_label(){return e.get(oe)},show_share_button:!1,get i18n(){return b()},get upload(){return q()},display_icon_button_wrapper_top_corner:!1,show_download_button:!1,$$events:{load(O){e.bubble_event.call(this,t,O)}},children:(O,ie)=>{var K=lr();e.append(O,K)},$$slots:{default:!0}}))})}e.append(I,ae)},Z=I=>{var ae=e.comment(),de=e.first_child(ae);{var ue=z=>{var T=sr(),O=e.child(T);{let ie=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>!!s().label)));e.component(O,()=>r()[n()],(K,ne)=>{ne(K,e.spread_props(s,{get value(){return o()},get show_label(){return e.get(ie)},display_icon_button_wrapper_top_corner:!1,buttons:["fullscreen"],get fullscreen(){return e.get(k)},show_button_background:!1,get i18n(){return b()},$$events:{fullscreen:y,load(_e){e.bubble_event.call(this,t,_e)}}}))})}e.reset(T),e.bind_this(T,ie=>e.set(p,ie),()=>e.get(p)),e.append(z,T)},oe=z=>{var T=e.comment(),O=e.first_child(T);{var ie=ne=>{var _e=e.comment(),C=e.first_child(_e);e.component(C,()=>r()[n()],(S,re)=>{re(S,e.spread_props(s,{get value(){return o()},show_label:!1,show_share_button:!1,get i18n(){return b()},gradio:{dispatch:()=>{}},$$events:{load($){e.bubble_event.call(this,t,$)}}}))}),e.append(ne,_e)},K=ne=>{var _e=e.comment(),C=e.first_child(_e);{var S=re=>{var $=e.comment(),l=e.first_child($);{let w=e.derived_safe_equal(()=>(e.deep_read_state(s()),e.untrack(()=>!!s().label))),ee=e.derived_safe_equal(()=>({dispatch:()=>{},i18n:b()}));e.component(l,()=>r()[n()],(ge,be)=>{be(ge,e.spread_props(s,{get value(){return o()},get clear_color(){return e.deep_read_state(s()),e.untrack(()=>s().clear_color)},get display_mode(){return e.deep_read_state(s()),e.untrack(()=>s().display_mode)},get zoom_speed(){return e.deep_read_state(s()),e.untrack(()=>s().zoom_speed)},get pan_speed(){return e.deep_read_state(s()),e.untrack(()=>s().pan_speed)}},()=>s().camera_position!==void 0&&{camera_position:s().camera_position},{has_change_history:!0,get show_label(){return e.get(w)},root:"",interactive:!1,show_share_button:!1,get gradio(){return e.get(ee)},get i18n(){return b()},$$events:{load(ke){e.bubble_event.call(this,t,ke)}}}))})}e.append(re,$)};e.if(C,re=>{n()==="model3d"&&re(S)},!0)}e.append(ne,_e)};e.if(O,ne=>{n()==="html"?ne(ie):ne(K,!1)},!0)}e.append(z,T)};e.if(de,z=>{n()==="image"?z(ue):z(oe,!1)},!0)}e.append(I,ae)};e.if(Q,I=>{n()==="video"?I(le):I(Z,!1)},!0)}e.append(W,E)};e.if(Y,W=>{n()==="audio"?W(R):W(P,!1)},!0)}e.append(V,B)};e.if(g,V=>{n()==="plot"?V(X):V(N,!1)},!0)}e.append(D,G)};e.if(f,D=>{n()==="dataframe"?D(j):D(M,!1)},!0)}e.append(_,J)};e.if(H,_=>{n()==="gallery"?_(F):_(L,!1)})}return e.append(u,m),e.pop(c)}var ir=e.from_html('<div class="message-content"><!></div>'),_r=e.from_html('<div class="file-container svelte-e5gd5s"><div class="file-icon svelte-e5gd5s"><!></div> <div class="file-info svelte-e5gd5s"><a data-testid="chatbot-file" class="file-link svelte-e5gd5s" target="_blank"><span class="file-name svelte-e5gd5s"> </span></a> <span class="file-type svelte-e5gd5s"> </span></div></div>');function et(u,t){e.push(t,!1);let n=e.prop(t,"latex_delimiters",12),r=e.prop(t,"sanitize_html",12),o=e.prop(t,"_fetch",12),a=e.prop(t,"i18n",12),d=e.prop(t,"line_breaks",12),s=e.prop(t,"upload",12),b=e.prop(t,"target",12),q=e.prop(t,"theme_mode",12),h=e.prop(t,"_components",12),v=e.prop(t,"render_markdown",12),x=e.prop(t,"scroll",12),k=e.prop(t,"allow_file_downloads",12),p=e.prop(t,"display_consecutive_in_same_bubble",12),y=e.prop(t,"thought_index",12),c=e.prop(t,"allow_tags",12,!1),m=e.prop(t,"message",12);var H={get latex_delimiters(){return n()},set latex_delimiters(f){n(f),e.flush()},get sanitize_html(){return r()},set sanitize_html(f){r(f),e.flush()},get _fetch(){return o()},set _fetch(f){o(f),e.flush()},get i18n(){return a()},set i18n(f){a(f),e.flush()},get line_breaks(){return d()},set line_breaks(f){d(f),e.flush()},get upload(){return s()},set upload(f){s(f),e.flush()},get target(){return b()},set target(f){b(f),e.flush()},get theme_mode(){return q()},set theme_mode(f){q(f),e.flush()},get _components(){return h()},set _components(f){h(f),e.flush()},get render_markdown(){return v()},set render_markdown(f){v(f),e.flush()},get scroll(){return x()},set scroll(f){x(f),e.flush()},get allow_file_downloads(){return k()},set allow_file_downloads(f){k(f),e.flush()},get display_consecutive_in_same_bubble(){return p()},set display_consecutive_in_same_bubble(f){p(f),e.flush()},get thought_index(){return y()},set thought_index(f){y(f),e.flush()},get allow_tags(){return c()},set allow_tags(f){c(f),e.flush()},get message(){return m()},set message(f){m(f),e.flush()}};e.init();var F=e.comment(),L=e.first_child(F);{var _=f=>{var j=ir(),M=e.child(j);Ue(M,{get message(){return e.deep_read_state(m()),e.untrack(()=>m().content)},get latex_delimiters(){return n()},get sanitize_html(){return r()},get render_markdown(){return v()},get line_breaks(){return d()},get allow_tags(){return c()},get theme_mode(){return q()},$$events:{load(...D){x()?.apply(this,D)}}}),e.reset(j),e.append(f,j)},J=f=>{var j=e.comment(),M=e.first_child(j);{var D=g=>{{let X=e.derived_safe_equal(()=>y()>0&&p());or(g,{get target(){return b()},get theme_mode(){return q()},get props(){return e.deep_read_state(m()),e.untrack(()=>m().content.props)},get type(){return e.deep_read_state(m()),e.untrack(()=>m().content.component)},get components(){return h()},get value(){return e.deep_read_state(m()),e.untrack(()=>m().content.value)},get display_icon_button_wrapper_top_corner(){return e.get(X)},get i18n(){return a()},get upload(){return s()},get _fetch(){return o()},get allow_file_downloads(){return k()},$$events:{load:()=>x()()}})}},G=g=>{var X=e.comment(),N=e.first_child(X);{var V=B=>{var Y=_r(),R=e.child(Y),P=e.child(R);Fe(P),e.reset(R);var W=e.sibling(R,2),E=e.child(W),Q=e.child(E),le=e.child(Q,!0);e.reset(Q),e.reset(E);var Z=e.sibling(E,2),I=e.child(Z,!0);e.reset(Z),e.reset(W),e.reset(Y),e.template_effect((ae,de,ue)=>{e.set_attribute(E,"href",(e.deep_read_state(m()),e.untrack(()=>m().content.value.url))),e.set_attribute(E,"download",ae),e.set_text(le,de),e.set_text(I,ue)},[()=>(e.deep_read_state(m()),e.untrack(()=>window.__is_colab__?null:m().content.value?.orig_name||m().content.value?.path.split("/").pop()||"file")),()=>(e.deep_read_state(m()),e.untrack(()=>m().content.value?.orig_name||m().content.value?.path.split("/").pop()||"file")),()=>(e.deep_read_state(m()),e.untrack(()=>(m().content.value?.orig_name||m().content.value?.path||"").split(".").pop().toUpperCase()))]),e.append(B,Y)};e.if(N,B=>{e.deep_read_state(m()),e.untrack(()=>m().type==="component"&&m().content.component==="file")&&B(V)},!0)}e.append(g,X)};e.if(M,g=>{e.deep_read_state(m()),e.deep_read_state(h()),e.untrack(()=>m().type==="component"&&m().content.component in h())?g(D):g(G,!1)},!0)}e.append(f,j)};e.if(L,f=>{e.deep_read_state(m()),e.untrack(()=>m().type==="text")?f(_):f(J,!1)})}return e.append(u,F),e.pop(H)}var dr=e.from_html('<span class="loading-spinner svelte-18cn3o3"></span>'),ur=e.from_html("(<!>)",1),cr=e.from_html('<span class="duration svelte-18cn3o3"><!> <!></span>'),gr=e.from_html('<div class="children svelte-18cn3o3"></div>'),fr=e.from_html("<div><!> <!></div>"),pr=e.from_html('<div class="thought-group svelte-18cn3o3"><div role="button" tabindex="0"><span class="arrow svelte-18cn3o3"><!></span> <!> <!> <!></div> <!></div>');function tt(u,t){e.push(t,!0);function n(j){return"children"in j}let r=e.state(!1),o,a=e.state(!1),d=e.derived(()=>({...t.thought,children:n(t.thought)?t.thought.children:[]})),s=e.state(!1);e.user_effect(()=>{e.get(r)||e.set(s,e.get(d)?.metadata?.status!=="done")});function b(){e.set(s,!e.get(s)),e.set(r,!0)}function q(){o&&!e.get(a)&&(o.scrollTop=o.scrollHeight)}function h(){o&&(o.scrollHeight-o.scrollTop<=o.clientHeight+10||e.set(a,!0))}e.user_effect(()=>{e.get(d).content&&e.get(d).metadata?.status!=="done"&&setTimeout(q,0)});var v=pr(),x=e.child(v);let k;var p=e.child(x);let y;var c=e.child(p);ve(c,{get Icon(){return bt}}),e.reset(p);var m=e.sibling(p,2);{let j=e.derived(()=>e.get(d).metadata?.title||""),M=e.derived(()=>t.allow_tags||!1);Ue(m,{get message(){return e.get(j)},get render_markdown(){return t.render_markdown},get latex_delimiters(){return t.latex_delimiters},get sanitize_html(){return t.sanitize_html},get allow_tags(){return e.get(M)}})}var H=e.sibling(m,2);{var F=j=>{var M=dr();e.append(j,M)};e.if(H,j=>{e.get(d).metadata?.status==="pending"&&j(F)})}var L=e.sibling(H,2);{var _=j=>{var M=cr(),D=e.child(M);{var G=N=>{var V=e.text();e.template_effect(()=>e.set_text(V,e.get(d).metadata.log)),e.append(N,V)};e.if(D,N=>{e.get(d).metadata.log&&N(G)})}var g=e.sibling(D,2);{var X=N=>{var V=ur(),B=e.sibling(e.first_child(V));{var Y=P=>{var W=e.text();e.template_effect(()=>e.set_text(W,`${e.get(d).metadata.duration??""}s`)),e.append(P,W)},R=P=>{var W=e.comment(),E=e.first_child(W);{var Q=Z=>{var I=e.text();e.template_effect(ae=>e.set_text(I,`${ae??""}s`),[()=>e.get(d).metadata.duration.toFixed(1)]),e.append(Z,I)},le=Z=>{var I=e.text();e.template_effect(ae=>e.set_text(I,`${ae??""}ms`),[()=>(e.get(d).metadata.duration*1e3).toFixed(1)]),e.append(Z,I)};e.if(E,Z=>{e.get(d).metadata.duration>=.1?Z(Q):Z(le,!1)},!0)}e.append(P,W)};e.if(B,P=>{Number.isInteger(e.get(d).metadata.duration)?P(Y):P(R,!1)})}e.next(),e.append(N,V)};e.if(g,N=>{e.get(d).metadata.duration!==void 0&&N(X)})}e.reset(M),e.append(j,M)};e.if(L,j=>{(e.get(d)?.metadata?.log||e.get(d)?.metadata?.duration)&&j(_)})}e.reset(x);var J=e.sibling(x,2);{var f=j=>{var M=fr();let D;var G=e.child(M);et(G,{get message(){return e.get(d)},get sanitize_html(){return t.sanitize_html},get allow_tags(){return t.allow_tags},get latex_delimiters(){return t.latex_delimiters},get render_markdown(){return t.render_markdown},get _components(){return t._components},get upload(){return t.upload},get thought_index(){return t.thought_index},get target(){return t.target},get theme_mode(){return t.theme_mode},get _fetch(){return t._fetch},get scroll(){return t.scroll},get allow_file_downloads(){return t.allow_file_downloads},get display_consecutive_in_same_bubble(){return t.display_consecutive_in_same_bubble},get i18n(){return t.i18n},get line_breaks(){return t.line_breaks}});var g=e.sibling(G,2);{var X=N=>{var V=gr();e.each(V,21,()=>e.get(d).children,e.index,(B,Y)=>{var R=e.comment(),P=e.first_child(R);{let W=e.derived(()=>t.rtl||!1),E=e.derived(()=>t.thought_index+1);tt(P,{get thought(){return e.get(Y)},get rtc(){return e.get(W)},get sanitize_html(){return t.sanitize_html},get latex_delimiters(){return t.latex_delimiters},get render_markdown(){return t.render_markdown},get _components(){return t._components},get upload(){return t.upload},get thought_index(){return e.get(E)},get target(){return t.target},get theme_mode(){return t.theme_mode},get _fetch(){return t._fetch},get scroll(){return t.scroll},get allow_file_downloads(){return t.allow_file_downloads},get display_consecutive_in_same_bubble(){return t.display_consecutive_in_same_bubble},get i18n(){return t.i18n},get line_breaks(){return t.line_breaks}})}e.append(B,R)}),e.reset(V),e.append(N,V)};e.if(g,N=>{e.get(d).children?.length>0&&N(X)})}e.reset(M),e.bind_this(M,N=>o=N,()=>o),e.template_effect(()=>D=e.set_class(M,1,"svelte-18cn3o3",null,D,{content:e.get(s),"content-preview":!e.get(s)&&e.get(d).metadata?.status!=="done"})),e.event("scroll",M,h),e.transition(3,M,()=>jt),e.append(j,M)};e.if(J,j=>{e.get(s)&&j(f)})}e.reset(v),e.template_effect(()=>{k=e.set_class(x,1,"title svelte-18cn3o3",null,k,{expanded:e.get(s)}),e.set_attribute(x,"aria-busy",e.get(d).content===""||e.get(d).content===null),y=e.set_style(p,"",y,{transform:e.get(s)?"rotate(180deg)":"rotate(0deg)"})}),e.event("click",x,e.stopPropagation(b)),e.event("keydown",x,j=>j.key==="Enter"&&b()),e.append(u,v),e.pop()}var vr=e.from_html('<div class="avatar-container svelte-1nr59td"><!></div>'),hr=e.from_html('<textarea class="edit-textarea svelte-1nr59td"></textarea>'),mr=e.from_html("<div><!></div>"),br=e.from_html("<div><!></div> <!>",1),wr=e.from_html("<div><!> <div><div></div></div></div> <!>",1);function kr(u,t){e.push(t,!1);let n=e.prop(t,"value",12),r=e.prop(t,"avatar_img",12),o=e.prop(t,"opposite_avatar_img",12,null),a=e.prop(t,"role",12,"user"),d=e.prop(t,"messages",28,()=>[]),s=e.prop(t,"layout",12),b=e.prop(t,"render_markdown",12),q=e.prop(t,"latex_delimiters",12),h=e.prop(t,"sanitize_html",12),v=e.prop(t,"selectable",12),x=e.prop(t,"_fetch",12),k=e.prop(t,"rtl",12),p=e.prop(t,"dispatch",12),y=e.prop(t,"i18n",12),c=e.prop(t,"line_breaks",12),m=e.prop(t,"upload",12),H=e.prop(t,"target",12),F=e.prop(t,"theme_mode",12),L=e.prop(t,"_components",12),_=e.prop(t,"i",12),J=e.prop(t,"show_copy_button",12),f=e.prop(t,"generating",12),j=e.prop(t,"feedback_options",12),M=e.prop(t,"show_like",12),D=e.prop(t,"show_edit",12),G=e.prop(t,"show_retry",12),g=e.prop(t,"show_undo",12),X=e.prop(t,"handle_action",12),N=e.prop(t,"scroll",12),V=e.prop(t,"allow_file_downloads",12),B=e.prop(t,"in_edit_mode",12),Y=e.prop(t,"edit_messages",12),R=e.prop(t,"display_consecutive_in_same_bubble",12),P=e.prop(t,"current_feedback",12,null),W=e.prop(t,"allow_tags",12,!1),E=e.prop(t,"watermark",12,null),Q=e.mutable_source([]),le=e.mutable_source(Array(d().length).fill(160)),Z=e.mutable_source(Array(d().length).fill(0));function I(l,w){p()("select",{index:w.index,value:w.content})}function ae(l){return l.type==="text"?l.content:l.type==="component"&&l.content.component==="file"?Array.isArray(l.content.value)?`file of extension type: ${l.content.value[0].orig_name?.split(".").pop()}`:`file of extension type: ${l.content.value?.orig_name?.split(".").pop()}`+(l.content.value?.orig_name??""):`a component of type ${l.content.component??"unknown"}`}function de(l){for(const w of l)if(w.type==="component"&&(w.content.component==="audio"||w.content.component==="video"||w.content.component==="image"||w.content.component==="file")&&w.content.value)return w.content.value;return null}let ue=e.mutable_source();e.legacy_pre_effect(()=>(e.deep_read_state(B()),e.get(Q),e.deep_read_state(d())),()=>{if(B()){const l=e.get(Q).length-d().length;for(let w=l;w<e.get(Q).length;w++)w>=0&&(e.mutate(le,e.get(le)[w-l]=e.get(Q)[w]?.clientWidth),e.mutate(Z,e.get(Z)[w-l]=e.get(Q)[w]?.clientHeight))}}),e.legacy_pre_effect(()=>(e.deep_read_state(X()),e.deep_read_state(M()),e.deep_read_state(j()),e.deep_read_state(G()),e.deep_read_state(g()),e.deep_read_state(D()),e.deep_read_state(B()),e.deep_read_state(f()),e.deep_read_state(J()),e.deep_read_state(d()),e.deep_read_state(a()),e.deep_read_state(r()),e.deep_read_state(s()),e.deep_read_state(p()),e.deep_read_state(P()),e.deep_read_state(E()),e.deep_read_state(V())),()=>{e.set(ue,{handle_action:X(),likeable:M(),feedback_options:j(),show_retry:G(),show_undo:g(),show_edit:D(),in_edit_mode:B(),generating:f(),show_copy_button:J(),message:d(),position:a()==="user"?"right":"left",avatar:r(),layout:s(),dispatch:p(),current_feedback:P(),watermark:E(),file:de(d()),show_download_button:V(),show_share_button:!0})}),e.legacy_pre_effect_reset();var oe={get value(){return n()},set value(l){n(l),e.flush()},get avatar_img(){return r()},set avatar_img(l){r(l),e.flush()},get opposite_avatar_img(){return o()},set opposite_avatar_img(l){o(l),e.flush()},get role(){return a()},set role(l){a(l),e.flush()},get messages(){return d()},set messages(l){d(l),e.flush()},get layout(){return s()},set layout(l){s(l),e.flush()},get render_markdown(){return b()},set render_markdown(l){b(l),e.flush()},get latex_delimiters(){return q()},set latex_delimiters(l){q(l),e.flush()},get sanitize_html(){return h()},set sanitize_html(l){h(l),e.flush()},get selectable(){return v()},set selectable(l){v(l),e.flush()},get _fetch(){return x()},set _fetch(l){x(l),e.flush()},get rtl(){return k()},set rtl(l){k(l),e.flush()},get dispatch(){return p()},set dispatch(l){p(l),e.flush()},get i18n(){return y()},set i18n(l){y(l),e.flush()},get line_breaks(){return c()},set line_breaks(l){c(l),e.flush()},get upload(){return m()},set upload(l){m(l),e.flush()},get target(){return H()},set target(l){H(l),e.flush()},get theme_mode(){return F()},set theme_mode(l){F(l),e.flush()},get _components(){return L()},set _components(l){L(l),e.flush()},get i(){return _()},set i(l){_(l),e.flush()},get show_copy_button(){return J()},set show_copy_button(l){J(l),e.flush()},get generating(){return f()},set generating(l){f(l),e.flush()},get feedback_options(){return j()},set feedback_options(l){j(l),e.flush()},get show_like(){return M()},set show_like(l){M(l),e.flush()},get show_edit(){return D()},set show_edit(l){D(l),e.flush()},get show_retry(){return G()},set show_retry(l){G(l),e.flush()},get show_undo(){return g()},set show_undo(l){g(l),e.flush()},get handle_action(){return X()},set handle_action(l){X(l),e.flush()},get scroll(){return N()},set scroll(l){N(l),e.flush()},get allow_file_downloads(){return V()},set allow_file_downloads(l){V(l),e.flush()},get in_edit_mode(){return B()},set in_edit_mode(l){B(l),e.flush()},get edit_messages(){return Y()},set edit_messages(l){Y(l),e.flush()},get display_consecutive_in_same_bubble(){return R()},set display_consecutive_in_same_bubble(l){R(l),e.flush()},get current_feedback(){return P()},set current_feedback(l){P(l),e.flush()},get allow_tags(){return W()},set allow_tags(l){W(l),e.flush()},get watermark(){return E()},set watermark(l){E(l),e.flush()}};e.init();var z=wr(),T=e.first_child(z);let O;var ie=e.child(T);{var K=l=>{var w=vr(),ee=e.child(w);{let ge=e.derived_safe_equal(()=>(e.deep_read_state(r()),e.untrack(()=>r()?.url)));Me(ee,{class:"avatar-image",get src(){return e.get(ge)},get alt(){return`${a()??""} avatar`}})}e.reset(w),e.append(l,w)};e.if(ie,l=>{r()!==null&&l(K)})}var ne=e.sibling(ie,2);let _e;var C=e.child(ne);let S;e.each(C,5,d,e.index,(l,w,ee)=>{var ge=br(),be=e.first_child(ge);let ke;var he=e.child(be);{var Ce=te=>{var U=hr();e.remove_textarea_child(U),e.autofocus(U,!0);let ce;e.template_effect(()=>ce=e.set_style(U,"",ce,{width:(e.get(le),e.untrack(()=>`max(${e.get(le)[ee]}px, 160px)`)),"min-height":(e.get(Z),e.untrack(()=>`${e.get(Z)[ee]}px`))})),e.bind_value(U,()=>Y()[ee],ye=>Y(Y()[ee]=ye,!0)),e.append(te,U)},Le=te=>{var U=mr();let ce,ye;var pe=e.child(U);{var se=A=>{tt(A,{get thought(){return e.get(w)},get rtl(){return k()},get sanitize_html(){return h()},get allow_tags(){return W()},get latex_delimiters(){return q()},get render_markdown(){return b()},get _components(){return L()},get upload(){return m()},thought_index:ee,get target(){return H()},get theme_mode(){return F()},get _fetch(){return x()},get scroll(){return N()},get allow_file_downloads(){return V()},get display_consecutive_in_same_bubble(){return R()},get i18n(){return y()},get line_breaks(){return c()}})},we=A=>{et(A,{get message(){return e.get(w)},get sanitize_html(){return h()},get allow_tags(){return W()},get latex_delimiters(){return q()},get render_markdown(){return b()},get _components(){return L()},get upload(){return m()},thought_index:ee,get target(){return H()},get theme_mode(){return F()},get _fetch(){return x()},get scroll(){return N()},get allow_file_downloads(){return V()},get display_consecutive_in_same_bubble(){return R()},get i18n(){return y()},get line_breaks(){return c()}})};e.if(pe,A=>{e.get(w),e.untrack(()=>e.get(w)?.metadata?.title)?A(se):A(we,!1)})}e.reset(U),e.bind_this(U,(A,me)=>e.mutate(Q,e.get(Q)[me]=A),A=>e.get(Q)?.[A],()=>[ee]),e.template_effect(A=>{e.set_attribute(U,"data-testid",a()),e.set_attribute(U,"dir",k()?"rtl":"ltr"),e.set_attribute(U,"aria-label",A),ce=e.set_class(U,1,"svelte-1nr59td",null,ce,{latest:_()===n().length-1,"message-markdown-disabled":!b(),selectable:v()}),ye=e.set_style(U,"",ye,{"user-select":"text",cursor:v()?"pointer":"auto","text-align":k()?"right":"left"}),U.dir=U.dir},[()=>(e.deep_read_state(a()),e.get(w),e.untrack(()=>a()+"'s message: "+ae(e.get(w))))]),e.event("click",U,()=>I(_(),e.get(w))),e.event("keydown",U,A=>{A.key==="Enter"&&I(_(),e.get(w))}),e.append(te,U)};e.if(he,te=>{e.deep_read_state(B()),e.get(w),e.untrack(()=>B()&&e.get(w).type==="text")?te(Ce):te(Le,!1)})}e.reset(be);var i=e.sibling(be,2);{var fe=te=>{Ke(te,e.spread_props(()=>e.get(ue),{get current_feedback(){return P()},get watermark(){return E()},get i18n(){return y()},$$events:{copy:U=>p()("copy",U.detail)}}))};e.if(i,te=>{s()==="panel"&&te(fe)})}e.template_effect(te=>ke=e.set_class(be,1,`message ${(R()?"":a())??""}`,"svelte-1nr59td",ke,te),[()=>({"panel-full-width":!0,"message-markdown-disabled":!b(),component:e.get(w).type==="component",html:St(e.get(w))&&e.get(w).content.component==="html",thought:ee>0})]),e.append(l,ge)}),e.reset(C),e.reset(ne),e.reset(T);var re=e.sibling(T,2);{var $=l=>{Ke(l,e.spread_props(()=>e.get(ue),{get i18n(){return y()}}))};e.if(re,l=>{s()==="bubble"&&l($)})}return e.template_effect(()=>{O=e.set_class(T,1,`message-row ${s()??""} ${a()??""}-row`,"svelte-1nr59td",O,{with_avatar:r()!==null,with_opposite_avatar:o()!==null}),_e=e.set_class(ne,1,"flex-wrap svelte-1nr59td",null,_e,{role:a(),"component-wrap":d()[0].type==="component"}),S=e.set_class(C,1,e.clsx(R()?a():""),"svelte-1nr59td",S,{message:R()})}),e.append(u,z),e.pop(oe)}var yr=e.from_html('<div class="avatar-container svelte-stpvyx"><!></div>'),xr=e.from_html('<div class="container svelte-stpvyx"><!> <div role="status" aria-label="Loading response" aria-live="polite"><div class="message-content svelte-stpvyx"><span class="sr-only svelte-stpvyx">Loading content</span> <div class="dots svelte-stpvyx"><div class="dot svelte-stpvyx"></div> <div class="dot svelte-stpvyx"></div> <div class="dot svelte-stpvyx"></div></div></div></div></div>');function Qe(u,t){e.push(t,!1);let n=e.prop(t,"layout",12,"bubble"),r=e.prop(t,"avatar_images",28,()=>[null,null]);var o={get layout(){return n()},set layout(h){n(h),e.flush()},get avatar_images(){return r()},set avatar_images(h){r(h),e.flush()}};e.init();var a=xr(),d=e.child(a);{var s=h=>{var v=yr(),x=e.child(v);Me(x,{class:"avatar-image",get src(){return e.deep_read_state(r()),e.untrack(()=>r()[1].url)},alt:"bot avatar"}),e.reset(v),e.append(h,v)};e.if(d,h=>{e.deep_read_state(r()),e.untrack(()=>r()[1]!==null)&&h(s)})}var b=e.sibling(d,2);let q;return e.reset(a),e.template_effect(()=>q=e.set_class(b,1,`message bot pending ${n()??""}`,"svelte-stpvyx",q,{with_avatar:r()[1]!==null,with_opposite_avatar:r()[0]!==null})),e.append(u,a),e.pop(o)}var Cr=e.from_html('<div class="placeholder svelte-1rn3hyj"><!></div>'),qr=e.from_html('<div class="example-image-container svelte-1rn3hyj"><!></div>'),Hr=e.from_html('<div class="example-icon svelte-1rn3hyj" aria-hidden="true"><span class="text-icon-aa svelte-1rn3hyj">Aa</span></div>'),zr=e.from_html('<div class="image-overlay svelte-1rn3hyj" role="status"> </div>'),jr=e.from_html('<div class="example-image-container svelte-1rn3hyj"><!> <!></div>'),Lr=e.from_html('<div class="image-overlay svelte-1rn3hyj" role="status"> </div>'),Vr=e.from_html('<div class="example-image-container svelte-1rn3hyj"><video class="example-image" aria-hidden="true"></video> <!></div>',2),Mr=e.from_html('<div class="example-icon svelte-1rn3hyj"><!></div>'),Ir=e.from_html('<div class="example-icon svelte-1rn3hyj"><div class="file-overlay svelte-1rn3hyj" role="status"> </div></div>'),Tr=e.from_html('<div class="example-icons-grid svelte-1rn3hyj" role="group" aria-label="Example attachments"><!> <!></div>'),Ar=e.from_html('<div class="example-image-container svelte-1rn3hyj"><!></div>'),Dr=e.from_html('<div class="example-image-container svelte-1rn3hyj"><video class="example-image" aria-hidden="true"></video></div>',2),Er=e.from_html('<div class="example-icon svelte-1rn3hyj"><!></div>'),Sr=e.from_html('<div class="example-icon svelte-1rn3hyj"><!></div>'),Br=e.from_html('<button class="example svelte-1rn3hyj"><div class="example-content svelte-1rn3hyj"><!> <div class="example-text-content svelte-1rn3hyj"><span class="example-text svelte-1rn3hyj"> </span></div></div></button>'),Fr=e.from_html('<div class="examples svelte-1rn3hyj" role="list"></div>'),Zr=e.from_html('<div class="placeholder-content svelte-1rn3hyj" role="complementary"><!> <!></div>');function Pr(u,t){e.push(t,!1);let n=e.prop(t,"examples",12,null),r=e.prop(t,"placeholder",12,null),o=e.prop(t,"latex_delimiters",12);const a=We();function d(k,p){const y=typeof p=="string"?{text:p}:p;a("example_select",{index:k,value:{text:y.text,files:y.files}})}var s={get examples(){return n()},set examples(k){n(k),e.flush()},get placeholder(){return r()},set placeholder(k){r(k),e.flush()},get latex_delimiters(){return o()},set latex_delimiters(k){o(k),e.flush()}};e.init();var b=Zr(),q=e.child(b);{var h=k=>{var p=Cr(),y=e.child(p);Ue(y,{get message(){return r()},get latex_delimiters(){return o()}}),e.reset(p),e.append(k,p)};e.if(q,k=>{r()!==null&&k(h)})}var v=e.sibling(q,2);{var x=k=>{var p=Fr();e.each(p,5,n,e.index,(y,c,m)=>{var H=Br(),F=e.child(H),L=e.child(F);{var _=D=>{var G=qr(),g=e.child(G);Me(g,{class:"example-image",get src(){return e.get(c),e.untrack(()=>e.get(c).icon.url)},alt:"Example icon"}),e.reset(G),e.append(D,G)},J=D=>{var G=e.comment(),g=e.first_child(G);{var X=V=>{var B=Hr();e.append(V,B)},N=V=>{var B=e.comment(),Y=e.first_child(B);{var R=P=>{var W=e.comment(),E=e.first_child(W);{var Q=Z=>{var I=Tr(),ae=e.child(I);e.each(ae,1,()=>(e.get(c),e.untrack(()=>e.get(c).files.slice(0,4))),e.index,(oe,z,T,O)=>{var ie=e.comment(),K=e.first_child(ie);{var ne=C=>{var S=jr(),re=e.child(S);{let w=e.derived_safe_equal(()=>(e.get(z),e.untrack(()=>e.get(z).orig_name||`Example image ${T+1}`)));Me(re,{class:"example-image",get src(){return e.get(z),e.untrack(()=>e.get(z).url)},get alt(){return e.get(w)}})}var $=e.sibling(re,2);{var l=w=>{var ee=zr(),ge=e.child(ee);e.reset(ee),e.template_effect(()=>{e.set_attribute(ee,"aria-label",(e.get(c),e.untrack(()=>`${e.get(c).files.length-4} more files`))),e.set_text(ge,`+${e.get(c),e.untrack(()=>e.get(c).files.length-4)??""}`)}),e.append(w,ee)};e.if($,w=>{e.get(c),e.untrack(()=>T===3&&e.get(c).files.length>4)&&w(l)})}e.reset(S),e.append(C,S)},_e=C=>{var S=e.comment(),re=e.first_child(S);{var $=w=>{var ee=Vr(),ge=e.child(ee),be=e.sibling(ge,2);{var ke=he=>{var Ce=Lr(),Le=e.child(Ce);e.reset(Ce),e.template_effect(()=>{e.set_attribute(Ce,"aria-label",(e.get(c),e.untrack(()=>`${e.get(c).files.length-4} more files`))),e.set_text(Le,`+${e.get(c),e.untrack(()=>e.get(c).files.length-4)??""}`)}),e.append(he,Ce)};e.if(be,he=>{e.get(c),e.untrack(()=>T===3&&e.get(c).files.length>4)&&he(ke)})}e.reset(ee),e.template_effect(()=>e.set_attribute(ge,"src",(e.get(z),e.untrack(()=>e.get(z).url)))),e.append(w,ee)},l=w=>{var ee=Mr(),ge=e.child(ee);{var be=he=>{Ge(he)},ke=he=>{Fe(he)};e.if(ge,he=>{e.get(z),e.untrack(()=>e.get(z).mime_type?.includes("audio"))?he(be):he(ke,!1)})}e.reset(ee),e.template_effect(()=>e.set_attribute(ee,"aria-label",(e.get(z),e.untrack(()=>`File: ${e.get(z).orig_name}`)))),e.append(w,ee)};e.if(re,w=>{e.get(z),e.untrack(()=>e.get(z).mime_type?.includes("video"))?w($):w(l,!1)},!0)}e.append(C,S)};e.if(K,C=>{e.get(z),e.untrack(()=>e.get(z).mime_type?.includes("image"))?C(ne):C(_e,!1)})}e.append(oe,ie)});var de=e.sibling(ae,2);{var ue=oe=>{var z=Ir(),T=e.child(z),O=e.child(T);e.reset(T),e.reset(z),e.template_effect(()=>{e.set_attribute(T,"aria-label",(e.get(c),e.untrack(()=>`${e.get(c).files.length-4} more files`))),e.set_text(O,`+${e.get(c),e.untrack(()=>e.get(c).files.length-4)??""}`)}),e.append(oe,z)};e.if(de,oe=>{e.get(c),e.untrack(()=>e.get(c).files.length>4)&&oe(ue)})}e.reset(I),e.append(Z,I)},le=Z=>{var I=e.comment(),ae=e.first_child(I);{var de=oe=>{var z=Ar(),T=e.child(z);{let O=e.derived_safe_equal(()=>(e.get(c),e.untrack(()=>e.get(c).files[0].orig_name||"Example image")));Me(T,{class:"example-image",get src(){return e.get(c),e.untrack(()=>e.get(c).files[0].url)},get alt(){return e.get(O)}})}e.reset(z),e.append(oe,z)},ue=oe=>{var z=e.comment(),T=e.first_child(z);{var O=K=>{var ne=Dr(),_e=e.child(ne);e.reset(ne),e.template_effect(()=>e.set_attribute(_e,"src",(e.get(c),e.untrack(()=>e.get(c).files[0].url)))),e.append(K,ne)},ie=K=>{var ne=e.comment(),_e=e.first_child(ne);{var C=re=>{var $=Er(),l=e.child($);Ge(l),e.reset($),e.template_effect(()=>e.set_attribute($,"aria-label",(e.get(c),e.untrack(()=>`File: ${e.get(c).files[0].orig_name}`)))),e.append(re,$)},S=re=>{var $=Sr(),l=e.child($);Fe(l),e.reset($),e.template_effect(()=>e.set_attribute($,"aria-label",(e.get(c),e.untrack(()=>`File: ${e.get(c).files[0].orig_name}`)))),e.append(re,$)};e.if(_e,re=>{e.get(c),e.untrack(()=>e.get(c).files[0].mime_type?.includes("audio"))?re(C):re(S,!1)},!0)}e.append(K,ne)};e.if(T,K=>{e.get(c),e.untrack(()=>e.get(c).files[0].mime_type?.includes("video"))?K(O):K(ie,!1)},!0)}e.append(oe,z)};e.if(ae,oe=>{e.get(c),e.untrack(()=>e.get(c).files[0].mime_type?.includes("image"))?oe(de):oe(ue,!1)},!0)}e.append(Z,I)};e.if(E,Z=>{e.get(c),e.untrack(()=>e.get(c).files.length>1)?Z(Q):Z(le,!1)})}e.append(P,W)};e.if(Y,P=>{e.get(c),e.untrack(()=>e.get(c).files!==void 0&&e.get(c).files.length>0)&&P(R)},!0)}e.append(V,B)};e.if(g,V=>{e.get(c),e.untrack(()=>e.get(c)?.icon?.mime_type==="text")?V(X):V(N,!1)},!0)}e.append(D,G)};e.if(L,D=>{e.get(c),e.untrack(()=>e.get(c)?.icon?.url)?D(_):D(J,!1)})}var f=e.sibling(L,2),j=e.child(f),M=e.child(j,!0);e.reset(j),e.reset(f),e.reset(F),e.reset(H),e.template_effect(()=>{e.set_attribute(H,"aria-label",(e.get(c),e.untrack(()=>`Select example ${m+1}: ${e.get(c).display_text||e.get(c).text}`))),e.set_text(M,(e.get(c),e.untrack(()=>e.get(c).display_text||e.get(c).text)))}),e.event("click",H,()=>d(m,typeof e.get(c)=="string"?{text:e.get(c)}:e.get(c))),e.append(y,H)}),e.reset(p),e.append(k,p)};e.if(v,k=>{n()!==null&&k(x)})}return e.reset(b),e.append(u,b),e.pop(s)}function Wr(u,t){e.push(t,!1);let n=e.mutable_source(!1),r=e.prop(t,"value",12),o=e.prop(t,"watermark",12,null),a;function d(){e.set(n,!0),a&&clearTimeout(a),a=setTimeout(()=>{e.set(n,!1)},1e3)}const s=()=>{if(r()){const h=r().map(x=>x.type==="text"?`${x.role}: ${x.content}`:`${x.role}: ${x.content.value.url}`).join(`

`),v=o()?`${h}

${o()}`:h;navigator.clipboard.writeText(v).catch(x=>{console.error("Failed to copy conversation: ",x)})}};async function b(){"clipboard"in navigator&&(s(),d())}$e(()=>{a&&clearTimeout(a)});var q={get value(){return r()},set value(h){r(h),e.flush()},get watermark(){return o()},set watermark(h){o(h),e.flush()}};e.init();{let h=e.derived_safe_equal(()=>e.get(n)?Pe:Xe),v=e.derived_safe_equal(()=>e.get(n)?"Copied conversation":"Copy conversation");ve(u,{get Icon(){return e.get(h)},get label(){return e.get(v)},$$events:{click:b}})}return e.pop(q)}var Ur=e.from_html("<!> <!> <!>",1),Gr=e.from_html("<!> <!>",1),Nr=e.from_html('<button class="option svelte-kpz1"> </button>'),Or=e.from_html('<div class="options svelte-kpz1"></div>'),Jr=e.from_html('<div class="message-wrap svelte-kpz1"><!> <!></div>'),Rr=e.from_html('<div class="scroll-down-button-container svelte-kpz1"><!></div>'),Kr=e.from_html('<!> <div role="log" aria-label="chatbot conversation" aria-live="polite"><!></div> <!>',1);function Qr(u,t){e.push(t,!1);const n=e.mutable_source(),r=e.mutable_source(),o=e.mutable_source();let a=e.prop(t,"value",28,()=>[]),d=e.mutable_source(null),s=e.prop(t,"_fetch",12),b=e.prop(t,"load_component",12),q=e.prop(t,"allow_file_downloads",12),h=e.prop(t,"display_consecutive_in_same_bubble",12),v=e.mutable_source({});const x=typeof window<"u";async function k(){e.set(v,await Ft(Ne(a()),e.get(v),b()))}let p=e.prop(t,"latex_delimiters",12),y=e.prop(t,"pending_message",12,!1),c=e.prop(t,"generating",12,!1),m=e.prop(t,"selectable",12,!1),H=e.prop(t,"likeable",12,!1),F=e.prop(t,"feedback_options",12),L=e.prop(t,"feedback_value",12,null),_=e.prop(t,"editable",12,null),J=e.prop(t,"show_share_button",12,!1),f=e.prop(t,"show_copy_all_button",12,!1),j=e.prop(t,"rtl",12,!1),M=e.prop(t,"show_copy_button",12,!1),D=e.prop(t,"buttons",12,null),G=e.prop(t,"on_custom_button_click",12,null),g=e.prop(t,"avatar_images",28,()=>[null,null]),X=e.prop(t,"sanitize_html",12,!0),N=e.prop(t,"render_markdown",12,!0),V=e.prop(t,"line_breaks",12,!0),B=e.prop(t,"autoscroll",12,!0),Y=e.prop(t,"theme_mode",12),R=e.prop(t,"i18n",12),P=e.prop(t,"layout",12,"bubble"),W=e.prop(t,"placeholder",12,null),E=e.prop(t,"upload",12),Q=e.prop(t,"examples",12,null),le=e.prop(t,"_retryable",12,!1),Z=e.prop(t,"_undoable",12,!1),I=e.prop(t,"like_user_message",12,!1),ae=e.prop(t,"allow_tags",12,!1),de=e.prop(t,"watermark",12,null),ue=e.prop(t,"show_progress",12,"full"),oe=e.mutable_source(null),z=e.mutable_source(null),T=e.mutable_source([]);De(()=>{e.set(oe,document.querySelector("div.gradio-container"))});let O=e.mutable_source(),ie=e.mutable_source(!1);const K=We();function ne(){return e.get(O)&&e.get(O).offsetHeight+e.get(O).scrollTop>e.get(O).scrollHeight-100}function _e(){e.get(O)&&(e.get(O).scrollTo(0,e.get(O).scrollHeight),e.set(ie,!1))}async function C(){B()&&ne()&&(await Ht(),await new Promise(i=>setTimeout(i,300)),_e())}De(()=>{B()&&_e(),C()}),De(()=>{function i(){ne()?e.set(ie,!1):e.set(ie,!0)}return e.get(O)?.addEventListener("scroll",i),()=>{e.get(O)?.removeEventListener("scroll",i)}});function S(i,fe,te){if(te==="undo"||te==="retry"){const U=a();let ce=U.length-1;for(;U[ce].role==="assistant";)ce--;K(te,{index:U[ce].index,value:U[ce].content})}else if(te=="edit")e.set(z,i),e.get(T).push(fe.content);else if(te=="edit_cancel")e.set(z,null);else if(te=="edit_submit")e.set(z,null),K("edit",{index:fe.index,_dispatch_value:[{type:"text",text:e.get(T)[i].slice()}],value:e.get(T)[i].slice(),previous_value:fe.content});else{let U=te==="Like"?!0:te==="Dislike"?!1:te||"";if(!e.get(r))return;const ce=e.get(r)[i],[ye]=[ce[0],ce[ce.length-1]];K("like",{index:ye.index,value:ce.map(pe=>pe.content),liked:U})}}function re(){if(!a()||!e.get(r)||e.get(r).length===0)return;const i=e.get(r)[e.get(r).length-1];if(i[0].role==="assistant")return i[i.length-1].options}e.legacy_pre_effect(()=>e.deep_read_state(a()),()=>{e.set(n,Ne(a()).sort().join(", "))}),e.legacy_pre_effect(()=>e.get(n),()=>{e.get(n),k()}),e.legacy_pre_effect(()=>(e.deep_read_state(a()),e.deep_read_state(y()),e.get(v)),()=>{(a()||y()||e.get(v))&&C()}),e.legacy_pre_effect(()=>(e.deep_read_state(a()),e.get(d)),()=>{Lt(a(),e.get(d))||(e.set(d,a()),K("change"))}),e.legacy_pre_effect(()=>(e.deep_read_state(a()),e.deep_read_state(h())),()=>{e.set(r,a()&&Bt(a(),h()))}),e.legacy_pre_effect(()=>e.deep_read_state(a()),()=>{e.set(o,a()&&re())}),e.legacy_pre_effect_reset();var $={get value(){return a()},set value(i){a(i),e.flush()},get _fetch(){return s()},set _fetch(i){s(i),e.flush()},get load_component(){return b()},set load_component(i){b(i),e.flush()},get allow_file_downloads(){return q()},set allow_file_downloads(i){q(i),e.flush()},get display_consecutive_in_same_bubble(){return h()},set display_consecutive_in_same_bubble(i){h(i),e.flush()},get latex_delimiters(){return p()},set latex_delimiters(i){p(i),e.flush()},get pending_message(){return y()},set pending_message(i){y(i),e.flush()},get generating(){return c()},set generating(i){c(i),e.flush()},get selectable(){return m()},set selectable(i){m(i),e.flush()},get likeable(){return H()},set likeable(i){H(i),e.flush()},get feedback_options(){return F()},set feedback_options(i){F(i),e.flush()},get feedback_value(){return L()},set feedback_value(i){L(i),e.flush()},get editable(){return _()},set editable(i){_(i),e.flush()},get show_share_button(){return J()},set show_share_button(i){J(i),e.flush()},get show_copy_all_button(){return f()},set show_copy_all_button(i){f(i),e.flush()},get rtl(){return j()},set rtl(i){j(i),e.flush()},get show_copy_button(){return M()},set show_copy_button(i){M(i),e.flush()},get buttons(){return D()},set buttons(i){D(i),e.flush()},get on_custom_button_click(){return G()},set on_custom_button_click(i){G(i),e.flush()},get avatar_images(){return g()},set avatar_images(i){g(i),e.flush()},get sanitize_html(){return X()},set sanitize_html(i){X(i),e.flush()},get render_markdown(){return N()},set render_markdown(i){N(i),e.flush()},get line_breaks(){return V()},set line_breaks(i){V(i),e.flush()},get autoscroll(){return B()},set autoscroll(i){B(i),e.flush()},get theme_mode(){return Y()},set theme_mode(i){Y(i),e.flush()},get i18n(){return R()},set i18n(i){R(i),e.flush()},get layout(){return P()},set layout(i){P(i),e.flush()},get placeholder(){return W()},set placeholder(i){W(i),e.flush()},get upload(){return E()},set upload(i){E(i),e.flush()},get examples(){return Q()},set examples(i){Q(i),e.flush()},get _retryable(){return le()},set _retryable(i){le(i),e.flush()},get _undoable(){return Z()},set _undoable(i){Z(i),e.flush()},get like_user_message(){return I()},set like_user_message(i){I(i),e.flush()},get allow_tags(){return ae()},set allow_tags(i){ae(i),e.flush()},get watermark(){return de()},set watermark(i){de(i),e.flush()},get show_progress(){return ue()},set show_progress(i){ue(i),e.flush()}};e.init();var l=Kr(),w=e.first_child(l);{var ee=i=>{Ye(i,{get buttons(){return D()},get on_custom_button_click(){return G()},children:(fe,te)=>{var U=Ur(),ce=e.first_child(U);{var ye=A=>{ve(A,{get Icon(){return kt},$$events:{click:async()=>{try{const me=await Mt(a());K("share",{description:me})}catch(me){console.error(me);let qe=me instanceof dt?me.message:"Share failed.";K("error",qe)}}}})};e.if(ce,A=>{J()&&A(ye)})}var pe=e.sibling(ce,2);{let A=e.derived_safe_equal(()=>(e.deep_read_state(R()),e.untrack(()=>R()("chatbot.clear"))));ve(pe,{get Icon(){return wt},get label(){return e.get(A)},$$events:{click:()=>K("clear")}})}var se=e.sibling(pe,2);{var we=A=>{Wr(A,{get value(){return a()},get watermark(){return de()}})};e.if(se,A=>{f()&&A(we)})}e.append(fe,U)},$$slots:{default:!0}})};e.if(w,i=>{e.deep_read_state(a()),e.untrack(()=>a()!==null&&a().length>0)&&i(ee)})}var ge=e.sibling(w,2),be=e.child(ge);{var ke=i=>{var fe=Jr(),te=e.child(fe);e.each(te,1,()=>e.get(r),e.index,(pe,se,we)=>{const A=e.derived_safe_equal(()=>(e.get(se),e.untrack(()=>e.get(se)[0].role==="user"?"user":"bot"))),me=e.derived_safe_equal(()=>(e.deep_read_state(g()),e.deep_read_state(e.get(A)),e.untrack(()=>g()[e.get(A)==="user"?0:1]))),qe=e.derived_safe_equal(()=>(e.deep_read_state(g()),e.deep_read_state(e.get(A)),e.untrack(()=>g()[e.get(A)==="user"?0:1]))),Ve=e.derived_safe_equal(()=>(e.get(r),e.untrack(()=>e.get(r).slice(0,we).filter(ze=>ze[0].role==="assistant").length))),je=e.derived_safe_equal(()=>(e.deep_read_state(e.get(A)),e.deep_read_state(L()),e.deep_read_state(e.get(Ve)),e.untrack(()=>e.get(A)==="bot"&&L()&&L()[e.get(Ve)]?L()[e.get(Ve)]:null)));var Ie=Gr(),He=e.first_child(Ie);{let ze=e.derived_safe_equal(()=>e.get(A)==="user"?H()&&I():H()),at=e.derived_safe_equal(()=>(e.deep_read_state(le()),e.deep_read_state(Te),e.get(se),e.deep_read_state(a()),e.untrack(()=>le()&&Te(e.get(se),a())))),nt=e.derived_safe_equal(()=>(e.deep_read_state(Z()),e.deep_read_state(Te),e.get(se),e.deep_read_state(a()),e.untrack(()=>Z()&&Te(e.get(se),a())))),lt=e.derived_safe_equal(()=>(e.deep_read_state(_()),e.deep_read_state(e.get(A)),e.get(se),e.untrack(()=>_()==="all"||_()=="user"&&e.get(A)==="user"&&e.get(se).length>0&&e.get(se)[e.get(se).length-1].type=="text"))),st=e.derived_safe_equal(()=>e.get(z)===we),ot=e.derived_safe_equal(()=>x?scroll:()=>{});kr(He,{get messages(){return e.get(se)},get display_consecutive_in_same_bubble(){return h()},get opposite_avatar_img(){return e.get(qe)},get avatar_img(){return e.get(me)},get role(){return e.get(A)},get layout(){return P()},get dispatch(){return K},get i18n(){return R()},get _fetch(){return s()},get line_breaks(){return V()},get theme_mode(){return Y()},get target(){return e.get(oe)},get upload(){return E()},get selectable(){return m()},get sanitize_html(){return X()},get render_markdown(){return N()},get rtl(){return j()},i:we,get value(){return a()},get latex_delimiters(){return p()},get _components(){return e.get(v)},get generating(){return c()},get feedback_options(){return F()},get current_feedback(){return e.get(je)},get allow_tags(){return ae()},get watermark(){return de()},get show_like(){return e.get(ze)},get show_retry(){return e.get(at)},get show_undo(){return e.get(nt)},get show_edit(){return e.get(lt)},get in_edit_mode(){return e.get(st)},get show_copy_button(){return M()},handle_action:xe=>{xe=="edit"&&e.get(T).splice(0,e.get(T).length),xe==="edit"||xe==="edit_submit"?e.get(se).forEach((it,_t)=>{S(xe==="edit"?we:_t,it,xe)}):S(we,e.get(se)[0],xe)},get scroll(){return e.get(ot)},get allow_file_downloads(){return q()},get edit_messages(){return e.get(T)},set edit_messages(xe){e.set(T,xe)},$$events:{copy:xe=>K("copy",xe.detail)},$$legacy:!0})}var Ae=e.sibling(He,2);{var rt=ze=>{Qe(ze,{get layout(){return P()},get avatar_images(){return g()}})};e.if(Ae,ze=>{e.deep_read_state(ue()),e.deep_read_state(c()),e.get(se),e.untrack(()=>ue()!=="hidden"&&c()&&e.get(se)[e.get(se).length-1].role==="assistant"&&e.get(se)[e.get(se).length-1].metadata?.status==="done")&&ze(rt)})}e.append(pe,Ie)});var U=e.sibling(te,2);{var ce=pe=>{Qe(pe,{get layout(){return P()},get avatar_images(){return g()}})},ye=pe=>{var se=e.comment(),we=e.first_child(se);{var A=me=>{var qe=Or();e.each(qe,5,()=>e.get(o),e.index,(Ve,je,Ie)=>{var He=Nr(),Ae=e.child(He,!0);e.reset(He),e.template_effect(()=>e.set_text(Ae,(e.get(je),e.untrack(()=>e.get(je).label||e.get(je).value)))),e.event("click",He,()=>K("option_select",{index:Ie,value:e.get(je).value})),e.append(Ve,He)}),e.reset(qe),e.append(me,qe)};e.if(we,me=>{e.get(o)&&me(A)},!0)}e.append(pe,se)};e.if(U,pe=>{ue()!=="hidden"&&y()?pe(ce):pe(ye,!1)})}e.reset(fe),e.action(fe,pe=>ut?.(pe)),e.append(i,fe)},he=i=>{Pr(i,{get examples(){return Q()},get placeholder(){return W()},get latex_delimiters(){return p()},$$events:{example_select:fe=>K("example_select",fe.detail)}})};e.if(be,i=>{e.deep_read_state(a()),e.get(r),e.untrack(()=>a()!==null&&a().length>0&&e.get(r)!==null)?i(ke):i(he,!1)})}e.reset(ge),e.bind_this(ge,i=>e.set(O,i),()=>e.get(O));var Ce=e.sibling(ge,2);{var Le=i=>{var fe=Rr(),te=e.child(fe);ve(te,{get Icon(){return yt},label:"Scroll down",size:"large",$$events:{click:_e}}),e.reset(fe),e.append(i,fe)};e.if(Ce,i=>{e.get(ie)&&i(Le)})}return e.template_effect(()=>e.set_class(ge,1,e.clsx(P()==="bubble"?"bubble-wrap":"panel-wrap"),"svelte-kpz1")),e.append(u,l),e.pop($)}var Xr=e.from_html('<!> <div class="wrapper svelte-1wizwbi"><!> <!></div>',1);function Ha(u,t){e.push(t,!0);let n=e.rest_props(t,["$$slots","$$events","$$legacy"]);const r=new ct(n);let o=e.derived(()=>Et(r.props.value,r.shared.root)),a=e.derived(()=>r.shared.loading_status.status==="error"?"full":r.shared.loading_status.show_progress==="hidden"?"hidden":"minimal");xt(u,{get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},padding:!1,get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},get height(){return r.props.height},get resizable(){return r.props.resizable},get min_height(){return r.props.min_height},get max_height(){return r.props.max_height},allow_overflow:!0,flex:!0,overflow_behavior:"auto",children:(d,s)=>{var b=Xr(),q=e.first_child(b);{var h=y=>{Vt(y,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{get show_progress(){return e.get(a)},on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}))};e.if(q,y=>{r.shared.loading_status&&y(h)})}var v=e.sibling(q,2),x=e.child(v);{var k=y=>{{let c=e.derived(()=>r.shared.label||"Chatbot");Ct(y,{get show_label(){return r.shared.show_label},get Icon(){return qt},float:!0,get label(){return e.get(c)}})}};e.if(x,y=>{r.shared.show_label&&y(k)})}var p=e.sibling(x,2);{let y=e.derived(()=>(r.props.buttons??["share"]).some(_=>typeof _=="string"&&_==="share")),c=e.derived(()=>(r.props.buttons??["copy_all"]).some(_=>typeof _=="string"&&_==="copy_all")),m=e.derived(()=>r.shared.loading_status?.status==="pending"),H=e.derived(()=>r.shared.loading_status?.status==="generating"),F=e.derived(()=>(r.props.buttons??["copy"]).some(_=>typeof _=="string"&&_==="copy")),L=e.derived(()=>r.shared.loading_status?.show_progress||"full");Qr(p,{get i18n(){return r.i18n},get selectable(){return r.props._selectable},get likeable(){return r.props.likeable},get feedback_options(){return r.props.feedback_options},get feedback_value(){return r.props.feedback_value},get show_share_button(){return e.get(y)},get show_copy_all_button(){return e.get(c)},get value(){return e.get(o)},get latex_delimiters(){return r.props.latex_delimiters},get display_consecutive_in_same_bubble(){return r.props.group_consecutive_messages},get render_markdown(){return r.props.render_markdown},get theme_mode(){return r.shared.theme_mode},get editable(){return r.props.editable},get pending_message(){return e.get(m)},get generating(){return e.get(H)},get rtl(){return r.props.rtl},get show_copy_button(){return e.get(F)},get buttons(){return r.props.buttons},on_custom_button_click:_=>{r.dispatch("custom_button_click",{id:_})},get like_user_message(){return r.props.like_user_message},get show_progress(){return e.get(L)},get avatar_images(){return r.props.avatar_images},get sanitize_html(){return r.props.sanitize_html},get line_breaks(){return r.props.line_breaks},get autoscroll(){return r.props.autoscroll},get layout(){return r.props.layout},get placeholder(){return r.props.placeholder},get examples(){return r.props.examples},get _retryable(){return r.props._retryable},get _undoable(){return r.props._undoable},upload:(..._)=>r.shared.client.upload(..._),_fetch:(..._)=>r.shared.client.fetch(..._),get load_component(){return r.shared.load_component},get allow_file_downloads(){return r.props.allow_file_downloads},get allow_tags(){return r.props.allow_tags},get watermark(){return r.props.watermark},$$events:{change:()=>(r.props.value=r.props.value,r.dispatch("change",r.props.value)),select:_=>r.dispatch("select",_.detail),like:_=>r.dispatch("like",_.detail),share:_=>r.dispatch("share",_.detail),error:_=>r.dispatch("error",_.detail),example_select:_=>r.dispatch("example_select",_.detail),option_select:_=>r.dispatch("option_select",_.detail),retry:_=>r.dispatch("retry",_.detail),undo:_=>r.dispatch("undo",_.detail),clear:()=>{r.props.value=[],r.dispatch("clear")},copy:_=>r.dispatch("copy",_.detail),edit:_=>{r.props.value===null||r.props.value.length===0||(r.props.value[_.detail.index].content=[{text:_.detail.value,type:"text"}],r.dispatch("edit",_.detail))}}})}e.reset(v),e.append(d,b)},$$slots:{default:!0}}),e.pop()}export{Qr as BaseChatBot,Ha as default};
