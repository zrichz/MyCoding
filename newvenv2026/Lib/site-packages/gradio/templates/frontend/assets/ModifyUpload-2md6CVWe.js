import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{createEventDispatcher as Q,onMount as ie,onDestroy as oe,tick as de}from"./svelte/svelte_svelte.js";import{p as ue}from"./index-Dw8Uzof1.js";import{c as fe,I as N,l as _e,s as ce,f as pe,j as ge,D as he}from"./IconButtonWrapper-D4LMIc_2.js";import"./i18n-CyvX8KmK.js";var me=e.from_html('<div class="file svelte-ua961l"><span><div class="progress-bar svelte-ua961l"><progress style="visibility:hidden;height:0;width:0;" max="100" class="svelte-ua961l"> </progress></div></span> <span class="file-name svelte-ua961l"> </span></div>'),ve=e.from_html('<div><span class="uploading svelte-ua961l"> </span> <!></div>');function be(d,r){e.push(r,!1);let n=e.prop(r,"upload_id",12),L=e.prop(r,"root",12),b=e.prop(r,"files",12),a=e.prop(r,"stream_handler",12),h,w=e.mutable_source(!1),c=e.mutable_source(),m=e.mutable_source(),u=e.mutable_source(b().map(o=>({...o,progress:0})));const i=Q();function A(o,g){e.set(u,e.get(u).map(E=>(E.orig_name===o&&(E.progress+=g),E)))}function y(o){return o.progress*100/(o.size||0)||0}ie(async()=>{if(h=await a()(new URL(`${L()}/gradio_api/upload_progress?upload_id=${n()}`)),h==null)throw new Error("Event source is not defined");h.onmessage=async function(o){const g=JSON.parse(o.data);e.get(w)||e.set(w,!0),g.msg==="done"?(h?.close(),i("done")):(e.set(c,g),A(g.orig_name,g.chunk_size))}}),oe(()=>{(h!=null||h!=null)&&h.close()});function C(o){let g=0;return o.forEach(E=>{g+=y(E)}),document.documentElement.style.setProperty("--upload-progress-width",(g/o.length).toFixed(2)+"%"),g/o.length}e.legacy_pre_effect(()=>e.get(u),()=>{C(e.get(u))}),e.legacy_pre_effect(()=>(e.get(c),e.get(u)),()=>{e.set(m,e.get(c)||e.get(u)[0])}),e.legacy_pre_effect_reset();var P={get upload_id(){return n()},set upload_id(o){n(o),e.flush()},get root(){return L()},set root(o){L(o),e.flush()},get files(){return b()},set files(o){b(o),e.flush()},get stream_handler(){return a()},set stream_handler(o){a(o),e.flush()}};e.init();var W=ve();let D;var z=e.child(W),p=e.child(z);e.reset(z);var v=e.sibling(z,2);{var k=o=>{var g=me(),E=e.child(g),F=e.child(E),j=e.child(F),T=e.child(j,!0);e.reset(j),e.reset(F),e.reset(E);var M=e.sibling(E,2),R=e.child(M,!0);e.reset(M),e.reset(g),e.template_effect((I,G)=>{e.set_value(j,I),e.set_text(T,G),e.set_text(R,(e.get(m),e.untrack(()=>e.get(m).orig_name)))},[()=>(e.get(m),e.untrack(()=>y(e.get(m)))),()=>(e.get(m),e.untrack(()=>y(e.get(m))))]),e.append(o,g)};e.if(v,o=>{e.get(m)&&o(k)})}return e.reset(W),e.template_effect(()=>{D=e.set_class(W,1,"wrap svelte-ua961l",null,D,{progress:e.get(w)}),e.set_text(p,`Uploading ${e.get(u),e.untrack(()=>e.get(u).length)??""}
		${e.get(u),e.untrack(()=>e.get(u).length>1?"files":"file")??""}...`)}),e.append(d,W),e.pop(P)}function ye(){let d,r;return{drag(n,L={}){r=L;function b(){d=document.createElement("input"),d.type="file",d.style.display="none",d.setAttribute("aria-label","File upload"),d.setAttribute("data-testid","file-upload");const i=Array.isArray(r.accepted_types)?r.accepted_types.join(","):r.accepted_types||void 0;i&&(d.accept=i),d.multiple=r.mode==="multiple"||!1,r.mode==="directory"&&(d.webkitdirectory=!0,d.setAttribute("directory",""),d.setAttribute("mozdirectory","")),n.appendChild(d)}b();function a(i){i.preventDefault(),i.stopPropagation()}function h(i){i.preventDefault(),i.stopPropagation(),r.on_drag_change?.(!0)}function w(i){i.preventDefault(),i.stopPropagation(),r.on_drag_change?.(!1)}function c(i){if(i.preventDefault(),i.stopPropagation(),r.on_drag_change?.(!1),!i.dataTransfer?.files)return;const A=Array.from(i.dataTransfer.files);A.length>0&&r.on_files?.(A)}function m(){r.disable_click||(d.value="",d.click())}function u(){if(d.files){const i=Array.from(d.files);i.length>0&&r.on_files?.(i)}}return n.addEventListener("drag",a),n.addEventListener("dragstart",a),n.addEventListener("dragend",a),n.addEventListener("dragover",a),n.addEventListener("dragenter",h),n.addEventListener("dragleave",w),n.addEventListener("drop",c),n.addEventListener("click",m),d.addEventListener("change",u),{update(i){r=i,d.remove(),b(),d.addEventListener("change",u)},destroy(){n.removeEventListener("drag",a),n.removeEventListener("dragstart",a),n.removeEventListener("dragend",a),n.removeEventListener("dragover",a),n.removeEventListener("dragenter",h),n.removeEventListener("dragleave",w),n.removeEventListener("drop",c),n.removeEventListener("click",m),d.removeEventListener("change",u),d.remove()}}},open_file_upload(){d&&(d.value="",d.click())}}}var we=e.from_html("<button><!></button>"),ke=e.from_html('<button aria-dropeffect="copy"><!></button>');function De(d,r){e.push(r,!1);const n=e.mutable_source(),{drag:L,open_file_upload:b}=ye();let a=e.prop(r,"filetype",12,null),h=e.prop(r,"dragging",12,!1),w=e.prop(r,"boundedheight",12,!0),c=e.prop(r,"center",12,!0),m=e.prop(r,"flex",12,!0),u=e.prop(r,"file_count",12,"single"),i=e.prop(r,"disable_click",12,!1),A=e.prop(r,"root",12),y=e.prop(r,"hidden",12,!1),C=e.prop(r,"format",12,"file"),P=e.prop(r,"uploading",12,!1),W=e.prop(r,"show_progress",12,!0),D=e.prop(r,"max_file_size",12,null),z=e.prop(r,"upload",12),p=e.prop(r,"stream_handler",12),v=e.prop(r,"icon_upload",12,!1),k=e.prop(r,"height",12,void 0),o=e.prop(r,"aria_label",12,void 0),g=e.prop(r,"upload_promise",12,null);function E(){b()}let F=e.mutable_source(""),j=e.mutable_source(),T=e.mutable_source(),M=null;const R=()=>{if(typeof navigator<"u"){const t=navigator.userAgent.toLowerCase();return t.indexOf("iphone")>-1||t.indexOf("ipad")>-1}return!1},I=Q(),G=["image","video","audio","text","file"],H=t=>e.get(n)&&t.startsWith(".")?(M=!0,t):e.get(n)&&t.includes("file/*")?"*":t.startsWith(".")||t.endsWith("/*")?t:G.includes(t)?t+"/*":"."+t;function K(){navigator.clipboard.read().then(async t=>{for(let s=0;s<t.length;s++){const f=t[s].types.find(l=>l.startsWith("image/"));if(f){t[s].getType(f).then(async l=>{const _=new File([l],`clipboard.${f.replace("image/","")}`);await O([_])});break}}})}function V(){b()}function $(t,s){return g(new Promise(async(f,l)=>{await de(),s?e.set(F,s):e.set(F,Math.random().toString(36).substring(2,15)),P(!0);try{const _=await z()(t,A(),e.get(F),D()??1/0);return I("load",u()==="single"?_?.[0]:_),f(_||[]),P(!1),_||[]}catch(_){I("error",_.message),P(!1),f([])}})),g()}function ee(t,s,f){if(!t||t==="*"||t==="file/*"||Array.isArray(t)&&t.some(_=>_==="*"||_==="file/*"))return!0;let l;if(typeof t=="string")l=t.split(",").map(_=>_.trim());else if(Array.isArray(t))l=t;else return!1;return l.includes(s)||l.some(_=>{const[U]=_.split("/").map(x=>x.trim());return _.endsWith("/*")&&f.startsWith(U+"/")})}async function O(t,s){if(!t.length)return;let f=t.map(l=>new File([l],l instanceof File?l.name:"file",{type:l.type}));return e.get(n)&&M&&(f=f.filter(l=>X(l)?!0:(I("error",`Invalid file type: ${l.name}. Only ${a()} allowed.`),!1)),f.length===0)?[]:(e.set(j,await ue(f)),await $(e.get(j),s))}function X(t){return a()?(Array.isArray(a())?a():[a()]).some(f=>{const l=H(f);if(l.startsWith("."))return t.name.toLowerCase().endsWith(l.toLowerCase());if(l==="*")return!0;if(l.endsWith("/*")){const[_]=l.split("/");return t.type.startsWith(_+"/")}return t.type===l}):!0}async function te(t){const s=t.filter(f=>{const l="."+f.name.toLowerCase().split(".").pop();return l&&ee(e.get(T),l,f.type)||(l&&Array.isArray(a())?a().includes(l):l===a())?!0:(I("error",`Invalid file type only ${a()} allowed.`),!1)});if(C()!="blob")await O(s);else{if(u()==="single"){I("load",s[0]);return}I("load",s)}}async function Y(t){if(h(!1),!t.dataTransfer?.files)return;const s=Array.from(t.dataTransfer.files).filter(X);if(C()!="blob")await O(s);else{if(u()==="single"){I("load",s[0]);return}I("load",s)}}e.legacy_pre_effect(()=>{},()=>{e.set(n,R())}),e.legacy_pre_effect(()=>(e.deep_read_state(a()),e.get(n)),()=>{a()==null?e.set(T,null):typeof a()=="string"?e.set(T,H(a())):e.get(n)&&a().includes("file/*")?e.set(T,"*"):(a(a().map(H)),e.set(T,a().join(", ")))}),e.legacy_pre_effect_reset();var re={open_upload:E,paste_clipboard:K,open_file_upload:V,load_files:O,load_files_from_drop:Y,get filetype(){return a()},set filetype(t){a(t),e.flush()},get dragging(){return h()},set dragging(t){h(t),e.flush()},get boundedheight(){return w()},set boundedheight(t){w(t),e.flush()},get center(){return c()},set center(t){c(t),e.flush()},get flex(){return m()},set flex(t){m(t),e.flush()},get file_count(){return u()},set file_count(t){u(t),e.flush()},get disable_click(){return i()},set disable_click(t){i(t),e.flush()},get root(){return A()},set root(t){A(t),e.flush()},get hidden(){return y()},set hidden(t){y(t),e.flush()},get format(){return C()},set format(t){C(t),e.flush()},get uploading(){return P()},set uploading(t){P(t),e.flush()},get show_progress(){return W()},set show_progress(t){W(t),e.flush()},get max_file_size(){return D()},set max_file_size(t){D(t),e.flush()},get upload(){return z()},set upload(t){z(t),e.flush()},get stream_handler(){return p()},set stream_handler(t){p(t),e.flush()},get icon_upload(){return v()},set icon_upload(t){v(t),e.flush()},get height(){return k()},set height(t){k(t),e.flush()},get aria_label(){return o()},set aria_label(t){o(t),e.flush()},get upload_promise(){return g()},set upload_promise(t){g(t),e.flush()}};e.init();var Z=e.comment(),ae=e.first_child(Z);{var le=t=>{var s=we();let f,l;var _=e.child(s);e.slot(_,r,"default",{},null),e.reset(s),e.template_effect(()=>{e.set_attribute(s,"tabindex",y()?-1:0),e.set_attribute(s,"aria-label",o()||"Paste from clipboard"),f=e.set_class(s,1,"svelte-8prmba",null,f,{hidden:y(),center:c(),boundedheight:w(),flex:m(),"icon-mode":v()}),l=e.set_style(s,"",l,{height:v()?"":k()?typeof k()=="number"?k()+"px":k():"100%"})}),e.event("click",s,K),e.append(t,s)},ne=t=>{var s=e.comment(),f=e.first_child(s);{var l=U=>{var x=e.comment(),S=e.first_child(x);{var J=B=>{be(B,{get root(){return A()},get upload_id(){return e.get(F)},get files(){return e.get(j)},get stream_handler(){return p()}})};e.if(S,B=>{y()||B(J)})}e.append(U,x)},_=U=>{var x=ke();let S,J;var B=e.child(x);e.slot(B,r,"default",{},null),e.reset(x),e.action(x,(q,se)=>L?.(q,se),()=>({on_drag_change:q=>q=q,on_files:q=>te(q),accepted_types:e.get(T),mode:u(),disable_click:i()})),e.template_effect(()=>{e.set_attribute(x,"tabindex",y()?-1:0),e.set_attribute(x,"aria-label",o()||"Click to upload or drop files"),S=e.set_class(x,1,"svelte-8prmba",null,S,{hidden:y(),center:c(),boundedheight:w(),flex:m(),disable_click:i(),"icon-mode":v()}),J=e.set_style(x,"",J,{height:v()?"":k()?typeof k()=="number"?k()+"px":k():"100%"})}),e.append(U,x)};e.if(f,U=>{P()&&W()?U(l):U(_,!1)},!0)}e.append(t,s)};e.if(ae,t=>{a()==="clipboard"?t(le):t(ne,!1)})}return e.append(d,Z),e.bind_prop(r,"open_upload",E),e.bind_prop(r,"paste_clipboard",K),e.bind_prop(r,"open_file_upload",V),e.bind_prop(r,"load_files",O),e.bind_prop(r,"load_files_from_drop",Y),e.pop(re)}var xe=e.from_html("<!> <!> <!> <!> <!>",1);function ze(d,r){e.push(r,!1);let n=e.prop(r,"editable",12,!1),L=e.prop(r,"undoable",12,!1),b=e.prop(r,"download",12,null),a=e.prop(r,"i18n",12);const h=Q();var w={get editable(){return n()},set editable(c){n(c),e.flush()},get undoable(){return L()},set undoable(c){L(c),e.flush()},get download(){return b()},set download(c){b(c),e.flush()},get i18n(){return a()},set i18n(c){a(c),e.flush()}};return e.init(),fe(d,{children:(c,m)=>{var u=xe(),i=e.first_child(u);{var A=p=>{{let v=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a()("common.edit"))));N(p,{get Icon(){return ce},get label(){return e.get(v)},$$events:{click:()=>h("edit")}})}};e.if(i,p=>{n()&&p(A)})}var y=e.sibling(i,2);{var C=p=>{{let v=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a()("common.undo"))));N(p,{get Icon(){return pe},get label(){return e.get(v)},$$events:{click:()=>h("undo")}})}};e.if(y,p=>{L()&&p(C)})}var P=e.sibling(y,2);{var W=p=>{ge(p,{get href(){return b()},download:!0,children:(v,k)=>{{let o=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a()("common.download"))));N(v,{get Icon(){return he},get label(){return e.get(o)}})}},$$slots:{default:!0}})};e.if(P,p=>{b()&&p(W)})}var D=e.sibling(P,2);e.slot(D,r,"default",{},null);var z=e.sibling(D,2);{let p=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a()("common.clear"))));N(z,{get Icon(){return _e},get label(){return e.get(p)},$$events:{click:v=>{h("clear"),v.stopPropagation()}}})}e.append(c,u)},$$slots:{default:!0}}),e.pop(w)}export{ze as M,De as U,be as a,ye as c};
