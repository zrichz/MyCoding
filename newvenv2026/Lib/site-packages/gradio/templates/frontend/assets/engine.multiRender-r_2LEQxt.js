import{L as V,I as X}from"./index-Dtj0WP_z.js";import{WebGPUEngine as f}from"./webgpuEngine-BVuN5Z7c.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";import"./bakedVertexAnimation-BPwdbGuk.js";import"./instancesDeclaration-CzN5SjwP.js";import"./helperFunctions-Cj61g9Q2.js";import"./fresnelFunction-CiTzRVRa.js";import"./meshUboDeclaration-fjQ1fVkt.js";import"./sceneUboDeclaration-CzV6lZTK.js";import"./decalFragment-DtWE2kAX.js";import"./audioEngine-PcO3AmDs.js";f.prototype.unBindMultiColorAttachmentFramebuffer=function(t,e=!1,n){n&&n(),this._endCurrentRenderPass(),e||this.generateMipMapsMultiFramebuffer(t),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)};f.prototype.createMultipleRenderTarget=function(t,e,n){let l=!1,a=!0,u=!1,h=!1,c=15,g=1,m=1;const H=0,U=3,k=!1,v=5,N=3553;let x=[],T=[],M=[],_=[],y=[],R=[],S=[],b=[],A=[],B=[],d=!1;const i=this._createHardwareRenderTargetWrapper(!0,!1,t);e!==void 0&&(l=e.generateMipMaps??!1,a=e.generateDepthBuffer??!0,u=e.generateStencilBuffer??!1,h=e.generateDepthTexture??!1,g=e.textureCount??1,c=e.depthTextureFormat??15,x=e.types||x,T=e.samplingModes||T,M=e.useSRGBBuffers||M,_=e.formats||_,y=e.targetTypes||y,R=e.faceIndex||R,S=e.layerIndex||S,b=e.layerCounts||b,A=e.labels||A,B=e.creationFlags||B,m=e.samples??m,d=e.dontCreateTextures??!1);const D=t.width??t,G=t.height??t,F=[],I=[],w=[];i.label=e?.label??"MultiRenderTargetWrapper",i._generateDepthBuffer=a,i._generateStencilBuffer=u,i._attachments=I,i._defaultAttachments=w;let p=null;(a||u||h)&&!d&&(h||(a&&u?c=13:a?c=14:c=19),p=i.createDepthStencilTexture(0,!1,u,1,c,i.label+"-DepthStencil"));const P=e!==void 0&&typeof e=="object"&&e.createMipMaps&&!l;for(let s=0;s<g;s++){let C=T[s]||U,o=x[s]||H;const Y=_[s]||v,j=(M[s]||k)&&this._caps.supportSRGBBuffers,L=y[s]||N,E=b[s]??1,O=B[s];if((o===1&&!this._caps.textureFloatLinearFiltering||o===2&&!this._caps.textureHalfFloatLinearFiltering)&&(C=1),o===1&&!this._caps.textureFloat&&(o=0,V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),I.push(s+1),w.push(n?s+1:s===0?1:0),L===-1||d)continue;const r=new X(this,6);switch(F[s]=r,L){case 34067:r.isCube=!0;break;case 32879:r.is3D=!0,r.baseDepth=r.depth=E;break;case 35866:r.is2DArray=!0,r.baseDepth=r.depth=E;break}r.baseWidth=D,r.baseHeight=G,r.width=D,r.height=G,r.isReady=!0,r.samples=1,r.generateMipMaps=l,r.samplingMode=C,r.type=o,r._cachedWrapU=0,r._cachedWrapV=0,r._useSRGBBuffer=j,r.format=Y,r.label=A[s]??i.label+"-Texture"+s,this._internalTexturesCache.push(r),P&&(r.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(r,void 0,void 0,void 0,O,!0),P&&(r.generateMipMaps=!1)}return p&&(p.incrementReferences(),F[g]=p,this._internalTexturesCache.push(p)),i.setTextures(F),i.setLayerAndFaceIndices(S,R),d?i._samples=m:this.updateMultipleRenderTargetTextureSampleCount(i,m),i};f.prototype.updateMultipleRenderTargetTextureSampleCount=function(t,e){if(!t||!t.textures||t.textures.length===0||t.textures[0].samples===e)return e;const n=t.textures.length;if(n===0)return 1;e=Math.min(e,this.getCaps().maxMSAASamples);for(let a=0;a<n;++a)t.textures[a]._hardwareTexture?.releaseMSAATexture(t.getBaseArrayLayer(a));const l=t._depthStencilTexture===t.textures[n-1];for(let a=0;a<n;++a){const u=t.textures[a];this._textureHelper.createMSAATexture(u,e,!1,t.getBaseArrayLayer(a)),u.samples=e}return t._depthStencilTexture&&!l&&(this._textureHelper.createMSAATexture(t._depthStencilTexture,e),t._depthStencilTexture.samples=e),t._samples=e,e};f.prototype.generateMipMapsMultiFramebuffer=function(t){const e=t;if(!e.isMulti)return;const l=e._attachments.length;for(let a=0;a<l;a++){const u=e.textures[a];u.generateMipMaps&&!u.isCube&&!u.is3D&&this._generateMipmaps(u)}};f.prototype.resolveMultiFramebuffer=function(t){throw new Error("resolveMultiFramebuffer is not yet implemented in WebGPU!")};f.prototype.bindAttachments=function(t){t.length===0||!this._currentRenderTarget||(this._mrtAttachments=t,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(t))};f.prototype.buildTextureLayout=function(t,e=!1){const n=[];if(e)n.push(1);else for(let l=0;l<t.length;l++)t[l]?n.push(l+1):n.push(0);return n};f.prototype.restoreSingleAttachment=function(){};f.prototype.restoreSingleAttachmentForRenderTarget=function(){};
