import{F as b,a as j,bh as M,m as B,V as w,ap as V,L,bm as P,D,C as E,bn as C,e as x,aE as v}from"./index-Dtj0WP_z.js";import{A}from"./assetContainer-BmMhgWSk.js";import{S as I}from"./standardMaterial-ByOmGQsu.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";class f{constructor(){this.materials=[]}parseMTL(t,o,i,n){if(o instanceof ArrayBuffer)return;const l=o.split(`
`),h=/\s+/;let _,a=null;for(let c=0;c<l.length;c++){const r=l[c].trim();if(r.length===0||r.charAt(0)==="#")continue;const s=r.indexOf(" ");let e=s>=0?r.substring(0,s):r;e=e.toLowerCase();const p=s>=0?r.substring(s+1).trim():"";if(e==="newmtl")a&&this.materials.push(a),t._blockEntityCollection=!!n,a=new I(p,t),a._parentContainer=n,t._blockEntityCollection=!1;else if(e==="kd"&&a)_=p.split(h,3).map(parseFloat),a.diffuseColor=b.FromArray(_);else if(e==="ka"&&a)_=p.split(h,3).map(parseFloat),a.ambientColor=b.FromArray(_);else if(e==="ks"&&a)_=p.split(h,3).map(parseFloat),a.specularColor=b.FromArray(_);else if(e==="ke"&&a)_=p.split(h,3).map(parseFloat),a.emissiveColor=b.FromArray(_);else if(e==="ns"&&a)a.specularPower=parseFloat(p);else if(e==="d"&&a)a.alpha=parseFloat(p);else if(e==="map_ka"&&a)a.ambientTexture=f._GetTexture(i,p,t);else if(e==="map_kd"&&a)a.diffuseTexture=f._GetTexture(i,p,t);else if(e==="map_ks"&&a)a.specularTexture=f._GetTexture(i,p,t);else if(e!=="map_ns")if(e==="map_bump"&&a){const d=p.split(h),F=d.indexOf("-bm");let g=null;F>=0&&(g=d[F+1],d.splice(F,2)),a.bumpTexture=f._GetTexture(i,d.join(" "),t),a.bumpTexture&&g!==null&&(a.bumpTexture.level=parseFloat(g))}else e==="map_d"&&a&&(a.opacityTexture=f._GetTexture(i,p,t))}a&&this.materials.push(a)}static _GetTexture(t,o,i){if(!o)return null;let n=t;if(t==="file:"){let l=o.lastIndexOf("\\");l===-1&&(l=o.lastIndexOf("/")),l>-1?n+=o.substring(l+1):n+=o}else n+=o;return new j(n,i,!1,f.INVERT_TEXTURE_Y)}}f.INVERT_TEXTURE_Y=!0;class m{constructor(t,o,i){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new M(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=t,this._babylonMeshesArray=o,this._loadingOptions=i}_isInArray(t,o){t[o[0]]||(t[o[0]]={normals:[],idx:[]});const i=t[o[0]].normals.indexOf(o[1]);return i===-1?-1:t[o[0]].idx[i]}_isInArrayUV(t,o){t[o[0]]||(t[o[0]]={normals:[],idx:[],uv:[]});const i=t[o[0]].normals.indexOf(o[1]);return i!=1&&o[2]===t[o[0]].uv[i]?t[o[0]].idx[i]:-1}_setData(t){t.indiceUvsFromObj??(t.indiceUvsFromObj=-1),t.indiceNormalFromObj??(t.indiceNormalFromObj=-1);let o;this._loadingOptions.optimizeWithUV?o=this._isInArrayUV(this._tuplePosNorm,[t.indicePositionFromObj,t.indiceNormalFromObj,t.indiceUvsFromObj]):o=this._isInArray(this._tuplePosNorm,[t.indicePositionFromObj,t.indiceNormalFromObj]),o===-1?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(t.positionVectorFromOBJ),t.textureVectorFromOBJ!==void 0&&this._wrappedUvsForBabylon.push(t.textureVectorFromOBJ),t.normalsVectorFromOBJ!==void 0&&this._wrappedNormalsForBabylon.push(t.normalsVectorFromOBJ),t.positionColorsFromOBJ!==void 0&&this._wrappedColorsForBabylon.push(t.positionColorsFromOBJ),this._tuplePosNorm[t.indicePositionFromObj].normals.push(t.indiceNormalFromObj),this._tuplePosNorm[t.indicePositionFromObj].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[t.indicePositionFromObj].uv.push(t.indiceUvsFromObj)):this._indicesForBabylon.push(o)}_unwrapData(){try{for(let t=0;t<this._wrappedPositionForBabylon.length;t++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[t].x*this._handednessSign,this._wrappedPositionForBabylon[t].y,this._wrappedPositionForBabylon[t].z),this._wrappedNormalsForBabylon.length&&this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[t].x*this._handednessSign,this._wrappedNormalsForBabylon[t].y,this._wrappedNormalsForBabylon[t].z),this._wrappedUvsForBabylon.length&&this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[t].x,this._wrappedUvsForBabylon[t].y),this._unwrappedColorsForBabylon.length&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[t].r,this._wrappedColorsForBabylon[t].g,this._wrappedColorsForBabylon[t].b,this._wrappedColorsForBabylon[t].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch{throw new Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(t,o){for(let i=o;i<t.length-1;i++)this._pushTriangle(t,i)}_getColor(t){if(this._loadingOptions.importVertexColors)return this._extColors[t]??this._colors[t]}_setDataForCurrentFaceWithPattern1(t,o){this._getTriangles(t,o);for(let i=0;i<this._triangles.length;i++){const n=parseInt(this._triangles[i])-1;this._setData({indicePositionFromObj:n,positionVectorFromOBJ:this._positions[n],positionColorsFromOBJ:this._getColor(n)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(t,o){this._getTriangles(t,o);for(let i=0;i<this._triangles.length;i++){const n=this._triangles[i].split("/"),l=parseInt(n[0])-1,h=parseInt(n[1])-1;this._setData({indicePositionFromObj:l,indiceUvsFromObj:h,positionVectorFromOBJ:this._positions[l],textureVectorFromOBJ:this._uvs[h],positionColorsFromOBJ:this._getColor(l)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(t,o){this._getTriangles(t,o);for(let i=0;i<this._triangles.length;i++){const n=this._triangles[i].split("/"),l=parseInt(n[0])-1,h=parseInt(n[1])-1,_=parseInt(n[2])-1;this._setData({indicePositionFromObj:l,indiceUvsFromObj:h,indiceNormalFromObj:_,positionVectorFromOBJ:this._positions[l],textureVectorFromOBJ:this._uvs[h],normalsVectorFromOBJ:this._normals[_]})}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(t,o){this._getTriangles(t,o);for(let i=0;i<this._triangles.length;i++){const n=this._triangles[i].split("//"),l=parseInt(n[0])-1,h=parseInt(n[1])-1;this._setData({indicePositionFromObj:l,indiceNormalFromObj:h,positionVectorFromOBJ:this._positions[l],normalsVectorFromOBJ:this._normals[h],positionColorsFromOBJ:this._getColor(l)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(t,o){this._getTriangles(t,o);for(let i=0;i<this._triangles.length;i++){const n=this._triangles[i].split("/"),l=this._positions.length+parseInt(n[0]),h=this._uvs.length+parseInt(n[1]),_=this._normals.length+parseInt(n[2]);this._setData({indicePositionFromObj:l,indiceUvsFromObj:h,indiceNormalFromObj:_,positionVectorFromOBJ:this._positions[l],textureVectorFromOBJ:this._uvs[h],normalsVectorFromOBJ:this._normals[_],positionColorsFromOBJ:this._getColor(l)})}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice()),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon.slice()),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._handledMesh.hasLines=this._hasLineData,this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(t){const o=t.getVerticesData(B.PositionKind),i=t.getVerticesData(B.NormalKind),n={};if(!o||!i)return;for(let h=0;h<o.length/3;h++){const _=o[h*3+0],a=o[h*3+1],c=o[h*3+2],r=_+"_"+a+"_"+c;let s=n[r];s||(s=[],n[r]=s),s.push(h)}const l=new w;for(const h in n){const _=n[h];if(_.length<2)continue;const a=_[0];for(let c=1;c<_.length;++c){const r=_[c];i[a*3+0]+=i[r*3+0],i[a*3+1]+=i[r*3+1],i[a*3+2]+=i[r*3+2]}l.copyFromFloats(i[a*3+0],i[a*3+1],i[a*3+2]),l.normalize();for(let c=0;c<_.length;++c){const r=_[c];i[r*3+0]=l.x,i[r*3+1]=l.y,i[r*3+2]=l.z}}t.setVerticesData(B.NormalKind,i)}static _IsLineElement(t){return t.startsWith("l")}static _IsObjectElement(t){return t.startsWith("o")}static _IsGroupElement(t){return t.startsWith("g")}static _GetZbrushMRGB(t,o){if(!t.startsWith("mrgb"))return null;if(t=t.replace("mrgb","").trim(),o)return[];const i=/[a-z0-9]/g,n=t.match(i);if(!n||n.length%8!==0)return[];const l=[];for(let h=0;h<n.length/8;h++){const _=n[h*8+2]+n[h*8+3],a=n[h*8+4]+n[h*8+5],c=n[h*8+6]+n[h*8+7];l.push(new M(parseInt(_,16)/255,parseInt(a,16)/255,parseInt(c,16)/255,1))}return l}parse(t,o,i,n,l){o=o.replace(/#MRGB/g,"mrgb"),o=o.replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(r,s)=>this._triangles.push(r[0],r[s],r[s+1]),this._handednessSign=1):i.useRightHandedSystem?(this._pushTriangle=(r,s)=>this._triangles.push(r[0],r[s+1],r[s]),this._handednessSign=1):(this._pushTriangle=(r,s)=>this._triangles.push(r[0],r[s],r[s+1]),this._handednessSign=-1);const h=o.split(`
`),_=[];let a=[];_.push(a);for(let r=0;r<h.length;r++){const s=h[r].trim().replace(/\s\s/g," ");if(!(s.length===0||s.charAt(0)==="#"))if((m._IsGroupElement(s)||m._IsObjectElement(s))&&(a=[],_.push(a)),m._IsLineElement(s)){const e=s.split(" ");for(let p=1;p<e.length-1;p++)a.push(`l ${e[p]} ${e[p+1]}`)}else a.push(s)}const c=_.flat();for(let r=0;r<c.length;r++){const s=c[r].trim().replace(/\s\s/g," ");let e;if(!(s.length===0||s.charAt(0)==="#"))if(m.VertexPattern.test(s)){if(e=s.match(/[^ ]+/g),this._positions.push(new w(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))),this._loadingOptions.importVertexColors)if(e.length>=7){const p=parseFloat(e[4]),d=parseFloat(e[5]),F=parseFloat(e[6]);this._colors.push(new M(p>1?p/255:p,d>1?d/255:d,F>1?F/255:F,e.length===7||e[7]===void 0?1:parseFloat(e[7])))}else this._colors.push(this._grayColor)}else if((e=m.NormalPattern.exec(s))!==null)this._normals.push(new w(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])));else if((e=m.UVPattern.exec(s))!==null)this._uvs.push(new V(parseFloat(e[1])*this._loadingOptions.UVScaling.x,parseFloat(e[2])*this._loadingOptions.UVScaling.y));else if((e=m.FacePattern3.exec(s))!==null)this._setDataForCurrentFaceWithPattern3(e[1].trim().split(" "),1);else if((e=m.FacePattern4.exec(s))!==null)this._setDataForCurrentFaceWithPattern4(e[1].trim().split(" "),1);else if((e=m.FacePattern5.exec(s))!==null)this._setDataForCurrentFaceWithPattern5(e[1].trim().split(" "),1);else if((e=m.FacePattern2.exec(s))!==null)this._setDataForCurrentFaceWithPattern2(e[1].trim().split(" "),1);else if((e=m.FacePattern1.exec(s))!==null)this._setDataForCurrentFaceWithPattern1(e[1].trim().split(" "),1);else if((e=m.LinePattern1.exec(s))!==null)this._setDataForCurrentFaceWithPattern1(e[1].trim().split(" "),0),this._hasLineData=!0;else if((e=m.LinePattern2.exec(s))!==null)this._setDataForCurrentFaceWithPattern2(e[1].trim().split(" "),0),this._hasLineData=!0;else if(e=m._GetZbrushMRGB(s,!this._loadingOptions.importVertexColors))for(const p of e)this._extColors.push(p);else if((e=m.LinePattern3.exec(s))!==null)this._setDataForCurrentFaceWithPattern3(e[1].trim().split(" "),0),this._hasLineData=!0;else if(m.GroupDescriptor.test(s)||m.ObjectDescriptor.test(s)){const p={name:s.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:m.ObjectDescriptor.test(s)};this._addPreviousObjMesh(),this._meshesFromObj.push(p),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(m.UseMtlDescriptor.test(s)){if(this._materialNameFromObj=s.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();const p={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(p),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else m.MtlLibGroupDescriptor.test(s)?l(s.substring(7).trim()):m.SmoothDescriptor.test(s)||L.Log("Unhandled expression at line : "+s)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon),this._handledMesh.hasLines=this._hasLineData),!this._hasMeshes){let r=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(const s of this._positions)this._unwrappedPositionsForBabylon.push(s.x,s.y,s.z);if(this._normals.length)for(const s of this._normals)this._unwrappedNormalsForBabylon.push(s.x,s.y,s.z);if(this._uvs.length)for(const s of this._uvs)this._unwrappedUVForBabylon.push(s.x,s.y);if(this._extColors.length)for(const s of this._extColors)this._unwrappedColorsForBabylon.push(s.r,s.g,s.b,s.a);else if(this._colors.length)for(const s of this._colors)this._unwrappedColorsForBabylon.push(s.r,s.g,s.b,s.a);this._materialNameFromObj||(r=new I(P.RandomId(),i),r.pointsCloud=!0,this._materialNameFromObj=r.name,this._normals.length||(r.disableLighting=!0,r.emissiveColor=b.White()))}this._meshesFromObj.push({name:P.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:r,isObject:!0,hasLines:this._hasLineData})}for(let r=0;r<this._meshesFromObj.length;r++){if(t&&this._meshesFromObj[r].name){if(t instanceof Array){if(t.indexOf(this._meshesFromObj[r].name)===-1)continue}else if(this._meshesFromObj[r].name!==t)continue}this._handledMesh=this._meshesFromObj[r],i._blockEntityCollection=!!n;const s=new D(this._meshesFromObj[r].name,i);if(s._parentContainer=n,i._blockEntityCollection=!1,this._handledMesh._babylonMesh=s,!this._handledMesh.isObject){for(let p=r-1;p>=0;--p)if(this._meshesFromObj[p].isObject&&this._meshesFromObj[p]._babylonMesh){s.parent=this._meshesFromObj[p]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[r].materialName),this._handledMesh.hasLines&&(s._internalMetadata??(s._internalMetadata={}),s._internalMetadata._isLine=!0),this._handledMesh.positions?.length===0){this._babylonMeshesArray.push(s);continue}const e=new E;if(e.indices=this._handledMesh.indices,e.positions=this._handledMesh.positions,this._loadingOptions.computeNormals||!this._handledMesh.normals){const p=new Array;E.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,p),e.normals=p}else e.normals=this._handledMesh.normals;this._handledMesh.uvs&&(e.uvs=this._handledMesh.uvs),this._handledMesh.colors&&(e.colors=this._handledMesh.colors),e.applyToMesh(s),this._loadingOptions.invertY&&(s.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(s),this._babylonMeshesArray.push(s),this._handledMesh.directMaterial&&(s.material=this._handledMesh.directMaterial)}}}m.ObjectDescriptor=/^o/;m.GroupDescriptor=/^g/;m.MtlLibGroupDescriptor=/^mtllib /;m.UseMtlDescriptor=/^usemtl /;m.SmoothDescriptor=/^s /;m.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/;m.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/;m.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/;m.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/;m.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/;m.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/;m.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/;m.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/;m.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/;m.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;m.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class u{static get INVERT_TEXTURE_Y(){return f.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(t){f.INVERT_TEXTURE_Y=t}constructor(t){this.name=C.name,this.extensions=C.extensions,this._assetContainer=null,this._loadingOptions={...u._DefaultLoadingOptions,...t??{}}}static get _DefaultLoadingOptions(){return{computeNormals:u.COMPUTE_NORMALS,optimizeNormals:u.OPTIMIZE_NORMALS,importVertexColors:u.IMPORT_VERTEX_COLORS,invertY:u.INVERT_Y,invertTextureY:u.INVERT_TEXTURE_Y,UVScaling:u.UV_SCALING,materialLoadingFailsSilently:u.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:u.OPTIMIZE_WITH_UV,skipMaterials:u.SKIP_MATERIALS,useLegacyBehavior:u.USE_LEGACY_BEHAVIOR}}_loadMTL(t,o,i,n){const l=o+t;x.LoadFile(l,i,void 0,void 0,!1,(h,_)=>{n(l,_)})}createPlugin(t){return new u(t[C.name])}canDirectLoad(){return!1}importMeshAsync(t,o,i,n){return this._parseSolidAsync(t,o,i,n).then(l=>({meshes:l,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(t,o,i){return this.importMeshAsync(null,t,o,i).then(()=>{})}loadAssetContainerAsync(t,o,i){const n=new A(t);return this._assetContainer=n,this.importMeshAsync(null,t,o,i).then(l=>(l.meshes.forEach(h=>n.meshes.push(h)),l.meshes.forEach(h=>{const _=h.material;_&&n.materials.indexOf(_)==-1&&(n.materials.push(_),_.getActiveTextures().forEach(c=>{n.textures.indexOf(c)==-1&&n.textures.push(c)}))}),this._assetContainer=null,n)).catch(l=>{throw this._assetContainer=null,l})}_parseSolidAsync(t,o,i,n){let l="";const h=new f,_=[],a=[];i=i.replace(/#.*$/gm,"").trim(),new m(_,a,this._loadingOptions).parse(t,i,o,this._assetContainer,s=>{l=s});const r=[];return l!==""&&!this._loadingOptions.skipMaterials&&r.push(new Promise((s,e)=>{this._loadMTL(l,n,p=>{try{h.parseMTL(o,p,n,this._assetContainer);for(let d=0;d<h.materials.length;d++){let F=0;const g=[];let y;for(;(y=_.indexOf(h.materials[d].name,F))>-1;)g.push(y),F=y+1;if(y===-1&&g.length===0)h.materials[d].dispose();else for(let O=0;O<g.length;O++){const T=a[g[O]],N=h.materials[d];T.material=N,T.getTotalIndices()||(N.pointsCloud=!0)}}s()}catch(d){x.Warn(`Error processing MTL file: '${l}'`),this._loadingOptions.materialLoadingFailsSilently?s():e(d)}},(p,d)=>{x.Warn(`Error downloading MTL file: '${l}'`),this._loadingOptions.materialLoadingFailsSilently?s():e(d)})})),Promise.all(r).then(()=>{const s=e=>!!(e._internalMetadata?._isLine??!1);return a.forEach(e=>{if(s(e)){let p=e.material??new I(e.name+"_line",o);p.getBindedMeshes().filter(F=>!s(F)).length>0&&(p=p.clone(p.name+"_line")??p),p.wireframe=!0,e.material=p,e._internalMetadata&&(e._internalMetadata._isLine=void 0)}}),a})}}u.OPTIMIZE_WITH_UV=!0;u.INVERT_Y=!1;u.IMPORT_VERTEX_COLORS=!1;u.COMPUTE_NORMALS=!1;u.OPTIMIZE_NORMALS=!1;u.UV_SCALING=new V(1,1);u.SKIP_MATERIALS=!1;u.MATERIAL_LOADING_FAILS_SILENTLY=!0;u.USE_LEGACY_BEHAVIOR=!1;v(new u);export{u as OBJFileLoader};
