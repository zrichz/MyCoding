import{T as A,L as $,I as q}from"./index-Dtj0WP_z.js";import"./index-Dw8Uzof1.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";A.prototype.restoreSingleAttachment=function(){const r=this._gl;this.bindAttachments([r.BACK])};A.prototype.restoreSingleAttachmentForRenderTarget=function(){const r=this._gl;this.bindAttachments([r.COLOR_ATTACHMENT0])};A.prototype.buildTextureLayout=function(r,t=!1){const f=this._gl,u=[];if(t)u.push(f.BACK);else for(let i=0;i<r.length;i++)r[i]?u.push(f["COLOR_ATTACHMENT"+i]):u.push(f.NONE);return u};A.prototype.bindAttachments=function(r){this._gl.drawBuffers(r)};A.prototype.unBindMultiColorAttachmentFramebuffer=function(r,t=!1,f){this._currentRenderTarget=null,r.disableAutomaticMSAAResolve||this.resolveMultiFramebuffer(r),t||this.generateMipMapsMultiFramebuffer(r),f&&(r._MSAAFramebuffer&&this._bindUnboundFramebuffer(r._framebuffer),f()),this._bindUnboundFramebuffer(null)};A.prototype.createMultipleRenderTarget=function(r,t,f=!0){let u=!1,i=!0,E=!1,n=!1,s,_=1,d=1;const S=0,F=3,M=!1,J=5,Q=3553;let D=[],B=[],C=[],N=[],L=[],U=[],O=[],I=[],w=[],x=!1;const T=this._createHardwareRenderTargetWrapper(!0,!1,r);t!==void 0&&(u=t.generateMipMaps===void 0?!1:t.generateMipMaps,i=t.generateDepthBuffer===void 0?!0:t.generateDepthBuffer,E=t.generateStencilBuffer===void 0?!1:t.generateStencilBuffer,n=t.generateDepthTexture===void 0?!1:t.generateDepthTexture,_=t.textureCount??1,d=t.samples??d,D=t.types||D,B=t.samplingModes||B,C=t.useSRGBBuffers||C,N=t.formats||N,L=t.targetTypes||L,U=t.faceIndex||U,O=t.layerIndex||O,I=t.layerCounts||I,w=t.labels||w,x=t.dontCreateTextures??!1,this.webGLVersion>1&&(t.depthTextureFormat===13||t.depthTextureFormat===17||t.depthTextureFormat===16||t.depthTextureFormat===14||t.depthTextureFormat===18)&&(s=t.depthTextureFormat)),s===void 0&&(s=E?13:14);const e=this._gl,V=this._currentFramebuffer,v=e.createFramebuffer();this._bindUnboundFramebuffer(v);const c=r.width??r,b=r.height??r,y=[],p=[],K=this.webGLVersion>1&&(s===13||s===17||s===18);T.label=t?.label??"MultiRenderTargetWrapper",T._framebuffer=v,T._generateDepthBuffer=n||i,T._generateStencilBuffer=n?K:E,T._depthStencilBuffer=this._setupFramebufferDepthAttachments(T._generateStencilBuffer,T._generateDepthBuffer,c,b,1,s),T._attachments=p;for(let a=0;a<_;a++){let m=B[a]||F,o=D[a]||S,R=C[a]||M;const g=N[a]||J,h=L[a]||Q,Y=I[a]??1;(o===1&&!this._caps.textureFloatLinearFiltering||o===2&&!this._caps.textureHalfFloatLinearFiltering)&&(m=1);const j=this._getSamplingParameters(m,u);o===1&&!this._caps.textureFloat&&(o=0,$.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),R=R&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU);const k=this.webGLVersion>1,Z=e[k?"COLOR_ATTACHMENT"+a:"COLOR_ATTACHMENT"+a+"_WEBGL"];if(p.push(Z),h===-1||x)continue;const l=new q(this,6);y[a]=l,e.activeTexture(e["TEXTURE"+a]),e.bindTexture(h,l._hardwareTexture.underlyingResource),e.texParameteri(h,e.TEXTURE_MAG_FILTER,j.mag),e.texParameteri(h,e.TEXTURE_MIN_FILTER,j.min),e.texParameteri(h,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(h,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const P=this._getRGBABufferInternalSizedFormat(o,g,R),G=this._getInternalFormat(g),H=this._getWebGLTextureType(o);if(k&&(h===35866||h===32879))h===35866?l.is2DArray=!0:l.is3D=!0,l.baseDepth=l.depth=Y,e.texImage3D(h,0,P,c,b,Y,0,G,H,null);else if(h===34067){for(let X=0;X<6;X++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,P,c,b,0,G,H,null);l.isCube=!0}else e.texImage2D(e.TEXTURE_2D,0,P,c,b,0,G,H,null);u&&e.generateMipmap(h),this._bindTextureDirectly(h,null),l.baseWidth=c,l.baseHeight=b,l.width=c,l.height=b,l.isReady=!0,l.samples=1,l.generateMipMaps=u,l.samplingMode=m,l.type=o,l._useSRGBBuffer=R,l.format=g,l.label=w[a]??T.label+"-Texture"+a,this._internalTexturesCache.push(l)}if(n&&this._caps.depthTextureExtension&&!x){const a=new q(this,14);let m=5,o=e.DEPTH_COMPONENT16,R=e.DEPTH_COMPONENT,g=e.UNSIGNED_SHORT,h=e.DEPTH_ATTACHMENT;this.webGLVersion<2?o=e.DEPTH_COMPONENT:s===14?(m=1,g=e.FLOAT,o=e.DEPTH_COMPONENT32F):s===18?(m=0,g=e.FLOAT_32_UNSIGNED_INT_24_8_REV,o=e.DEPTH32F_STENCIL8,R=e.DEPTH_STENCIL,h=e.DEPTH_STENCIL_ATTACHMENT):s===16?(m=0,g=e.UNSIGNED_INT,o=e.DEPTH_COMPONENT24,h=e.DEPTH_ATTACHMENT):(s===13||s===17)&&(m=12,g=e.UNSIGNED_INT_24_8,o=e.DEPTH24_STENCIL8,R=e.DEPTH_STENCIL,h=e.DEPTH_STENCIL_ATTACHMENT),this._bindTextureDirectly(e.TEXTURE_2D,a,!0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,o,c,b,0,R,g,null),e.framebufferTexture2D(e.FRAMEBUFFER,h,e.TEXTURE_2D,a._hardwareTexture.underlyingResource,0),this._bindTextureDirectly(e.TEXTURE_2D,null),T._depthStencilTexture=a,T._depthStencilTextureWithStencil=K,a.baseWidth=c,a.baseHeight=b,a.width=c,a.height=b,a.isReady=!0,a.samples=1,a.generateMipMaps=u,a.samplingMode=1,a.format=s,a.type=m,a.label=T.label+"-DepthStencil",y[_]=a,this._internalTexturesCache.push(a)}if(T.setTextures(y),f&&e.drawBuffers(p),this._bindUnboundFramebuffer(V),T.setLayerAndFaceIndices(O,U),this.resetTextureCache(),!x)this.updateMultipleRenderTargetTextureSampleCount(T,d,f);else if(d>1){const a=e.createFramebuffer();if(!a)throw new Error("Unable to create multi sampled framebuffer");T._samples=d,T._MSAAFramebuffer=a,_>0&&f&&(this._bindUnboundFramebuffer(a),e.drawBuffers(p),this._bindUnboundFramebuffer(V))}return T};A.prototype.updateMultipleRenderTargetTextureSampleCount=function(r,t,f=!0){if(this.webGLVersion<2||!r)return 1;if(r.samples===t)return t;const u=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),r._depthStencilBuffer&&(u.deleteRenderbuffer(r._depthStencilBuffer),r._depthStencilBuffer=null),r._MSAAFramebuffer&&(u.deleteFramebuffer(r._MSAAFramebuffer),r._MSAAFramebuffer=null);const i=r._attachments.length;for(let n=0;n<i;n++)r.textures[n]._hardwareTexture?.releaseMSAARenderBuffers();if(t>1&&typeof u.renderbufferStorageMultisample=="function"){const n=u.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");r._MSAAFramebuffer=n,this._bindUnboundFramebuffer(n);const s=[];for(let _=0;_<i;_++){const d=r.textures[_],S=d._hardwareTexture,F=u[this.webGLVersion>1?"COLOR_ATTACHMENT"+_:"COLOR_ATTACHMENT"+_+"_WEBGL"],M=this._createRenderBuffer(d.width,d.height,t,-1,this._getRGBABufferInternalSizedFormat(d.type,d.format,d._useSRGBBuffer),F);if(!M)throw new Error("Unable to create multi sampled framebuffer");S.addMSAARenderBuffer(M),d.samples=t,s.push(F)}f&&u.drawBuffers(s)}else this._bindUnboundFramebuffer(r._framebuffer);const E=r._depthStencilTexture?r._depthStencilTexture.format:void 0;return r._depthStencilBuffer=this._setupFramebufferDepthAttachments(r._generateStencilBuffer,r._generateDepthBuffer,r.width,r.height,t,E),this._bindUnboundFramebuffer(null),r._samples=t,t};A.prototype.generateMipMapsMultiFramebuffer=function(r){const t=r,f=this._gl;if(t.isMulti)for(let u=0;u<t._attachments.length;u++){const i=t.textures[u];i?.generateMipMaps&&!i?.isCube&&!i?.is3D&&(this._bindTextureDirectly(f.TEXTURE_2D,i,!0),f.generateMipmap(f.TEXTURE_2D),this._bindTextureDirectly(f.TEXTURE_2D,null))}};A.prototype.resolveMultiFramebuffer=function(r){const t=r,f=this._gl;if(!t._MSAAFramebuffer||!t.isMulti)return;let u=t.resolveMSAAColors?f.COLOR_BUFFER_BIT:0;u|=t._generateDepthBuffer&&t.resolveMSAADepth?f.DEPTH_BUFFER_BIT:0,u|=t._generateStencilBuffer&&t.resolveMSAAStencil?f.STENCIL_BUFFER_BIT:0;const i=t._attachments,E=i.length;f.bindFramebuffer(f.READ_FRAMEBUFFER,t._MSAAFramebuffer),f.bindFramebuffer(f.DRAW_FRAMEBUFFER,t._framebuffer);for(let n=0;n<E;n++){const s=t.textures[n];for(let _=0;_<E;_++)i[_]=f.NONE;i[n]=f[this.webGLVersion>1?"COLOR_ATTACHMENT"+n:"COLOR_ATTACHMENT"+n+"_WEBGL"],f.readBuffer(i[n]),f.drawBuffers(i),f.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,u,f.NEAREST)}for(let n=0;n<E;n++)i[n]=f[this.webGLVersion>1?"COLOR_ATTACHMENT"+n:"COLOR_ATTACHMENT"+n+"_WEBGL"];f.drawBuffers(i),f.bindFramebuffer(this._gl.FRAMEBUFFER,t._MSAAFramebuffer)};
